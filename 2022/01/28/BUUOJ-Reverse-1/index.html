<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Reverse 刷题记录 - Curator-Kim的小站</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="Curator-Kim的小站"><meta name="msapplication-TileImage" content="https://cdn.jsdelivr.net/gh/removeif/removeif-demo@latest/img/favicon.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Curator-Kim的小站"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="题目主要来自BUUOJ，少数其他来源 [toc] [CFI-CTF 2018]IntroToPE直接扔IDA，发现无法F5，转而查看汇编代码 在此处发现奇怪的Base64字符串，解码后得到flag:CFI{.NetC#_1s_@w3s0m3}"><meta property="og:type" content="blog"><meta property="og:title" content="Curator-Kim"><meta property="og:url" content="https://curator-kim.github.io/"><meta property="og:site_name" content="Curator-Kim"><meta property="og:description" content="题目主要来自BUUOJ，少数其他来源 [toc] [CFI-CTF 2018]IntroToPE直接扔IDA，发现无法F5，转而查看汇编代码 在此处发现奇怪的Base64字符串，解码后得到flag:CFI{.NetC#_1s_@w3s0m3}"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://curator-kim.github.io/img/icon.jpg"><meta property="article:published_time" content="2022-01-28T02:45:53.000Z"><meta property="article:modified_time" content="2022-12-26T15:40:54.474Z"><meta property="article:author" content="Curator-Kim"><meta property="article:tag" content="CTF"><meta property="article:tag" content="RE"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/img/icon.jpg"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://curator-kim.github.io/2022/01/28/BUUOJ-Reverse-1/"},"headline":"Curator-Kim的小站","image":["http://curator-kim.github.io/2022/01/28/BUUOJ-Reverse-1/image-20220128104747053.png","http://curator-kim.github.io/2022/01/28/BUUOJ-Reverse-1/image-20220130212142440.png","http://curator-kim.github.io/2022/01/28/BUUOJ-Reverse-1/image-20220130212235635.png","http://curator-kim.github.io/2022/01/28/BUUOJ-Reverse-1/image-20220130212510331.png","http://curator-kim.github.io/2022/01/28/BUUOJ-Reverse-1/image-20220201121719029.png","http://curator-kim.github.io/2022/01/28/BUUOJ-Reverse-1/image-20220201121821195.png","http://curator-kim.github.io/2022/01/28/BUUOJ-Reverse-1/image-20220201122023363.png","http://curator-kim.github.io/2022/01/28/BUUOJ-Reverse-1/image-20220201134316497-16436941972091.png","http://curator-kim.github.io/2022/01/28/BUUOJ-Reverse-1/image-20220201134351940.png","http://curator-kim.github.io/2022/01/28/BUUOJ-Reverse-1/image-20220201134505470.png","http://curator-kim.github.io/2022/01/28/BUUOJ-Reverse-1/image-20220208123607139.png","http://curator-kim.github.io/2022/01/28/BUUOJ-Reverse-1/image-20220208123843144.png","http://curator-kim.github.io/2022/01/28/BUUOJ-Reverse-1/image-20220208123903027.png","http://curator-kim.github.io/2022/01/28/BUUOJ-Reverse-1/image-20220208124245456.png","http://curator-kim.github.io/2022/01/28/BUUOJ-Reverse-1/image-20220208124410741.png","http://curator-kim.github.io/2022/01/28/BUUOJ-Reverse-1/image-20220208124435216.png","http://curator-kim.github.io/2022/01/28/BUUOJ-Reverse-1/image-20220208131808405.png","http://curator-kim.github.io/2022/01/28/BUUOJ-Reverse-1/image-20220209210019622.png","http://curator-kim.github.io/2022/01/28/BUUOJ-Reverse-1/image-20220209210300315.png","http://curator-kim.github.io/2022/01/28/BUUOJ-Reverse-1/image-20220209210450763.png","http://curator-kim.github.io/2022/01/28/BUUOJ-Reverse-1/image-20220216223251936.png","http://curator-kim.github.io/2022/01/28/BUUOJ-Reverse-1/image-20220216231653735.png","http://curator-kim.github.io/2022/01/28/BUUOJ-Reverse-1/image-20220217001540216.png","http://curator-kim.github.io/2022/01/28/BUUOJ-Reverse-1/image-20220217001732641.png","http://curator-kim.github.io/2022/01/28/BUUOJ-Reverse-1/image-20220217001748482.png","http://curator-kim.github.io/2022/01/28/BUUOJ-Reverse-1/image-20220217160648922.png","http://curator-kim.github.io/2022/01/28/BUUOJ-Reverse-1/1031264-20170805165132678-576490323.png","http://curator-kim.github.io/2022/01/28/BUUOJ-Reverse-1/image-20220217165203740.png","http://curator-kim.github.io/2022/01/28/BUUOJ-Reverse-1/image-20220217165600839.png","http://curator-kim.github.io/2022/01/28/BUUOJ-Reverse-1/image-20220228235632948.png","http://curator-kim.github.io/2022/01/28/BUUOJ-Reverse-1/image-20220320171115020.png","http://curator-kim.github.io/2022/01/28/BUUOJ-Reverse-1/image-20220320171523419.png","http://curator-kim.github.io/2022/01/28/BUUOJ-Reverse-1/image-20220320203654146.png","http://curator-kim.github.io/2022/01/28/BUUOJ-Reverse-1/image-20220320211014168.png","http://curator-kim.github.io/2022/01/28/BUUOJ-Reverse-1/image-20220320223452685.png","http://curator-kim.github.io/2022/01/28/BUUOJ-Reverse-1/image-20220320230827719.png","http://curator-kim.github.io/2022/01/28/BUUOJ-Reverse-1/image-20220320231128607.png","http://curator-kim.github.io/2022/01/28/BUUOJ-Reverse-1/image-20220320230412284.png","http://curator-kim.github.io/2022/01/28/BUUOJ-Reverse-1/image-20220320232638109.png","http://curator-kim.github.io/2022/01/28/BUUOJ-Reverse-1/image-20220401200712278.png","http://curator-kim.github.io/2022/01/28/BUUOJ-Reverse-1/image-20220401201330972.png","http://curator-kim.github.io/2022/01/28/BUUOJ-Reverse-1/image-20220401203034967.png","http://curator-kim.github.io/2022/01/28/BUUOJ-Reverse-1/image-20220406200533260.png","http://curator-kim.github.io/2022/01/28/BUUOJ-Reverse-1/image-20220407115532731.png","http://curator-kim.github.io/2022/01/28/BUUOJ-Reverse-1/image-20220412203813855.png","http://curator-kim.github.io/2022/01/28/BUUOJ-Reverse-1/image-20220417233517509.png","http://curator-kim.github.io/2022/01/28/BUUOJ-Reverse-1/image-20220417233553524.png","http://curator-kim.github.io/2022/01/28/BUUOJ-Reverse-1/image-20220417233928282.png","http://curator-kim.github.io/2022/01/28/BUUOJ-Reverse-1/image-20220418001120366.png","http://curator-kim.github.io/2022/01/28/BUUOJ-Reverse-1/image-20220507200201619.png","http://curator-kim.github.io/2022/01/28/BUUOJ-Reverse-1/image-20220507200239324.png","http://curator-kim.github.io/2022/01/28/BUUOJ-Reverse-1/image-20220507155120187.png","http://curator-kim.github.io/2022/01/28/BUUOJ-Reverse-1/image-20220510195215506.png","http://curator-kim.github.io/2022/01/28/BUUOJ-Reverse-1/image-20220528160552459.png","http://curator-kim.github.io/2022/01/28/BUUOJ-Reverse-1/image-20220528160800200.png","http://curator-kim.github.io/2022/01/28/BUUOJ-Reverse-1/image-20220510205116532.png","http://curator-kim.github.io/2022/01/28/BUUOJ-Reverse-1/image-20220510205150477.png","http://curator-kim.github.io/2022/01/28/BUUOJ-Reverse-1/image-20220511112512620.png","http://curator-kim.github.io/2022/01/28/BUUOJ-Reverse-1/image-20220518163305874.png","http://curator-kim.github.io/2022/01/28/BUUOJ-Reverse-1/image-20220518163424882.png","http://curator-kim.github.io/2022/01/28/BUUOJ-Reverse-1/image-20220518163630410.png","http://curator-kim.github.io/2022/01/28/BUUOJ-Reverse-1/image-20220518163913162.png","http://curator-kim.github.io/2022/01/28/BUUOJ-Reverse-1/image-20220518164217000.png","http://curator-kim.github.io/2022/01/28/BUUOJ-Reverse-1/image-20220518164338069.png","http://curator-kim.github.io/2022/01/28/BUUOJ-Reverse-1/image-20220519155314534.png","http://curator-kim.github.io/2022/01/28/BUUOJ-Reverse-1/image-20220519155402267.png","http://curator-kim.github.io/2022/01/28/BUUOJ-Reverse-1/image-20220519162329377.png","http://curator-kim.github.io/2022/01/28/BUUOJ-Reverse-1/image-20220519171806342.png","http://curator-kim.github.io/2022/01/28/BUUOJ-Reverse-1/image-20220520164811489.png","http://curator-kim.github.io/2022/01/28/BUUOJ-Reverse-1/image-20220520164627752.png","http://curator-kim.github.io/2022/01/28/BUUOJ-Reverse-1/image-20220520164635309.png","http://curator-kim.github.io/2022/01/28/BUUOJ-Reverse-1/image-20220520164644647.png","http://curator-kim.github.io/2022/01/28/BUUOJ-Reverse-1/image-20220520163047206.png","http://curator-kim.github.io/2022/01/28/BUUOJ-Reverse-1/image-20220527154558056.png","http://curator-kim.github.io/2022/01/28/BUUOJ-Reverse-1/image-20220527155009034.png","http://curator-kim.github.io/2022/01/28/BUUOJ-Reverse-1/image-20220527164919681.png","http://curator-kim.github.io/2022/01/28/BUUOJ-Reverse-1/image-20220527170000216.png","http://curator-kim.github.io/2022/01/28/BUUOJ-Reverse-1/image-20220527172908880.png","http://curator-kim.github.io/2022/01/28/BUUOJ-Reverse-1/image-20220527172954733.png","http://curator-kim.github.io/2022/01/28/BUUOJ-Reverse-1/image-20220528212151886.png","http://curator-kim.github.io/2022/01/28/BUUOJ-Reverse-1/image-20220528212810447.png","http://curator-kim.github.io/2022/01/28/BUUOJ-Reverse-1/image-20220528212837593.png","http://curator-kim.github.io/2022/01/28/BUUOJ-Reverse-1/image-20220528213341784.png","http://curator-kim.github.io/2022/01/28/BUUOJ-Reverse-1/image-20220528222429471.png","http://curator-kim.github.io/2022/01/28/BUUOJ-Reverse-1/image-20220528234545090.png","http://curator-kim.github.io/2022/01/28/BUUOJ-Reverse-1/image-20220621143123237.png"],"datePublished":"2022-01-28T02:45:53.000Z","dateModified":"2022-12-26T15:40:54.474Z","author":{"@type":"Person","name":"Curator-Kim"},"description":"题目主要来自BUUOJ，少数其他来源 [toc] [CFI-CTF 2018]IntroToPE直接扔IDA，发现无法F5，转而查看汇编代码 在此处发现奇怪的Base64字符串，解码后得到flag:CFI{.NetC#_1s_@w3s0m3}"}</script><link rel="canonical" href="http://curator-kim.github.io/2022/01/28/BUUOJ-Reverse-1/"><link rel="icon" href="https://cdn.jsdelivr.net/gh/removeif/removeif-demo@latest/img/favicon.png"><meta name="referrer" content="no-referrer-when-downgrade"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/font-awesome/5.12.0/css/all.min.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/highlight.js/9.12.0/styles/atom-one-light.min.css"><link rel="stylesheet" href="https://fonts.loli.net/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/font-awesome/5.12.0/css/all.min.css"><link rel="stylesheet" href="https://fonts.loli.net/css?family=Ubuntu:400,600|Source+Code+Pro|Monda:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Microsoft YaHei:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&amp;amp;subset=latin,latin-ext|Inconsolata|Itim|Lobster.css"><script src="https://cdnjs.loli.net/ajax/libs/jquery/3.3.1/jquery.min.js"></script><script src="/js/globalUtils.js"></script><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><!--!--><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/lightgallery/1.6.8/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/justifiedGallery/3.7.0/css/justifiedGallery.min.css"><!--!--><!--!--><!--!--><script src="https://cdnjs.loli.net/ajax/libs/pace/1.0.2/pace.min.js"></script><link rel="stylesheet" href="/live2d/waifu.css"><script type="text/javascript" async src="/live2d/autoload.js"></script><meta name="generator" content="Hexo 5.4.0"></head><body class="is-3-column has-navbar-fixed-top"><nav class="navbar navbar-main is-fixed-top"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="https://github.com/Curator-Kim/Curator-Kim.github.io/blob/master/img/logo.png?raw=true" alt="Curator-Kim的小站" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a><a class="navbar-item" href="/album">Album</a><a class="navbar-item" href="/friend">Friend</a><a class="navbar-item" href="/message">Message</a><a class="navbar-item" href="/self-talking">Self-talking</a><a class="navbar-item" href="/music">Music</a><a class="navbar-item" href="/media">Media</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Join Gitter" href="https://gitter.im/hexo-theme-amazing/community"><i class="fab fa-gitter"></i></a><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/removeif/hexo-theme-amazing"><i class="fab fa-github"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="Catalogue" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a><a class="navbar-item" id="night-nav" title="Night Mode" href="javascript:;"><i class="fas fa-moon" id="night-icon"></i></a></div></div></div></nav><script type="text/javascript" src="/js/theme-setting.js"></script><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-9-widescreen"><!--!--><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><i class="far fa-calendar-plus"> </i>2022-01-28  <a class="commentCountImg" href="/2022/01/28/BUUOJ-Reverse-1/#comment-container"><span class="display-none-class">23f105c1a5aebc619a7ae9af53a700d7</span><i class="far fa-comment-dots"></i> <span class="commentCount" id="23f105c1a5aebc619a7ae9af53a700d7">99+</span>  </a><span class="level-item"><i class="far fa-clock"> </i>2 h  <i class="fas fa-pencil-alt"> </i>13.8 k</span><span class="level-item" id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span>&nbsp;visits</span></div></div><h1 class="title is-3 is-size-4-mobile">Reverse 刷题记录</h1><div class="content"><p>题目主要来自BUUOJ，少数其他来源</p>
<p>[toc]</p>
<h2 id="CFI-CTF-2018-IntroToPE"><a href="#CFI-CTF-2018-IntroToPE" class="headerlink" title="[CFI-CTF 2018]IntroToPE"></a>[CFI-CTF 2018]IntroToPE</h2><p>直接扔IDA，发现无法F5，转而查看汇编代码</p>
<p>在此处发现奇怪的Base64字符串，解码后得到flag:CFI{.NetC#_1s_@w3s0m3}</p>
<img src="/2022/01/28/BUUOJ-Reverse-1/image-20220128104747053.png" class title="image-20220128104747053">
<span id="more"></span>
<h2 id="WUSTCTF2020-funnyre"><a href="#WUSTCTF2020-funnyre" class="headerlink" title="[WUSTCTF2020]funnyre"></a>[WUSTCTF2020]funnyre</h2><p>拖进ida分析</p>
<img src="/2022/01/28/BUUOJ-Reverse-1/image-20220130212142440.png" class title="image-20220130212142440">
<p>点进main函数，发现无法反编译为c代码，继续看汇编指令</p>
<img src="/2022/01/28/BUUOJ-Reverse-1/image-20220130212235635.png" class title="image-20220130212235635">
<p>发现有奇怪的指令，有几条jz、jnz和call指令都指向了不存在的地址，导致了F5的失败</p>
<p>将它们还有下面的几处都nop掉，再p一下得到了能看的c代码</p>
<img src="/2022/01/28/BUUOJ-Reverse-1/image-20220130212510331.png" class title="image-20220130212510331">
<p>一千多行，不是人能做的，寄！</p>
<p>上网进行一个大佬的题解代码的抄，顺便了解了一下啥是符号执行（虽然还是不太懂</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> claripy</span><br><span class="line"></span><br><span class="line">p=angr.Project(<span class="string">&#x27;C:\\Users\\80424\\Downloads\\attachment&#x27;</span>,load_options=&#123;<span class="string">&quot;auto_load_libs&quot;</span>: <span class="literal">False</span>&#125;)</span><br><span class="line">f=p.factory</span><br><span class="line">state = f.entry_state(addr=<span class="number">0x400605</span>)<span class="comment">#设置state开始运行时的地址</span></span><br><span class="line">flag = claripy.BVS(<span class="string">&#x27;flag&#x27;</span>,<span class="number">8</span>*<span class="number">32</span>)<span class="comment">#要求的内容有32个，用BVS转成二进制给flag变量</span></span><br><span class="line">state.memory.store(<span class="number">0x603055</span>+<span class="number">0x300</span>+<span class="number">5</span>,flag)<span class="comment">#因为程序没有输入，所以直接把字符串设置到内存</span></span><br><span class="line">state.regs.rdx=<span class="number">0x603055</span>+<span class="number">0x300</span></span><br><span class="line">state.regs.rdi=<span class="number">0x603055</span>+<span class="number">0x300</span>+<span class="number">5</span><span class="comment">#然后设置两个寄存器</span></span><br><span class="line"></span><br><span class="line">sm = p.factory.simulation_manager(state)<span class="comment">#准备从state开始遍历路径</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;开始执行&quot;</span>)</span><br><span class="line"></span><br><span class="line">sm.explore(find=<span class="number">0x401DAE</span>)<span class="comment">#遍历到成功的地址</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> sm.found:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;执行成功&quot;</span>)</span><br><span class="line">    x=sm.found[<span class="number">0</span>].solver.<span class="built_in">eval</span>(flag,cast_to=<span class="built_in">bytes</span>)</span><br><span class="line">    <span class="built_in">print</span>(x)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;错误&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>得到flag:flag{1dc20f6e3d497d15cef47d9a66d6f1af}</p>
<p>最后附上符号执行的相关资料：</p>
<p><a target="_blank" rel="noopener" href="https://firmianay.gitbooks.io/ctf-all-in-one/content/doc/5.3_symbolic_execution.html">5.3 符号执行 · CTF All In One (gitbooks.io)</a></p>
<h2 id="羊城杯-2020-login"><a href="#羊城杯-2020-login" class="headerlink" title="[羊城杯 2020]login"></a>[羊城杯 2020]login</h2><p>下载附件，可以发现是python逆向题</p>
<p>使用pyinstxtractor整出.pyc文件</p>
<img src="/2022/01/28/BUUOJ-Reverse-1/image-20220201121719029.png" class title="image-20220201121719029">
<p>在解压出来的文件中发现login.pyc文件，使用010editor打开</p>
<img src="/2022/01/28/BUUOJ-Reverse-1/image-20220201121821195.png" class title="image-20220201121821195">
<p>打开struct.pyc文件，用该文件的前8字节替换login.pyc的前8字节，替换后的login.pyc文件如下</p>
<img src="/2022/01/28/BUUOJ-Reverse-1/image-20220201122023363.png" class title="image-20220201122023363">
<p>然后在线反编译pyc文件，得到login.py的代码</p>
<p><a target="_blank" rel="noopener" href="https://tool.lu/pyc/">python反编译 - 在线工具 (tool.lu)</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># visit https://tool.lu/pyc/ for more information</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">input1 = <span class="built_in">input</span>(<span class="string">&#x27;input something:&#x27;</span>)</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(input1) != <span class="number">14</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Wrong length!&#x27;</span>)</span><br><span class="line">    sys.exit()</span><br><span class="line">code = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">13</span>):</span><br><span class="line">    code.append(<span class="built_in">ord</span>(input1[i]) ^ <span class="built_in">ord</span>(input1[i + <span class="number">1</span>]))</span><br><span class="line"></span><br><span class="line">code.append(<span class="built_in">ord</span>(input1[<span class="number">13</span>]))</span><br><span class="line">a1 = code[<span class="number">2</span>]</span><br><span class="line">a2 = code[<span class="number">1</span>]</span><br><span class="line">a3 = code[<span class="number">0</span>]</span><br><span class="line">a4 = code[<span class="number">3</span>]</span><br><span class="line">a5 = code[<span class="number">4</span>]</span><br><span class="line">a6 = code[<span class="number">5</span>]</span><br><span class="line">a7 = code[<span class="number">6</span>]</span><br><span class="line">a8 = code[<span class="number">7</span>]</span><br><span class="line">a9 = code[<span class="number">9</span>]</span><br><span class="line">a10 = code[<span class="number">8</span>]</span><br><span class="line">a11 = code[<span class="number">10</span>]</span><br><span class="line">a12 = code[<span class="number">11</span>]</span><br><span class="line">a13 = code[<span class="number">12</span>]</span><br><span class="line">a14 = code[<span class="number">13</span>]</span><br><span class="line"><span class="keyword">if</span> ((((a1 * <span class="number">88</span> + a2 * <span class="number">67</span> + a3 * <span class="number">65</span> - a4 * <span class="number">5</span>) + a5 * <span class="number">43</span> + a6 * <span class="number">89</span> + a7 * <span class="number">25</span> + a8 * <span class="number">13</span> - a9 * <span class="number">36</span>) + a10 * <span class="number">15</span> + a11 * <span class="number">11</span> + a12 * <span class="number">47</span> - a13 * <span class="number">60</span>) + a14 * <span class="number">29</span> == <span class="number">22748</span>) &amp; ((((a1 * <span class="number">89</span> + a2 * <span class="number">7</span> + a3 * <span class="number">12</span> - a4 * <span class="number">25</span>) + a5 * <span class="number">41</span> + a6 * <span class="number">23</span> + a7 * <span class="number">20</span> - a8 * <span class="number">66</span>) + a9 * <span class="number">31</span> + a10 * <span class="number">8</span> + a11 * <span class="number">2</span> - a12 * <span class="number">41</span> - a13 * <span class="number">39</span>) + a14 * <span class="number">17</span> == <span class="number">7258</span>) &amp; ((((a1 * <span class="number">28</span> + a2 * <span class="number">35</span> + a3 * <span class="number">16</span> - a4 * <span class="number">65</span>) + a5 * <span class="number">53</span> + a6 * <span class="number">39</span> + a7 * <span class="number">27</span> + a8 * <span class="number">15</span> - a9 * <span class="number">33</span>) + a10 * <span class="number">13</span> + a11 * <span class="number">101</span> + a12 * <span class="number">90</span> - a13 * <span class="number">34</span>) + a14 * <span class="number">23</span> == <span class="number">26190</span>) &amp; ((((a1 * <span class="number">23</span> + a2 * <span class="number">34</span> + a3 * <span class="number">35</span> - a4 * <span class="number">59</span>) + a5 * <span class="number">49</span> + a6 * <span class="number">81</span> + a7 * <span class="number">25</span> + (a8 &lt;&lt; <span class="number">7</span>) - a9 * <span class="number">32</span>) + a10 * <span class="number">75</span> + a11 * <span class="number">81</span> + a12 * <span class="number">47</span> - a13 * <span class="number">60</span>) + a14 * <span class="number">29</span> == <span class="number">37136</span>) &amp; (((a1 * <span class="number">38</span> + a2 * <span class="number">97</span> + a3 * <span class="number">35</span> - a4 * <span class="number">52</span>) + a5 * <span class="number">42</span> + a6 * <span class="number">79</span> + a7 * <span class="number">90</span> + a8 * <span class="number">23</span> - a9 * <span class="number">36</span>) + a10 * <span class="number">57</span> + a11 * <span class="number">81</span> + a12 * <span class="number">42</span> - a13 * <span class="number">62</span> - a14 * <span class="number">11</span> == <span class="number">27915</span>) &amp; ((((a1 * <span class="number">22</span> + a2 * <span class="number">27</span> + a3 * <span class="number">35</span> - a4 * <span class="number">45</span>) + a5 * <span class="number">47</span> + a6 * <span class="number">49</span> + a7 * <span class="number">29</span> + a8 * <span class="number">18</span> - a9 * <span class="number">26</span>) + a10 * <span class="number">35</span> + a11 * <span class="number">41</span> + a12 * <span class="number">40</span> - a13 * <span class="number">61</span>) + a14 * <span class="number">28</span> == <span class="number">17298</span>) &amp; ((((a1 * <span class="number">12</span> + a2 * <span class="number">45</span> + a3 * <span class="number">35</span> - a4 * <span class="number">9</span> - a5 * <span class="number">42</span>) + a6 * <span class="number">86</span> + a7 * <span class="number">23</span> + a8 * <span class="number">85</span> - a9 * <span class="number">47</span>) + a10 * <span class="number">34</span> + a11 * <span class="number">76</span> + a12 * <span class="number">43</span> - a13 * <span class="number">44</span>) + a14 * <span class="number">65</span> == <span class="number">19875</span>) &amp; (((a1 * <span class="number">79</span> + a2 * <span class="number">62</span> + a3 * <span class="number">35</span> - a4 * <span class="number">85</span>) + a5 * <span class="number">33</span> + a6 * <span class="number">79</span> + a7 * <span class="number">86</span> + a8 * <span class="number">14</span> - a9 * <span class="number">30</span>) + a10 * <span class="number">25</span> + a11 * <span class="number">11</span> + a12 * <span class="number">57</span> - a13 * <span class="number">50</span> - a14 * <span class="number">9</span> == <span class="number">22784</span>) &amp; ((((a1 * <span class="number">8</span> + a2 * <span class="number">6</span> + a3 * <span class="number">64</span> - a4 * <span class="number">85</span>) + a5 * <span class="number">73</span> + a6 * <span class="number">29</span> + a7 * <span class="number">2</span> + a8 * <span class="number">23</span> - a9 * <span class="number">36</span>) + a10 * <span class="number">5</span> + a11 * <span class="number">2</span> + a12 * <span class="number">47</span> - a13 * <span class="number">64</span>) + a14 * <span class="number">27</span> == <span class="number">9710</span>) &amp; (((((a1 * <span class="number">67</span> - a2 * <span class="number">68</span>) + a3 * <span class="number">68</span> - a4 * <span class="number">51</span> - a5 * <span class="number">43</span>) + a6 * <span class="number">81</span> + a7 * <span class="number">22</span> - a8 * <span class="number">12</span> - a9 * <span class="number">38</span>) + a10 * <span class="number">75</span> + a11 * <span class="number">41</span> + a12 * <span class="number">27</span> - a13 * <span class="number">52</span>) + a14 * <span class="number">31</span> == <span class="number">13376</span>) &amp; ((((a1 * <span class="number">85</span> + a2 * <span class="number">63</span> + a3 * <span class="number">5</span> - a4 * <span class="number">51</span>) + a5 * <span class="number">44</span> + a6 * <span class="number">36</span> + a7 * <span class="number">28</span> + a8 * <span class="number">15</span> - a9 * <span class="number">6</span>) + a10 * <span class="number">45</span> + a11 * <span class="number">31</span> + a12 * <span class="number">7</span> - a13 * <span class="number">67</span>) + a14 * <span class="number">78</span> == <span class="number">24065</span>) &amp; ((((a1 * <span class="number">47</span> + a2 * <span class="number">64</span> + a3 * <span class="number">66</span> - a4 * <span class="number">5</span>) + a5 * <span class="number">43</span> + a6 * <span class="number">112</span> + a7 * <span class="number">25</span> + a8 * <span class="number">13</span> - a9 * <span class="number">35</span>) + a10 * <span class="number">95</span> + a11 * <span class="number">21</span> + a12 * <span class="number">43</span> - a13 * <span class="number">61</span>) + a14 * <span class="number">20</span> == <span class="number">27687</span>) &amp; (((a1 * <span class="number">89</span> + a2 * <span class="number">67</span> + a3 * <span class="number">85</span> - a4 * <span class="number">25</span>) + a5 * <span class="number">49</span> + a6 * <span class="number">89</span> + a7 * <span class="number">23</span> + a8 * <span class="number">56</span> - a9 * <span class="number">92</span>) + a10 * <span class="number">14</span> + a11 * <span class="number">89</span> + a12 * <span class="number">47</span> - a13 * <span class="number">61</span> - a14 * <span class="number">29</span> == <span class="number">29250</span>) &amp; (((a1 * <span class="number">95</span> + a2 * <span class="number">34</span> + a3 * <span class="number">62</span> - a4 * <span class="number">9</span> - a5 * <span class="number">43</span>) + a6 * <span class="number">83</span> + a7 * <span class="number">25</span> + a8 * <span class="number">12</span> - a9 * <span class="number">36</span>) + a10 * <span class="number">16</span> + a11 * <span class="number">51</span> + a12 * <span class="number">47</span> - a13 * <span class="number">60</span> - a14 * <span class="number">24</span> == <span class="number">15317</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;flag is GWHT&#123;md5(your_input)&#125;&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Congratulations and have fun!&#x27;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Sorry,plz try again...&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>然后就是解方程</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sympy <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line">a1=symbols(<span class="string">&#x27;a1&#x27;</span>)</span><br><span class="line">a2=symbols(<span class="string">&#x27;a2&#x27;</span>)</span><br><span class="line">a3=symbols(<span class="string">&#x27;a3&#x27;</span>)</span><br><span class="line">a4=symbols(<span class="string">&#x27;a4&#x27;</span>)</span><br><span class="line">a5=symbols(<span class="string">&#x27;a5&#x27;</span>)</span><br><span class="line">a6=symbols(<span class="string">&#x27;a6&#x27;</span>)</span><br><span class="line">a7=symbols(<span class="string">&#x27;a7&#x27;</span>)</span><br><span class="line">a8=symbols(<span class="string">&#x27;a8&#x27;</span>)</span><br><span class="line">a9=symbols(<span class="string">&#x27;a9&#x27;</span>)</span><br><span class="line">a10=symbols(<span class="string">&#x27;a10&#x27;</span>)</span><br><span class="line">a11=symbols(<span class="string">&#x27;a11&#x27;</span>)</span><br><span class="line">a12=symbols(<span class="string">&#x27;a12&#x27;</span>)</span><br><span class="line">a13=symbols(<span class="string">&#x27;a13&#x27;</span>)</span><br><span class="line">a14=symbols(<span class="string">&#x27;a14&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(solve([</span><br><span class="line">((((a1 * <span class="number">88</span> + a2 * <span class="number">67</span> + a3 * <span class="number">65</span> - a4 * <span class="number">5</span>) + a5 * <span class="number">43</span> + a6 * <span class="number">89</span> + a7 * <span class="number">25</span> + a8 * <span class="number">13</span> - a9 * <span class="number">36</span>) + a10 * <span class="number">15</span> + a11 * <span class="number">11</span> + a12 * <span class="number">47</span> - a13 * <span class="number">60</span>) + a14 * <span class="number">29</span> - <span class="number">22748</span>), </span><br><span class="line">((((a1 * <span class="number">89</span> + a2 * <span class="number">7</span> + a3 * <span class="number">12</span> - a4 * <span class="number">25</span>) + a5 * <span class="number">41</span> + a6 * <span class="number">23</span> + a7 * <span class="number">20</span> - a8 * <span class="number">66</span>) + a9 * <span class="number">31</span> + a10 * <span class="number">8</span> + a11 * <span class="number">2</span> - a12 * <span class="number">41</span> - a13 * <span class="number">39</span>) + a14 * <span class="number">17</span> - <span class="number">7258</span>) ,</span><br><span class="line">((((a1 * <span class="number">28</span> + a2 * <span class="number">35</span> + a3 * <span class="number">16</span> - a4 * <span class="number">65</span>) + a5 * <span class="number">53</span> + a6 * <span class="number">39</span> + a7 * <span class="number">27</span> + a8 * <span class="number">15</span> - a9 * <span class="number">33</span>) + a10 * <span class="number">13</span> + a11 * <span class="number">101</span> + a12 * <span class="number">90</span> - a13 * <span class="number">34</span>) + a14 * <span class="number">23</span> - <span class="number">26190</span>) ,</span><br><span class="line">((((a1 * <span class="number">23</span> + a2 * <span class="number">34</span> + a3 * <span class="number">35</span> - a4 * <span class="number">59</span>) + a5 * <span class="number">49</span> + a6 * <span class="number">81</span> + a7 * <span class="number">25</span> + (a8 * <span class="built_in">pow</span>(<span class="number">2</span>,<span class="number">7</span>)) - a9 * <span class="number">32</span>) + a10 * <span class="number">75</span> + a11 * <span class="number">81</span> + a12 * <span class="number">47</span> - a13 * <span class="number">60</span>) + a14 * <span class="number">29</span> - <span class="number">37136</span>) ,</span><br><span class="line">(((a1 * <span class="number">38</span> + a2 * <span class="number">97</span> + a3 * <span class="number">35</span> - a4 * <span class="number">52</span>) + a5 * <span class="number">42</span> + a6 * <span class="number">79</span> + a7 * <span class="number">90</span> + a8 * <span class="number">23</span> - a9 * <span class="number">36</span>) + a10 * <span class="number">57</span> + a11 * <span class="number">81</span> + a12 * <span class="number">42</span> - a13 * <span class="number">62</span> - a14 * <span class="number">11</span> - <span class="number">27915</span>) ,</span><br><span class="line">((((a1 * <span class="number">22</span> + a2 * <span class="number">27</span> + a3 * <span class="number">35</span> - a4 * <span class="number">45</span>) + a5 * <span class="number">47</span> + a6 * <span class="number">49</span> + a7 * <span class="number">29</span> + a8 * <span class="number">18</span> - a9 * <span class="number">26</span>) + a10 * <span class="number">35</span> + a11 * <span class="number">41</span> + a12 * <span class="number">40</span> - a13 * <span class="number">61</span>) + a14 * <span class="number">28</span> - <span class="number">17298</span>) ,</span><br><span class="line">((((a1 * <span class="number">12</span> + a2 * <span class="number">45</span> + a3 * <span class="number">35</span> - a4 * <span class="number">9</span> - a5 * <span class="number">42</span>) + a6 * <span class="number">86</span> + a7 * <span class="number">23</span> + a8 * <span class="number">85</span> - a9 * <span class="number">47</span>) + a10 * <span class="number">34</span> + a11 * <span class="number">76</span> + a12 * <span class="number">43</span> - a13 * <span class="number">44</span>) + a14 * <span class="number">65</span> - <span class="number">19875</span>) ,</span><br><span class="line">(((a1 * <span class="number">79</span> + a2 * <span class="number">62</span> + a3 * <span class="number">35</span> - a4 * <span class="number">85</span>) + a5 * <span class="number">33</span> + a6 * <span class="number">79</span> + a7 * <span class="number">86</span> + a8 * <span class="number">14</span> - a9 * <span class="number">30</span>) + a10 * <span class="number">25</span> + a11 * <span class="number">11</span> + a12 * <span class="number">57</span> - a13 * <span class="number">50</span> - a14 * <span class="number">9</span> - <span class="number">22784</span>) ,</span><br><span class="line">((((a1 * <span class="number">8</span> + a2 * <span class="number">6</span> + a3 * <span class="number">64</span> - a4 * <span class="number">85</span>) + a5 * <span class="number">73</span> + a6 * <span class="number">29</span> + a7 * <span class="number">2</span> + a8 * <span class="number">23</span> - a9 * <span class="number">36</span>) + a10 * <span class="number">5</span> + a11 * <span class="number">2</span> + a12 * <span class="number">47</span> - a13 * <span class="number">64</span>) + a14 * <span class="number">27</span> - <span class="number">9710</span>) ,</span><br><span class="line">(((((a1 * <span class="number">67</span> - a2 * <span class="number">68</span>) + a3 * <span class="number">68</span> - a4 * <span class="number">51</span> - a5 * <span class="number">43</span>) + a6 * <span class="number">81</span> + a7 * <span class="number">22</span> - a8 * <span class="number">12</span> - a9 * <span class="number">38</span>) + a10 * <span class="number">75</span> + a11 * <span class="number">41</span> + a12 * <span class="number">27</span> - a13 * <span class="number">52</span>) + a14 * <span class="number">31</span> - <span class="number">13376</span>) ,</span><br><span class="line">((((a1 * <span class="number">85</span> + a2 * <span class="number">63</span> + a3 * <span class="number">5</span> - a4 * <span class="number">51</span>) + a5 * <span class="number">44</span> + a6 * <span class="number">36</span> + a7 * <span class="number">28</span> + a8 * <span class="number">15</span> - a9 * <span class="number">6</span>) + a10 * <span class="number">45</span> + a11 * <span class="number">31</span> + a12 * <span class="number">7</span> - a13 * <span class="number">67</span>) + a14 * <span class="number">78</span> - <span class="number">24065</span>) ,</span><br><span class="line">((((a1 * <span class="number">47</span> + a2 * <span class="number">64</span> + a3 * <span class="number">66</span> - a4 * <span class="number">5</span>) + a5 * <span class="number">43</span> + a6 * <span class="number">112</span> + a7 * <span class="number">25</span> + a8 * <span class="number">13</span> - a9 * <span class="number">35</span>) + a10 * <span class="number">95</span> + a11 * <span class="number">21</span> + a12 * <span class="number">43</span> - a13 * <span class="number">61</span>) + a14 * <span class="number">20</span> - <span class="number">27687</span>) ,</span><br><span class="line">(((a1 * <span class="number">89</span> + a2 * <span class="number">67</span> + a3 * <span class="number">85</span> - a4 * <span class="number">25</span>) + a5 * <span class="number">49</span> + a6 * <span class="number">89</span> + a7 * <span class="number">23</span> + a8 * <span class="number">56</span> - a9 * <span class="number">92</span>) + a10 * <span class="number">14</span> + a11 * <span class="number">89</span> + a12 * <span class="number">47</span> - a13 * <span class="number">61</span> - a14 * <span class="number">29</span> - <span class="number">29250</span>) ,</span><br><span class="line">(((a1 * <span class="number">95</span> + a2 * <span class="number">34</span> + a3 * <span class="number">62</span> - a4 * <span class="number">9</span> - a5 * <span class="number">43</span>) + a6 * <span class="number">83</span> + a7 * <span class="number">25</span> + a8 * <span class="number">12</span> - a9 * <span class="number">36</span>) + a10 * <span class="number">16</span> + a11 * <span class="number">51</span> + a12 * <span class="number">47</span> - a13 * <span class="number">60</span> - a14 * <span class="number">24</span> - <span class="number">15317</span>)],</span><br><span class="line">[a1,a2,a3,a4,a5,a6,a7,a8,a9,a10,a11,a12,a13,a14]))</span><br></pre></td></tr></table></figure>
<p>得到结果：{a1: 119, a2: 24, a3: 10, a4: 7, a5: 104, a6: 43, a7: 28, a8: 91, a9: 52, a10: 108, a11: 88, a12: 74, a13: 88, a14: 33}</p>
<p>由于原输入和$a_i$ 不是一一对应的，需要稍微调整一下，然后在进行一个异或，最后md5一下就出来Flag了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line">input1=[<span class="number">10</span>,<span class="number">24</span>,<span class="number">119</span>,<span class="number">7</span>,<span class="number">104</span>,<span class="number">43</span>,<span class="number">28</span>,<span class="number">91</span>,<span class="number">108</span>,<span class="number">52</span>,<span class="number">88</span>,<span class="number">74</span>,<span class="number">88</span>,<span class="number">33</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">12</span>,-<span class="number">1</span>,-<span class="number">1</span>):</span><br><span class="line">    input1[i]^=input1[i+<span class="number">1</span>]</span><br><span class="line"><span class="built_in">print</span>(input1)</span><br><span class="line">flag=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> input1:</span><br><span class="line">    flag+=<span class="built_in">chr</span>(i)</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(flag))</span><br><span class="line">h=hashlib.md5()</span><br><span class="line">h.update(flag.encode())</span><br><span class="line"><span class="built_in">print</span>(h.hexdigest())</span><br></pre></td></tr></table></figure>
<p>flag{58964088b637e50d3a22b9510c1d1ef8}</p>
<h2 id="QCTF2018-Xman-babymips"><a href="#QCTF2018-Xman-babymips" class="headerlink" title="[QCTF2018]Xman-babymips"></a>[QCTF2018]Xman-babymips</h2><p>拖进ida，进到主函数，程序结构也比较简单</p>
<img src="/2022/01/28/BUUOJ-Reverse-1/image-20220201134316497-16436941972091.png" class title="image-20220201134316497">
<!--more-->
<p>一开始先进行逐字节的异或处理</p>
<img src="/2022/01/28/BUUOJ-Reverse-1/image-20220201134351940.png" class title="image-20220201134351940">
<p>然后是一个循环移位的操作，然后与off_410D04指向的数组中的值比较一下得到结果</p>
<img src="/2022/01/28/BUUOJ-Reverse-1/image-20220201134505470.png" class title="image-20220201134505470">
<p>解题思路很简单，直接逆就行了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">move1</span>(<span class="params">num</span>):</span></span><br><span class="line">    <span class="keyword">return</span> (num&gt;&gt;<span class="number">6</span>)|(num&lt;&lt;<span class="number">2</span>)&amp;<span class="number">0xff</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">move2</span>(<span class="params">num</span>):</span></span><br><span class="line">    <span class="keyword">return</span> (num&gt;&gt;<span class="number">2</span>)|(num&lt;&lt;<span class="number">6</span>)&amp;<span class="number">0xff</span></span><br><span class="line"><span class="built_in">str</span>=<span class="string">&#x27;Q|j&#123;g&#x27;</span></span><br><span class="line">flag=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">    flag+=<span class="built_in">chr</span>(<span class="built_in">ord</span>(<span class="built_in">str</span>[i])^(<span class="number">32</span>-i))</span><br><span class="line">t=[<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0x52</span>,<span class="number">0xfd</span>,<span class="number">0x16</span>,<span class="number">0xa4</span>,<span class="number">0x89</span>,<span class="number">0xbd</span>,<span class="number">0x92</span>,<span class="number">0x80</span>,<span class="number">0x13</span>,<span class="number">0x41</span>,<span class="number">0x54</span>,<span class="number">0xa0</span>,<span class="number">0x8d</span>,<span class="number">0x45</span>,<span class="number">0x18</span>,<span class="number">0x81</span>,<span class="number">0xde</span>,<span class="number">0xfc</span>,<span class="number">0x95</span>,<span class="number">0xf0</span>,<span class="number">0x16</span>,<span class="number">0x79</span>,<span class="number">0x1a</span>,<span class="number">0x15</span>,<span class="number">0x5b</span>,<span class="number">0x75</span>,<span class="number">0x1f</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>,<span class="number">32</span>):</span><br><span class="line">    <span class="keyword">if</span> i&amp;<span class="number">1</span>==<span class="number">1</span>:</span><br><span class="line">        flag+=<span class="built_in">chr</span>(move1(t[i])^(<span class="number">32</span>-i))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        flag+=<span class="built_in">chr</span>(move2(t[i])^(<span class="number">32</span>-i))</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>
<p>qctf{ReA11y_4_B@89_mlp5_4_XmAn_}</p>
<h2 id="SCTF2019-babyre"><a href="#SCTF2019-babyre" class="headerlink" title="[SCTF2019]babyre"></a>[SCTF2019]babyre</h2><p>拖进ida</p>
<img src="/2022/01/28/BUUOJ-Reverse-1/image-20220208123607139.png" class title="image-20220208123607139">
<p>发现一堆汇编代码，不能f5，大概是有花指令</p>
<p>按P声明函数，控制台显示有未定义指令，双击该地址进行去花</p>
<img src="/2022/01/28/BUUOJ-Reverse-1/image-20220208123843144.png" class title="image-20220208123843144">
<img src="/2022/01/28/BUUOJ-Reverse-1/image-20220208123903027.png" class title="image-20220208123903027">
<p>依次去了几处后就能反编译出Main函数了</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 __fastcall <span class="title">main</span><span class="params">(<span class="keyword">int</span> a1, <span class="keyword">char</span> **a2, <span class="keyword">char</span> **a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line">  <span class="keyword">char</span> v4; <span class="comment">// [rsp+Fh] [rbp-151h]</span></span><br><span class="line">  <span class="keyword">int</span> v5; <span class="comment">// [rsp+10h] [rbp-150h]</span></span><br><span class="line">  <span class="keyword">int</span> v6; <span class="comment">// [rsp+14h] [rbp-14Ch]</span></span><br><span class="line">  <span class="keyword">char</span> *v7; <span class="comment">// [rsp+18h] [rbp-148h]</span></span><br><span class="line">  <span class="keyword">char</span> v8[<span class="number">10</span>]; <span class="comment">// [rsp+26h] [rbp-13Ah] BYREF</span></span><br><span class="line">  _QWORD v9[<span class="number">2</span>]; <span class="comment">// [rsp+30h] [rbp-130h] BYREF</span></span><br><span class="line">  <span class="keyword">int</span> v10; <span class="comment">// [rsp+40h] [rbp-120h]</span></span><br><span class="line">  __int64 v11[<span class="number">3</span>]; <span class="comment">// [rsp+50h] [rbp-110h] BYREF</span></span><br><span class="line">  <span class="keyword">char</span> v12; <span class="comment">// [rsp+68h] [rbp-F8h]</span></span><br><span class="line">  __int64 v13[<span class="number">3</span>]; <span class="comment">// [rsp+70h] [rbp-F0h] BYREF</span></span><br><span class="line">  <span class="keyword">char</span> v14; <span class="comment">// [rsp+88h] [rbp-D8h]</span></span><br><span class="line">  __int64 v15[<span class="number">6</span>]; <span class="comment">// [rsp+90h] [rbp-D0h] BYREF</span></span><br><span class="line">  __int16 v16; <span class="comment">// [rsp+C0h] [rbp-A0h]</span></span><br><span class="line">  <span class="keyword">char</span> v17[<span class="number">136</span>]; <span class="comment">// [rsp+D0h] [rbp-90h] BYREF</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v18; <span class="comment">// [rsp+158h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v18 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  v5 = <span class="number">0</span>;</span><br><span class="line">  v11[<span class="number">0</span>] = <span class="number">0LL</span>;</span><br><span class="line">  v11[<span class="number">1</span>] = <span class="number">0LL</span>;</span><br><span class="line">  v11[<span class="number">2</span>] = <span class="number">0LL</span>;</span><br><span class="line">  v12 = <span class="number">0</span>;</span><br><span class="line">  v13[<span class="number">0</span>] = <span class="number">0LL</span>;</span><br><span class="line">  v13[<span class="number">1</span>] = <span class="number">0LL</span>;</span><br><span class="line">  v13[<span class="number">2</span>] = <span class="number">0LL</span>;</span><br><span class="line">  v14 = <span class="number">0</span>;</span><br><span class="line">  v15[<span class="number">0</span>] = <span class="number">0LL</span>;</span><br><span class="line">  v15[<span class="number">1</span>] = <span class="number">0LL</span>;</span><br><span class="line">  v15[<span class="number">2</span>] = <span class="number">0LL</span>;</span><br><span class="line">  v15[<span class="number">3</span>] = <span class="number">0LL</span>;</span><br><span class="line">  v15[<span class="number">4</span>] = <span class="number">0LL</span>;</span><br><span class="line">  v15[<span class="number">5</span>] = <span class="number">0LL</span>;</span><br><span class="line">  v16 = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">strcpy</span>(</span><br><span class="line">    v17,</span><br><span class="line">    <span class="string">&quot;**************.****.**s..*..******.****.***********..***..**..#*..***..***.********************.**..*******..**...*..*.*.**.*&quot;</span>);</span><br><span class="line">  v9[<span class="number">0</span>] = <span class="number">0LL</span>;</span><br><span class="line">  v9[<span class="number">1</span>] = <span class="number">0LL</span>;</span><br><span class="line">  v10 = <span class="number">0</span>;</span><br><span class="line">  v7 = &amp;v17[<span class="number">22</span>];</span><br><span class="line">  <span class="built_in">strcpy</span>(v8, <span class="string">&quot;sctf_9102&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>((<span class="keyword">const</span> <span class="keyword">char</span> *)(<span class="keyword">unsigned</span> <span class="keyword">int</span>)<span class="string">&quot;plz tell me the shortest password1:&quot;</span>);</span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, v15);</span><br><span class="line">  v6 = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">while</span> ( v6 )</span><br><span class="line">  &#123;</span><br><span class="line">    v4 = *((_BYTE *)v15 + v5);</span><br><span class="line">    <span class="keyword">switch</span> ( v4 )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;w&#x27;</span>:</span><br><span class="line">        v7 -= <span class="number">5</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;s&#x27;</span>:</span><br><span class="line">        v7 += <span class="number">5</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;d&#x27;</span>:</span><br><span class="line">        ++v7;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;a&#x27;</span>:</span><br><span class="line">        --v7;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;x&#x27;</span>:</span><br><span class="line">        v7 += <span class="number">25</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;y&#x27;</span>:</span><br><span class="line">        v7 -= <span class="number">25</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        v6 = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    ++v5;</span><br><span class="line">    <span class="keyword">if</span> ( *v7 != <span class="number">46</span> &amp;&amp; *v7 != <span class="number">35</span> )</span><br><span class="line">      v6 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> ( *v7 == <span class="number">35</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;good!you find the right way!\nBut there is another challenge!&quot;</span>);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( v6 )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>((<span class="keyword">const</span> <span class="keyword">char</span> *)(<span class="keyword">unsigned</span> <span class="keyword">int</span>)<span class="string">&quot;plz tell me the password2:&quot;</span>);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, v11);</span><br><span class="line">    ((<span class="keyword">void</span> (__fastcall *)(__int64 *, __int64 *))loc_C22)(v11, v13);</span><br><span class="line">    <span class="keyword">if</span> ( (<span class="keyword">unsigned</span> <span class="keyword">int</span>)sub_F67(v13, v8) == <span class="number">1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;Congratulation!&quot;</span>);</span><br><span class="line">      <span class="built_in">puts</span>((<span class="keyword">const</span> <span class="keyword">char</span> *)(<span class="keyword">unsigned</span> <span class="keyword">int</span>)<span class="string">&quot;Now,this is the last!&quot;</span>);</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;plz tell me the password3:&quot;</span>);</span><br><span class="line">      <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, v9);</span><br><span class="line">      <span class="keyword">if</span> ( (<span class="keyword">unsigned</span> <span class="keyword">int</span>)sub_FFA(v9) == <span class="number">1</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;Congratulation!Here is your flag!:&quot;</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;sctf&#123;%s-%s(%s)&#125;&quot;</span>, (<span class="keyword">const</span> <span class="keyword">char</span> *)v15, (<span class="keyword">const</span> <span class="keyword">char</span> *)v11, (<span class="keyword">const</span> <span class="keyword">char</span> *)v9);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;something srong...&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      result = <span class="number">0LL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;sorry,somthing wrong...&quot;</span>);</span><br><span class="line">      result = <span class="number">0LL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;sorry,is&#x27;t not a right way...&quot;</span>);</span><br><span class="line">    result = <span class="number">0LL</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>观察代码，大概是一个5*25的迷宫题,wasd分别为上下左右，还有xy为向上或向下跳5行，起点位于s处</p>
<p>第一个循环的路大概是sxss</p>
<img src="/2022/01/28/BUUOJ-Reverse-1/image-20220208124245456.png" class title="image-20220208124245456">
<p>接下来还有Password2，继续分析，进到loc_c22中查看</p>
<p>按p声明函数，控制台发现地址e1c处有未识别的数据：</p>
<img src="/2022/01/28/BUUOJ-Reverse-1/image-20220208124410741.png" class title="image-20220208124410741">
<p>按c转换为代码</p>
<img src="/2022/01/28/BUUOJ-Reverse-1/image-20220208124435216.png" class title="image-20220208124435216">
<p>然后在各种标红的地方还有一些奇怪的跳转处nop掉指令，最终成功能f5</p>
<p>然后第二部分是一个base64的解码</p>
<img src="/2022/01/28/BUUOJ-Reverse-1/image-20220208131808405.png" class title="image-20220208131808405">
<p>password2为c2N0Zl85MTAy</p>
<p>然后进到password3</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 __fastcall <span class="title">sub_FFA</span><span class="params">(<span class="keyword">char</span> *input3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v2; <span class="comment">// [rsp+18h] [rbp-158h]</span></span><br><span class="line">  <span class="keyword">int</span> i; <span class="comment">// [rsp+18h] [rbp-158h]</span></span><br><span class="line">  <span class="keyword">int</span> v4; <span class="comment">// [rsp+1Ch] [rbp-154h]</span></span><br><span class="line">  <span class="keyword">int</span> v5; <span class="comment">// [rsp+24h] [rbp-14Ch]</span></span><br><span class="line">  <span class="keyword">int</span> v6; <span class="comment">// [rsp+28h] [rbp-148h]</span></span><br><span class="line">  <span class="keyword">int</span> v7; <span class="comment">// [rsp+2Ch] [rbp-144h]</span></span><br><span class="line">  <span class="keyword">int</span> v8[<span class="number">16</span>]; <span class="comment">// [rsp+30h] [rbp-140h]</span></span><br><span class="line">  <span class="keyword">int</span> v9[<span class="number">16</span>]; <span class="comment">// [rsp+70h] [rbp-100h]</span></span><br><span class="line">  <span class="keyword">int</span> v10[<span class="number">26</span>]; <span class="comment">// [rsp+B0h] [rbp-C0h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v11; <span class="comment">// [rsp+118h] [rbp-58h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v12; <span class="comment">// [rsp+11Ch] [rbp-54h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v13; <span class="comment">// [rsp+120h] [rbp-50h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v14; <span class="comment">// [rsp+124h] [rbp-4Ch]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v15; <span class="comment">// [rsp+168h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v15 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  v8[<span class="number">0</span>] = <span class="number">190</span>;</span><br><span class="line">  v8[<span class="number">1</span>] = <span class="number">4</span>;</span><br><span class="line">  v8[<span class="number">2</span>] = <span class="number">6</span>;</span><br><span class="line">  v8[<span class="number">3</span>] = <span class="number">128</span>;</span><br><span class="line">  v8[<span class="number">4</span>] = <span class="number">197</span>;</span><br><span class="line">  v8[<span class="number">5</span>] = <span class="number">175</span>;</span><br><span class="line">  v8[<span class="number">6</span>] = <span class="number">118</span>;</span><br><span class="line">  v8[<span class="number">7</span>] = <span class="number">71</span>;</span><br><span class="line">  v8[<span class="number">8</span>] = <span class="number">159</span>;</span><br><span class="line">  v8[<span class="number">9</span>] = <span class="number">204</span>;</span><br><span class="line">  v8[<span class="number">10</span>] = <span class="number">64</span>;</span><br><span class="line">  v8[<span class="number">11</span>] = <span class="number">31</span>;</span><br><span class="line">  v8[<span class="number">12</span>] = <span class="number">216</span>;</span><br><span class="line">  v8[<span class="number">13</span>] = <span class="number">191</span>;</span><br><span class="line">  v8[<span class="number">14</span>] = <span class="number">146</span>;</span><br><span class="line">  v8[<span class="number">15</span>] = <span class="number">239</span>;</span><br><span class="line">  v5 = (input3[<span class="number">6</span>] &lt;&lt; <span class="number">8</span>) | (input3[<span class="number">5</span>] &lt;&lt; <span class="number">16</span>) | (input3[<span class="number">4</span>] &lt;&lt; <span class="number">24</span>) | input3[<span class="number">7</span>];</span><br><span class="line">  v6 = (input3[<span class="number">10</span>] &lt;&lt; <span class="number">8</span>) | (input3[<span class="number">9</span>] &lt;&lt; <span class="number">16</span>) | (input3[<span class="number">8</span>] &lt;&lt; <span class="number">24</span>) | input3[<span class="number">11</span>];</span><br><span class="line">  v7 = (input3[<span class="number">14</span>] &lt;&lt; <span class="number">8</span>) | (input3[<span class="number">13</span>] &lt;&lt; <span class="number">16</span>) | (input3[<span class="number">12</span>] &lt;&lt; <span class="number">24</span>) | input3[<span class="number">15</span>];</span><br><span class="line">  v4 = <span class="number">0</span>;</span><br><span class="line">  v2 = <span class="number">4</span>;</span><br><span class="line">  v10[<span class="number">0</span>] = sub_78A((input3[<span class="number">2</span>] &lt;&lt; <span class="number">8</span>) | (input3[<span class="number">1</span>] &lt;&lt; <span class="number">16</span>) | (*input3 &lt;&lt; <span class="number">24</span>) | (<span class="keyword">unsigned</span> <span class="keyword">int</span>)input3[<span class="number">3</span>]);</span><br><span class="line">  v10[<span class="number">1</span>] = sub_78A(v5);</span><br><span class="line">  v10[<span class="number">2</span>] = sub_78A(v6);</span><br><span class="line">  v10[<span class="number">3</span>] = sub_78A(v7);</span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">  &#123;</span><br><span class="line">    v10[v2] = sub_143B(v10[v4], v10[v4 + <span class="number">1</span>], v10[v4 + <span class="number">2</span>], v10[v4 + <span class="number">3</span>]);</span><br><span class="line">    ++v4;</span><br><span class="line">    ++v2;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">while</span> ( v2 &lt;= <span class="number">29</span> );</span><br><span class="line">  v9[<span class="number">0</span>] = HIBYTE(v11);</span><br><span class="line">  v9[<span class="number">1</span>] = BYTE2(v11);</span><br><span class="line">  v9[<span class="number">2</span>] = BYTE1(v11);</span><br><span class="line">  v9[<span class="number">3</span>] = (<span class="keyword">unsigned</span> __int8)v11;</span><br><span class="line">  v9[<span class="number">4</span>] = HIBYTE(v12);</span><br><span class="line">  v9[<span class="number">5</span>] = BYTE2(v12);</span><br><span class="line">  v9[<span class="number">6</span>] = BYTE1(v12);</span><br><span class="line">  v9[<span class="number">7</span>] = (<span class="keyword">unsigned</span> __int8)v12;</span><br><span class="line">  v9[<span class="number">8</span>] = HIBYTE(v13);</span><br><span class="line">  v9[<span class="number">9</span>] = BYTE2(v13);</span><br><span class="line">  v9[<span class="number">10</span>] = BYTE1(v13);</span><br><span class="line">  v9[<span class="number">11</span>] = (<span class="keyword">unsigned</span> __int8)v13;</span><br><span class="line">  v9[<span class="number">12</span>] = HIBYTE(v14);</span><br><span class="line">  v9[<span class="number">13</span>] = BYTE2(v14);</span><br><span class="line">  v9[<span class="number">14</span>] = BYTE1(v14);</span><br><span class="line">  v9[<span class="number">15</span>] = (<span class="keyword">unsigned</span> __int8)v14;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">15</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( v9[i] != v8[i] )</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0xFFFFFFFF</span>LL;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">1LL</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">__int64 __fastcall <span class="title">sub_143B</span><span class="params">(<span class="keyword">int</span> a1, <span class="keyword">int</span> a2, <span class="keyword">int</span> a3, <span class="keyword">unsigned</span> <span class="keyword">int</span> a4)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">return</span> a1 ^ (<span class="keyword">unsigned</span> <span class="keyword">int</span>)sub_1464(a2 ^ a3 ^ a4);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">__int64 __fastcall <span class="title">sub_1464</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">int</span> a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v2; <span class="comment">// [rsp+18h] [rbp-498h]</span></span><br><span class="line">  <span class="keyword">int</span> v3[<span class="number">290</span>]; <span class="comment">// [rsp+20h] [rbp-490h] BYREF</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v4; <span class="comment">// [rsp+4A8h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v4 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  qmemcpy(v3, &amp;unk_1940, <span class="number">0x480</span>uLL);</span><br><span class="line">  v2 = (v3[BYTE2(a1)] &lt;&lt; <span class="number">16</span>) | v3[(<span class="keyword">unsigned</span> __int8)a1] | (v3[BYTE1(a1)] &lt;&lt; <span class="number">8</span>) | (v3[HIBYTE(a1)] &lt;&lt; <span class="number">24</span>);</span><br><span class="line">  <span class="keyword">return</span> __ROL4__(v2, <span class="number">12</span>) ^ (<span class="keyword">unsigned</span> <span class="keyword">int</span>)(__ROL4__(v2, <span class="number">8</span>) ^ __ROR4__(v2, <span class="number">2</span>)) ^ __ROR4__(v2, <span class="number">6</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>对加密算法进行逆向：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> libnum <span class="keyword">import</span> n2s</span><br><span class="line">f=<span class="built_in">open</span>(<span class="string">&#x27;55&#x27;</span>,<span class="string">&#x27;rb&#x27;</span>)</span><br><span class="line">table=[]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">68</span>):</span><br><span class="line">    line=f.read(<span class="number">16</span>)</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(line)):</span><br><span class="line">        <span class="keyword">if</span> j%<span class="number">4</span>==<span class="number">0</span>:</span><br><span class="line">            table.append(line[j])</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(table),<span class="number">4</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">hex</span>(table[i]),<span class="built_in">hex</span>(table[i+<span class="number">1</span>]),<span class="built_in">hex</span>(table[i+<span class="number">2</span>]),<span class="built_in">hex</span>(table[i+<span class="number">3</span>]))</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sub_143b</span>(<span class="params">a1,a2,a3,a4</span>):</span></span><br><span class="line">    <span class="keyword">return</span> a1^sub_1464(a2^a3^a4)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sub_1464</span>(<span class="params">a1</span>):</span></span><br><span class="line">    v2=(table[a1&gt;&gt;<span class="number">24</span>]&lt;&lt;<span class="number">24</span>)|(table[(a1&gt;&gt;<span class="number">16</span>)&amp;<span class="number">0xff</span>]&lt;&lt;<span class="number">16</span>)|(table[(a1&gt;&gt;<span class="number">8</span>)&amp;<span class="number">0xff</span>]&lt;&lt;<span class="number">8</span>)|(table[a1&amp;<span class="number">0xff</span>])</span><br><span class="line">    <span class="keyword">return</span> rol(v2,<span class="number">12</span>)^rol(v2,<span class="number">8</span>)^ror(v2,<span class="number">2</span>)^ror(v2,<span class="number">6</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">rol</span>(<span class="params">a1,s</span>):</span></span><br><span class="line">    <span class="keyword">return</span> ((a1&lt;&lt;s)|(a1&gt;&gt;(<span class="number">32</span>-s)))&amp;<span class="number">0xffffffff</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ror</span>(<span class="params">a1,s</span>):</span></span><br><span class="line">    <span class="keyword">return</span> ((a1&gt;&gt;s)|(a1&lt;&lt;(<span class="number">32</span>-s)))&amp;<span class="number">0xffffffff</span></span><br><span class="line"></span><br><span class="line">a = [<span class="number">0</span>]*<span class="number">26</span></span><br><span class="line">a.append(<span class="number">0xBE040680</span>)</span><br><span class="line">a.append(<span class="number">0xC5AF7647</span>)</span><br><span class="line">a.append(<span class="number">0x9FCC401F</span>)</span><br><span class="line">a.append(<span class="number">0xD8BF92EF</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">25</span>,-<span class="number">1</span>,-<span class="number">1</span>):</span><br><span class="line">    a[i] = sub_143b(a[i+<span class="number">4</span>],a[i+<span class="number">1</span>],a[i+<span class="number">2</span>],a[i+<span class="number">3</span>])</span><br><span class="line"><span class="built_in">print</span>(n2s(a[<span class="number">0</span>])[::-<span class="number">1</span>]+n2s(a[<span class="number">1</span>])[::-<span class="number">1</span>]+n2s(a[<span class="number">2</span>])[::-<span class="number">1</span>]+n2s(a[<span class="number">3</span>])[::-<span class="number">1</span>])</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>最终得到flag:sctf{sxss-c2N0Zl85MTAy(fl4g_is_s0_ug1y!)}</p>
<h2 id="2019红帽杯-Snake"><a href="#2019红帽杯-Snake" class="headerlink" title="[2019红帽杯]Snake"></a>[2019红帽杯]Snake</h2><p>（不看dl的wp完全不会系列，就连wp也跟dl一样系列）</p>
<p>下载附件，解压发现是个有Unity写的游戏</p>
<img src="/2022/01/28/BUUOJ-Reverse-1/image-20220209210019622.png" class title="image-20220209210019622">
<p>找到Assembly-CSharp.dll文件，拖进dnspy，找到游戏主函数GameObject</p>
<img src="/2022/01/28/BUUOJ-Reverse-1/image-20220209210300315.png" class title="image-20220209210300315">
<p>发现这个函数是在Interface中，就到文件中找Interface.dll，把它拖进ida</p>
<img src="/2022/01/28/BUUOJ-Reverse-1/image-20220209210450763.png" class title="image-20220209210450763">
<p>找到关键词，点进去，ctrl+s交叉引用定位关键代码</p>
<p>发现一串又臭又长的代码，观察题目的参数a1范围为[0,99]，便进行爆破</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> ctypes</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fxxk</span>(<span class="params">i</span>):</span></span><br><span class="line">    dll = ctypes.cdll.LoadLibrary(<span class="string">&quot;C:\\Users\\80424\\Downloads\\attachment\\Snake\\Snake_Data\\Plugins\\Interface.dll&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(i)</span><br><span class="line">    dll.GameObject(i)</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">        fxxk(i)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>在漫长的等待后，得到flag:flag{Ch4rp_W1th_R$@}</p>
<h2 id="FlareOn2-very-success"><a href="#FlareOn2-very-success" class="headerlink" title="[FlareOn2]very_success"></a>[FlareOn2]very_success</h2><p>拖进ida开始分析</p>
<img src="/2022/01/28/BUUOJ-Reverse-1/image-20220216223251936.png" class title="image-20220216223251936">
<p>关键在sub_401084中，点进去查看</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> __usercall sub_401084@&lt;eax&gt;(<span class="keyword">int</span> result@&lt;eax&gt;, <span class="keyword">int</span> a2, <span class="keyword">char</span> *input, <span class="keyword">int</span> a4)</span><br><span class="line">&#123;</span><br><span class="line">  __int16 v4; <span class="comment">// bx</span></span><br><span class="line">  <span class="keyword">int</span> v5; <span class="comment">// ecx</span></span><br><span class="line">  _BYTE *v7; <span class="comment">// edi</span></span><br><span class="line">  <span class="keyword">char</span> v8; <span class="comment">// al</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v9; <span class="comment">// kr00_4</span></span><br><span class="line">  <span class="keyword">char</span> v10; <span class="comment">// al</span></span><br><span class="line">  <span class="keyword">char</span> v11; <span class="comment">// cf</span></span><br><span class="line">  __int16 v12; <span class="comment">// ax</span></span><br><span class="line">  <span class="keyword">bool</span> v13; <span class="comment">// zf</span></span><br><span class="line">  _BYTE *v14; <span class="comment">// edi</span></span><br><span class="line">  <span class="keyword">int</span> v15; <span class="comment">// [esp+0h] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  v4 = <span class="number">0</span>;</span><br><span class="line">  v5 = <span class="number">37</span>;</span><br><span class="line">  <span class="keyword">if</span> ( a4 &gt;= <span class="number">37</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v7 = (_BYTE *)(a2 + <span class="number">36</span>);</span><br><span class="line">    <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      LOWORD(result) = <span class="number">455</span>;</span><br><span class="line">      v15 = result;</span><br><span class="line">      v8 = *input++;</span><br><span class="line">      v9 = __readeflags();</span><br><span class="line">      v10 = v15 ^ v8;				</span><br><span class="line">      __writeeflags(v9);</span><br><span class="line">      v12 = (<span class="keyword">unsigned</span> __int8)(__ROL1__(<span class="number">1</span>, v4 &amp; <span class="number">3</span>) + v11 + v10);<span class="comment">//加密</span></span><br><span class="line">      v4 += v12;</span><br><span class="line">      v13 = *v7 == (<span class="keyword">unsigned</span> __int8)v12;		<span class="comment">//此行进行对比</span></span><br><span class="line">      v14 = v7 + <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">if</span> ( !v13 )                               <span class="comment">// v13需要=1</span></span><br><span class="line">        LOWORD(v5) = <span class="number">0</span>;</span><br><span class="line">      result = v15;</span><br><span class="line">      <span class="keyword">if</span> ( !v5 )</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      v7 = v14 - <span class="number">2</span>;</span><br><span class="line">      <span class="keyword">if</span> ( !--v5 )</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;<span class="comment">//为便于阅读，代码有改动</span></span><br></pre></td></tr></table></figure>
<p>可以发现加密流程就是将输入的字符与一个常数result异或后，与常数v11和1&lt;&lt;(v4&amp;3)相加，每一次循环后v4便加上v12的值</p>
<p>通过v12和v7的值的对比可以判断flag是否正确，因此关键在于得到v7的值</p>
<p>动调得到v7中的值：</p>
<img src="/2022/01/28/BUUOJ-Reverse-1/image-20220216231653735.png" class title="image-20220216231653735">
<p>接着通过动调发现v11的值在加密时始终为1（这点比较诡异，在未加密是v11的值会在0、1间反复横跳）</p>
<p>最终写出解题脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">rol</span>(<span class="params">a,b</span>):</span></span><br><span class="line">    <span class="keyword">return</span> (a&lt;&lt;b)|(a&gt;&gt;(<span class="number">8</span>-b))&amp;<span class="number">0xff</span></span><br><span class="line">a=[<span class="number">0xAA</span> ,<span class="number">0xEC</span> ,<span class="number">0xA4</span> ,<span class="number">0xBA</span> ,<span class="number">0xAF</span> ,<span class="number">0xAE</span> ,<span class="number">0xAA</span></span><br><span class="line">,<span class="number">0x8A</span> ,<span class="number">0xC0</span> ,<span class="number">0xA7</span> ,<span class="number">0xB0</span> ,<span class="number">0xBC</span> ,<span class="number">0x9A</span> ,<span class="number">0xBA</span> ,<span class="number">0xA5</span> ,<span class="number">0xA5</span> ,<span class="number">0xBA</span> ,<span class="number">0xAF</span> ,<span class="number">0xB8</span> ,<span class="number">0x9D</span> ,<span class="number">0xB8</span> ,<span class="number">0xF9</span> ,<span class="number">0xAE</span></span><br><span class="line">,<span class="number">0x9D</span> ,<span class="number">0xAB</span> ,<span class="number">0xB4</span> ,<span class="number">0xBC</span> ,<span class="number">0xB6</span> ,<span class="number">0xB3</span> ,<span class="number">0x90</span> ,<span class="number">0x9A</span> ,<span class="number">0xA8</span> ]</span><br><span class="line">a=a[::-<span class="number">1</span>]</span><br><span class="line">v4=<span class="number">0</span></span><br><span class="line">v11=<span class="number">0</span></span><br><span class="line">flag=[]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> a:</span><br><span class="line">    v10=(i-rol(<span class="number">1</span>,v4&amp;<span class="number">3</span>)-<span class="number">1</span>)%<span class="number">256</span></span><br><span class="line">    v4+=i</span><br><span class="line">    flag.append(v10^<span class="number">0x1901c7</span>%<span class="number">256</span>)</span><br><span class="line"><span class="built_in">str</span>=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> flag:</span><br><span class="line">    <span class="built_in">str</span>+=<span class="built_in">chr</span>(i)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">str</span>)</span><br><span class="line"><span class="comment">#a_Little_b1t_harder_plez@flare-o</span></span><br></pre></td></tr></table></figure>
<p>结合题目提示，得到flag:flag{a_Little_b1t_harder_plez@flare-on.com}</p>
<h2 id="CISCN2018-2ex"><a href="#CISCN2018-2ex" class="headerlink" title="[CISCN2018]2ex"></a>[CISCN2018]2ex</h2><p>拖进ida,shift+f12看字符串</p>
<img src="/2022/01/28/BUUOJ-Reverse-1/image-20220217001540216.png" class title="image-20220217001540216">
<p>结合out.txt内容：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">│_r-+_Cl5;vgq_pdme7#7eC0=</span><br></pre></td></tr></table></figure>
<p>有理由怀疑这是base64变种</p>
<p>继续跟踪，发现这个函数，显然是base64的编码</p>
<img src="/2022/01/28/BUUOJ-Reverse-1/image-20220217001732641.png" class title="image-20220217001732641">
<p>码表为</p>
<img src="/2022/01/28/BUUOJ-Reverse-1/image-20220217001748482.png" class title="image-20220217001748482">
<p>尝试将out.txt中内容根据码表内容进行解码，得到flag:flag{change53233}</p>
<h2 id="SCTF2019-Who-is-he"><a href="#SCTF2019-Who-is-he" class="headerlink" title="[SCTF2019]Who is he"></a>[SCTF2019]Who is he</h2><p>下载压缩包，发现是unity游戏，打开运行一下</p>
<img src="/2022/01/28/BUUOJ-Reverse-1/image-20220217160648922.png" class title="image-20220217160648922">
<p>发现是一段鬼畜视频，挺带感的</p>
<p>把Assembly-CSharp.dll拖进dnSpy中，找到OnClick()函数，发现是将输入的数据与解密后的已加密的flag进行对比从而判断正确</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">public void OnClick()</span><br><span class="line">&#123;</span><br><span class="line">	Debug.Log(&quot;Button Clicked. TestClick.&quot;);</span><br><span class="line">	Debug.Log(this.Name.text);</span><br><span class="line">	bool flag = this.Name.text.Equals(this.Decrypt(this.EncryptData));</span><br><span class="line">	if (flag)</span><br><span class="line">	&#123;</span><br><span class="line">		Debug.Log(&quot;Right&quot;);</span><br><span class="line">		TestClick.Messagebox.MessageBox(IntPtr.Zero, &quot;Haha, same as you!&quot;, &quot;Info:&quot;, 0);</span><br><span class="line">	&#125;</span><br><span class="line">	else</span><br><span class="line">	&#123;</span><br><span class="line">		Debug.Log(&quot;Wrong&quot;);</span><br><span class="line">		TestClick.Messagebox.MessageBox(IntPtr.Zero, &quot;Emmmmm,I don&#x27;t think so.&quot;, &quot;Info:&quot;, 0);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>查看解密函数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">private string Decrypt(string str)</span><br><span class="line">&#123;</span><br><span class="line">	string result;</span><br><span class="line">	try</span><br><span class="line">	&#123;</span><br><span class="line">		byte[] bytes = Encoding.Unicode.GetBytes(TestClick.encryptKey);</span><br><span class="line">		byte[] array = Convert.FromBase64String(str);</span><br><span class="line">		DESCryptoServiceProvider descryptoServiceProvider = new DESCryptoServiceProvider();</span><br><span class="line">		MemoryStream memoryStream = new MemoryStream();</span><br><span class="line">		CryptoStream cryptoStream = new CryptoStream(memoryStream, descryptoServiceProvider.CreateDecryptor(bytes, bytes), CryptoStreamMode.Write);</span><br><span class="line">		cryptoStream.Write(array, 0, array.Length);</span><br><span class="line">		cryptoStream.FlushFinalBlock();</span><br><span class="line">		byte[] bytes2 = memoryStream.ToArray();</span><br><span class="line">		cryptoStream.Close();</span><br><span class="line">		memoryStream.Close();</span><br><span class="line">		result = Encoding.Unicode.GetString(bytes2);</span><br><span class="line">	&#125;</span><br><span class="line">	catch</span><br><span class="line">	&#123;</span><br><span class="line">		result = str;</span><br><span class="line">	&#125;</span><br><span class="line">	return result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>只是将flag在base64解码后，使用了DES进行解密，注意使用的是CBC模式</p>
<img src="/2022/01/28/BUUOJ-Reverse-1/1031264-20170805165132678-576490323.png" class title="img">
<p>查看EncryptData和encruptKey，得到密文为</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1Tsy0ZGotyMinSpxqYzVBWnfMdUcqCMLu0MA+22Jnp+MNwLHvYuFToxRQr0c+ONZc6Q7L0EAmzbycqobZHh4H23U4WDTNmmXwusW4E+SZjygsntGkO2sGA==</span><br></pre></td></tr></table></figure>
<p>密钥为1234</p>
<p>注意，在C#中，字符串默认是Unicode字符串，所以转成字节数组，在每个字符字节后都要加一个”\x00”</p>
<p>进行解密：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> DES</span><br><span class="line">key = <span class="string">b&quot;1\x002\x003\x004\x00&quot;</span></span><br><span class="line">des = DES.new(key,DES.MODE_CBC, key)</span><br><span class="line">cipher =<span class="string">b&quot;1Tsy0ZGotyMinSpxqYzVBWnfMdUcqCMLu0MA+22Jnp+MNwLHvYuFToxRQr0c+ONZc6Q7L0EAmzbycqobZHh4H23U4WDTNmmXwusW4E+SZjygsntGkO2sGA==&quot;</span></span><br><span class="line">cipher = base64.b64decode(cipher)</span><br><span class="line">plain = des.decrypt(cipher).decode(<span class="string">&quot;utf-16&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(plain)</span><br></pre></td></tr></table></figure>
<p>得到He_P1ay_Basketball_Very_We11!Hahahahaha!ࠈࠈࠈࠈ</p>
<p>然而提交并不是flag，查看大佬的wp后才发现密文和密钥被更换了</p>
<p>用Cheat Engine搜索字符串“Emmmm”，发现有两处</p>
<img src="/2022/01/28/BUUOJ-Reverse-1/image-20220217165203740.png" class title="image-20220217165203740">
<p>跟进其中一处看，发现有新的base64字符串，可能是真正的密文</p>
<img src="/2022/01/28/BUUOJ-Reverse-1/image-20220217165600839.png" class title="image-20220217165600839">
<p>进行解密</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> DES</span><br><span class="line">key = <span class="string">b&quot;t\x00e\x00s\x00t\x00&quot;</span></span><br><span class="line">des = DES.new(key,DES.MODE_CBC, key)</span><br><span class="line">cipher = <span class="string">b&quot;xZWDZaKEhWNMCbiGYPBIlY3+arozO9zonwrYLiVL4njSez2RYM2WwsGnsnjCDnHs7N43aFvNE54noSadP9F8eEpvTs5QPG+KL0TDE/40nbU=&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#cipher =b&quot;1Tsy0ZGotyMinSpxqYzVBWnfMdUcqCMLu0MA+22Jnp+MNwLHvYuFToxRQr0c+ONZc6Q7L0EAmzbycqobZHh4H23U4WDTNmmXwusW4E+SZjygsntGkO2sGA==&quot;</span></span><br><span class="line">cipher = base64.b64decode(cipher)</span><br><span class="line">plain = des.decrypt(cipher).decode(<span class="string">&quot;utf-16&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(plain)</span><br></pre></td></tr></table></figure>
<p>得到flag:flag{She_P1ay_Black_Hole_Very_Wel1!LOL!XD!}</p>
<h2 id="SUSCTF-2022-DigitalCircuits"><a href="#SUSCTF-2022-DigitalCircuits" class="headerlink" title="[SUSCTF 2022]DigitalCircuits"></a>[SUSCTF 2022]DigitalCircuits</h2><p>下载附件，发现是python逆向</p>
<p>使用pyinstxtractor处理，得到pyc文件，在扔进在线网站得到代码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># visit https://tool.lu/pyc/ for more information</span></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f1</span>(<span class="params">a, b</span>):</span><span class="comment">#&amp;</span></span><br><span class="line">    <span class="keyword">if</span> a == <span class="string">&#x27;1&#x27;</span> <span class="keyword">and</span> b == <span class="string">&#x27;1&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;1&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f2</span>(<span class="params">a, b</span>):</span><span class="comment"># |</span></span><br><span class="line">    <span class="keyword">if</span> a == <span class="string">&#x27;0&#x27;</span> <span class="keyword">and</span> b == <span class="string">&#x27;0&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;0&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f3</span>(<span class="params">a</span>):</span><span class="comment"># !</span></span><br><span class="line">    <span class="keyword">if</span> a == <span class="string">&#x27;1&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;0&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> <span class="literal">None</span> == <span class="string">&#x27;0&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;1&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f4</span>(<span class="params">a, b</span>):</span><span class="comment">#^</span></span><br><span class="line">    <span class="keyword">return</span> f2(f1(a, f3(b)), f1(f3(a), b))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f5</span>(<span class="params">x, y, z</span>):</span></span><br><span class="line">    s = f4(f4(x, y), z)<span class="comment">#s=x^y^z</span></span><br><span class="line">    c = f2(f1(x, y), f1(z, f2(x, y)))<span class="comment">#c=(x&amp;y)|(z&amp;(x|y))</span></span><br><span class="line">    <span class="keyword">return</span> (s, c)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f6</span>(<span class="params">a, b</span>):</span></span><br><span class="line">    ans = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    z = <span class="string">&#x27;0&#x27;</span></span><br><span class="line">    a = a[::-<span class="number">1</span>]</span><br><span class="line">    b = b[::-<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">        ans += f5(a[i], b[i], z)[<span class="number">0</span>]</span><br><span class="line">        z = f5(a[i], b[i], z)[<span class="number">1</span>]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> ans[::-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f7</span>(<span class="params">a, n</span>):</span><span class="comment">#左移n位，右边补0</span></span><br><span class="line">    <span class="keyword">return</span> a[n:] + <span class="string">&#x27;0&#x27;</span> * n</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f8</span>(<span class="params">a, n</span>):</span></span><br><span class="line">    <span class="keyword">return</span> n * <span class="string">&#x27;0&#x27;</span> + a[:-n]<span class="comment">#右移n位，左边补0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f9</span>(<span class="params">a, b</span>):</span><span class="comment">#a^b(32位)</span></span><br><span class="line">    ans = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">        ans += f4(a[i], b[i])</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> ans</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f10</span>(<span class="params">v0, v1, k0, k1, k2, k3</span>):</span></span><br><span class="line">    s = <span class="string">&#x27;00000000000000000000000000000000&#x27;</span></span><br><span class="line">    d = <span class="string">&#x27;10011110001101110111100110111001&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">        s = f6(s, d)</span><br><span class="line">        v0 = f6(v0, f9(f9(f6(f7(v1, <span class="number">4</span>), k0), f6(v1, s)), f6(f8(v1, <span class="number">5</span>), k1)))<span class="comment">#f6(v0,f6(v1&lt;&lt;4, k0)^ f6(v1, s)^ f6(v1&gt;&gt;5, k1))</span></span><br><span class="line">        v1 = f6(v1, f9(f9(f6(f7(v0, <span class="number">4</span>), k2), f6(v0, s)), f6(f8(v0, <span class="number">5</span>), k3)))<span class="comment">#f6(v1,f6(v0&lt;&lt;4, k2)^ f6(v0, s)^ f6(v0&gt;&gt;5, k3))</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> v0 + v1</span><br><span class="line"></span><br><span class="line">k0 = <span class="string">&#x27;0100010001000101&#x27;</span>.zfill(<span class="number">32</span>)</span><br><span class="line">k1 = <span class="string">&#x27;0100000101000100&#x27;</span>.zfill(<span class="number">32</span>)</span><br><span class="line">k2 = <span class="string">&#x27;0100001001000101&#x27;</span>.zfill(<span class="number">32</span>)</span><br><span class="line">k3 = <span class="string">&#x27;0100010101000110&#x27;</span>.zfill(<span class="number">32</span>)</span><br><span class="line">flag = <span class="built_in">input</span>(<span class="string">&#x27;please input flag:&#x27;</span>)</span><br><span class="line"><span class="keyword">if</span> flag[<span class="number">0</span>:<span class="number">7</span>] != <span class="string">&#x27;SUSCTF&#123;&#x27;</span> <span class="keyword">or</span> flag[-<span class="number">1</span>] != <span class="string">&#x27;&#125;&#x27;</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Error!!!The formate of flag is SUSCTF&#123;XXX&#125;&#x27;</span>)</span><br><span class="line">    time.sleep(<span class="number">5</span>)</span><br><span class="line">    exit(<span class="number">0</span>)</span><br><span class="line">flagstr = flag[<span class="number">7</span>:-<span class="number">1</span>]</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(flagstr) != <span class="number">24</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Error!!!The length of flag 24&#x27;</span>)</span><br><span class="line">    time.sleep(<span class="number">5</span>)</span><br><span class="line">    exit(<span class="number">0</span>)</span><br><span class="line">res = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(flagstr), <span class="number">8</span>):</span><br><span class="line">    v0 = flagstr[i:i + <span class="number">4</span>]</span><br><span class="line">    v0 = <span class="built_in">bin</span>(<span class="built_in">ord</span>(flagstr[i]))[<span class="number">2</span>:].zfill(<span class="number">8</span>) + <span class="built_in">bin</span>(<span class="built_in">ord</span>(flagstr[i + <span class="number">1</span>]))[<span class="number">2</span>:].zfill(<span class="number">8</span>) + <span class="built_in">bin</span>(<span class="built_in">ord</span>(flagstr[i + <span class="number">2</span>]))[<span class="number">2</span>:].zfill(<span class="number">8</span>) + <span class="built_in">bin</span>(<span class="built_in">ord</span>(flagstr[i + <span class="number">3</span>]))[<span class="number">2</span>:].zfill(<span class="number">8</span>)</span><br><span class="line">    v1 = <span class="built_in">bin</span>(<span class="built_in">ord</span>(flagstr[i + <span class="number">4</span>]))[<span class="number">2</span>:].zfill(<span class="number">8</span>) + <span class="built_in">bin</span>(<span class="built_in">ord</span>(flagstr[i + <span class="number">5</span>]))[<span class="number">2</span>:].zfill(<span class="number">8</span>) + <span class="built_in">bin</span>(<span class="built_in">ord</span>(flagstr[i + <span class="number">6</span>]))[<span class="number">2</span>:].zfill(<span class="number">8</span>) + <span class="built_in">bin</span>(<span class="built_in">ord</span>(flagstr[i + <span class="number">7</span>]))[<span class="number">2</span>:].zfill(<span class="number">8</span>)</span><br><span class="line">    res += f10(v0, v1, k0, k1, k2, k3)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> res == <span class="string">&#x27;001111101000100101000111110010111100110010010100010001100011100100110001001101011000001110001000001110110000101101101000100100111101101001100010011100110110000100111011001011100110010000100111&#x27;</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;True&#x27;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;False&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(res)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>阅读代码，发现是加密算法，只不过是用字符串操作代替了位运算（函数f1和f2的代码有点问题，None应该是’0’或’1’）。</p>
<p>加密过程大致如下：</p>
<p>加密三轮，每轮加密8个字节，通过函数f10、f6、f5进行加密，因此主要思想是已知函数结果和输入参数b，对另一个输入参数a进行逆向</p>
<h5 id="对f10的逆向："><a href="#对f10的逆向：" class="headerlink" title="对f10的逆向："></a>对<strong>f10</strong>的逆向：</h5><p>f10中含有两个状态变量s和d，仔细观察可以发现他们在每一轮的值都是相同的，与输入无关，因此可提前知道它们在每一轮的值。</p>
<p>f10的输出值为v0+v1，即res中的值，因此最后一轮的v0与v1已知</p>
<p>再观察该代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">v1 = f6(v1, f9(f9(f6(f7(v0, <span class="number">4</span>), k2), f6(v0, s)), f6(f8(v0, <span class="number">5</span>), k3)))</span><br></pre></td></tr></table></figure>
<p>输出v1已知，f6中另一个输入参数为</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">f9(f9(f6(f7(v0, <span class="number">4</span>), k2), f6(v0, s)), f6(f8(v0, <span class="number">5</span>), k3)) <span class="comment">#f6(v0&lt;&lt;4, k2)^ f6(v0, s)^ f6(v0&gt;&gt;5, k3)</span></span><br></pre></td></tr></table></figure>
<p>此处v0为res中的值，而k2和k3的值不变，因此该参数的值也可以知道，那么问题就是对函数f6进行逆向了</p>
<p><strong>编写解题脚本</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> libnum <span class="keyword">import</span> n2s</span><br><span class="line">cip=<span class="string">&#x27;001111101000100101000111110010111100110010010100010001100011100100110001001101011000001110001000001110110000101101101000100100111101101001100010011100110110000100111011001011100110010000100111&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(cip))</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f7</span>(<span class="params">a, n</span>):</span><span class="comment">#左移n位，右边补0</span></span><br><span class="line">    <span class="keyword">return</span> a[n:] + <span class="string">&#x27;0&#x27;</span> * n</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f8</span>(<span class="params">a, n</span>):</span></span><br><span class="line">    <span class="keyword">return</span> n * <span class="string">&#x27;0&#x27;</span> + a[:-n]<span class="comment">#右移n位，左边补0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f9</span>(<span class="params">a, b</span>):</span><span class="comment">#a^b(32位)</span></span><br><span class="line">    ans = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">        ans += f4(a[i], b[i])</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> ans</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f1</span>(<span class="params">a, b</span>):</span><span class="comment">#&amp;</span></span><br><span class="line">    <span class="keyword">if</span> a == <span class="string">&#x27;1&#x27;</span> <span class="keyword">and</span> b == <span class="string">&#x27;1&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;1&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;0&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f2</span>(<span class="params">a, b</span>):</span><span class="comment"># |</span></span><br><span class="line">    <span class="keyword">if</span> a == <span class="string">&#x27;0&#x27;</span> <span class="keyword">and</span> b == <span class="string">&#x27;0&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;0&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;1&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f3</span>(<span class="params">a</span>):</span><span class="comment"># !</span></span><br><span class="line">    <span class="keyword">if</span> a == <span class="string">&#x27;1&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;0&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> a == <span class="string">&#x27;0&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;1&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f4</span>(<span class="params">a, b</span>):</span><span class="comment">#^</span></span><br><span class="line">    <span class="keyword">return</span> f2(f1(a, f3(b)), f1(f3(a), b))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f5</span>(<span class="params">x, y, z</span>):</span></span><br><span class="line">    s = f4(f4(x, y), z)<span class="comment">#s=x^y^z</span></span><br><span class="line">    c = f2(f1(x, y), f1(z, f2(x, y)))<span class="comment">#c=(x&amp;y)|(z&amp;(x|y))</span></span><br><span class="line">    <span class="keyword">return</span> (s, c)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f6</span>(<span class="params">a, b</span>):</span></span><br><span class="line">    ans = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    z = <span class="string">&#x27;0&#x27;</span></span><br><span class="line">    a = a[::-<span class="number">1</span>]</span><br><span class="line">    b = b[::-<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">        ans += f5(a[i], b[i], z)[<span class="number">0</span>]</span><br><span class="line">        z = f5(a[i], b[i], z)[<span class="number">1</span>]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> ans[::-<span class="number">1</span>]</span><br><span class="line">s_ =[<span class="string">&#x27;00000000000000000000000000000000&#x27;</span>]</span><br><span class="line">d_ =<span class="string">&#x27;10011110001101110111100110111001&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">    s_.append(f6(s_[i],d_))</span><br><span class="line">    <span class="comment"># print(s_[i])</span></span><br><span class="line">k0 = <span class="string">&#x27;0100010001000101&#x27;</span>.zfill(<span class="number">32</span>)</span><br><span class="line">k1 = <span class="string">&#x27;0100000101000100&#x27;</span>.zfill(<span class="number">32</span>)</span><br><span class="line">k2 = <span class="string">&#x27;0100001001000101&#x27;</span>.zfill(<span class="number">32</span>)</span><br><span class="line">k3 = <span class="string">&#x27;0100010101000110&#x27;</span>.zfill(<span class="number">32</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">inv_f10</span>(<span class="params">res</span>):</span></span><br><span class="line">    v0=res[:<span class="number">32</span>]</span><br><span class="line">    v1=res[<span class="number">32</span>:]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">        v1=inv_f6(v1, f9(f9(f6(f7(v0, <span class="number">4</span>), k2), f6(v0, s_[<span class="number">32</span>-i])), f6(f8(v0, <span class="number">5</span>), k3)))</span><br><span class="line">        v0=inv_f6(v0, f9(f9(f6(f7(v1, <span class="number">4</span>), k0), f6(v1, s_[<span class="number">32</span>-i])), f6(f8(v1, <span class="number">5</span>), k1)))</span><br><span class="line">    <span class="keyword">return</span> v0,v1</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">inv_f6</span>(<span class="params">ans,b</span>):</span></span><br><span class="line">    ans=ans[::-<span class="number">1</span>]</span><br><span class="line">    b=b[::-<span class="number">1</span>]</span><br><span class="line">    a=<span class="string">&#x27;&#x27;</span></span><br><span class="line">    z=<span class="string">&#x27;0&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">        a+=f5(ans[i],b[i],z)[<span class="number">0</span>]</span><br><span class="line">        z=f5(a[i], b[i], z)[<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">return</span> a[::-<span class="number">1</span>]</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    flag=<span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">        res_=cip[i*(<span class="built_in">len</span>(cip)//<span class="number">3</span>):(i+<span class="number">1</span>)*(<span class="built_in">len</span>(cip)//<span class="number">3</span>)]</span><br><span class="line">        v0,v1=inv_f10(res_)</span><br><span class="line">        flag+=v0</span><br><span class="line">        flag+=v1</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">int</span>(flag,<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(n2s(main()))</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="羊城杯-2020-Bytecode"><a href="#羊城杯-2020-Bytecode" class="headerlink" title="[羊城杯 2020]Bytecode"></a>[羊城杯 2020]Bytecode</h2><p>下载附件，发现是python字节码，于是手撸字节码：</p>
<img src="/2022/01/28/BUUOJ-Reverse-1/image-20220228235632948.png" class title="image-20220228235632948">
<p>利用python中的dis库可以有效地将python代码转换为对应的字节码，如：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> dis</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span>():</span></span><br><span class="line">    a=<span class="number">1</span></span><br><span class="line">    b=<span class="number">2</span></span><br><span class="line">    c=a+b</span><br><span class="line">    <span class="built_in">print</span>(c)</span><br><span class="line">dis.dis(func)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">  3           0 LOAD_CONST               1 (1)</span></span><br><span class="line"><span class="string">              2 STORE_FAST               0 (a)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  4           4 LOAD_CONST               2 (2)    </span></span><br><span class="line"><span class="string">              6 STORE_FAST               1 (b)    </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  5           8 LOAD_FAST                0 (a)    </span></span><br><span class="line"><span class="string">             10 LOAD_FAST                1 (b)    </span></span><br><span class="line"><span class="string">             12 BINARY_ADD</span></span><br><span class="line"><span class="string">             14 STORE_FAST               2 (c)    </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  6          16 LOAD_GLOBAL              0 (print)             18 LOAD_FAST                2 (c)    </span></span><br><span class="line"><span class="string">             20 CALL_FUNCTION            1        </span></span><br><span class="line"><span class="string">             22 POP_TOP</span></span><br><span class="line"><span class="string">             24 LOAD_CONST               0 (None) </span></span><br><span class="line"><span class="string">             26 RETURN_VALUE</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>
<p>个人感觉这篇博客讲的不错：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/blili/p/11804690.html">Python逆向（五）—— Python字节码解读 - Blili - 博客园 (cnblogs.com)</a></p>
<p>一路边看边写，大致写出题目的源码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> dis</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span>():</span></span><br><span class="line">    en=[<span class="number">3</span>,<span class="number">37</span>,<span class="number">72</span>,<span class="number">9</span>,<span class="number">6</span>,<span class="number">132</span>]</span><br><span class="line">    output=[<span class="number">101</span>,<span class="number">96</span>,<span class="number">23</span>,<span class="number">68</span>,<span class="number">112</span>,<span class="number">42</span>,<span class="number">107</span>,<span class="number">62</span>,<span class="number">96</span>,<span class="number">53</span>,<span class="number">176</span>,<span class="number">179</span>,<span class="number">98</span>,<span class="number">53</span>,<span class="number">67</span>,<span class="number">29</span>,<span class="number">41</span>,<span class="number">120</span>,<span class="number">60</span>,</span><br><span class="line">    <span class="number">106</span>,<span class="number">51</span>,<span class="number">101</span>,<span class="number">178</span>,<span class="number">189</span>,<span class="number">101</span>,<span class="number">48</span>]</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;welcome to GWHT2020&#x27;</span>)</span><br><span class="line">    flag=<span class="built_in">input</span>(<span class="string">&#x27;please input your flag:&#x27;</span>)</span><br><span class="line">    <span class="built_in">str</span>=flag</span><br><span class="line">    a=<span class="built_in">len</span>(<span class="built_in">str</span>)</span><br><span class="line">    <span class="keyword">if</span> a&lt;<span class="number">38</span>:</span><br><span class="line">        <span class="keyword">if</span>((((<span class="built_in">ord</span>(<span class="built_in">str</span>[<span class="number">0</span>])*<span class="number">2020</span>+<span class="built_in">ord</span>(<span class="built_in">str</span>[<span class="number">1</span>]))*<span class="number">2020</span>+<span class="built_in">ord</span>(<span class="built_in">str</span>[<span class="number">2</span>]))*<span class="number">2020</span>+<span class="built_in">ord</span>(<span class="built_in">str</span>[<span class="number">3</span>]))*<span class="number">2020</span>+<span class="built_in">ord</span>(<span class="built_in">str</span>[<span class="number">4</span>])==<span class="number">1182843538814603</span>):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">b&#x27;good!continue\xe2\x80\xa6\xe2\x80\xa6&#x27;</span>)</span><br><span class="line">            x=[]</span><br><span class="line">            k=<span class="number">5</span></span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">13</span>):</span><br><span class="line">                b=<span class="built_in">ord</span>(<span class="built_in">str</span>[k])</span><br><span class="line">                c=<span class="built_in">ord</span>(<span class="built_in">str</span>[k+<span class="number">1</span>])</span><br><span class="line">                a11=en[i%<span class="number">6</span>]^c</span><br><span class="line">                a22=en[i%<span class="number">6</span>]^b</span><br><span class="line">                x.append(a11)</span><br><span class="line">                x.append(a22)</span><br><span class="line">                k=k+<span class="number">2</span></span><br><span class="line">            <span class="keyword">if</span> x==output:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">b&#x27;good!continue\xe2\x80\xa6\xe2\x80\xa6&#x27;</span>)</span><br><span class="line">                l=<span class="built_in">len</span>(<span class="built_in">str</span>)</span><br><span class="line">                a1=<span class="built_in">ord</span>(<span class="built_in">str</span>[l-<span class="number">7</span>])</span><br><span class="line">                a2=<span class="built_in">ord</span>(<span class="built_in">str</span>[l-<span class="number">6</span>])</span><br><span class="line">                a3=<span class="built_in">ord</span>(<span class="built_in">str</span>[l-<span class="number">5</span>])</span><br><span class="line">                a4=<span class="built_in">ord</span>(<span class="built_in">str</span>[l-<span class="number">4</span>])</span><br><span class="line">                a5=<span class="built_in">ord</span>(<span class="built_in">str</span>[l-<span class="number">3</span>])</span><br><span class="line">                a6=<span class="built_in">ord</span>(<span class="built_in">str</span>[l-<span class="number">2</span>])</span><br><span class="line">                <span class="keyword">if</span>(a1*<span class="number">3</span>+a2*<span class="number">2</span>+a3*<span class="number">5</span>==<span class="number">1003</span>):</span><br><span class="line">                    <span class="keyword">if</span>(a1*<span class="number">4</span>+a2*<span class="number">7</span>+a3*<span class="number">9</span>==<span class="number">2013</span>):</span><br><span class="line">                        <span class="keyword">if</span>(a2*<span class="number">8</span>+a1+a3*<span class="number">2</span>==<span class="number">1109</span>):</span><br><span class="line">                            <span class="keyword">if</span>(a4*<span class="number">3</span>+a5*<span class="number">2</span>+a6*<span class="number">5</span>==<span class="number">671</span>):</span><br><span class="line">                                <span class="keyword">if</span>(a4*<span class="number">4</span>+a5*<span class="number">7</span>+a6*<span class="number">9</span>==<span class="number">1252</span>):</span><br><span class="line">                                    <span class="keyword">if</span>(a5*<span class="number">8</span>+a4+a6*<span class="number">2</span>==<span class="number">644</span>):</span><br><span class="line">                                        <span class="built_in">print</span>(<span class="string">&#x27;congraduation!you get the right flag!&#x27;</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;oh,you are wrong!&#x27;</span>)</span><br><span class="line">                exit()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;bye&#x27;</span>)</span><br><span class="line">            exit()</span><br><span class="line">    exit()</span><br><span class="line"><span class="built_in">print</span>(dis.dis(test))</span><br></pre></td></tr></table></figure>
<p>其实也就是将一部分输入和设置好的数组异或，最后再将部分输入放入方程中验证</p>
<p>写出解题脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sympy <span class="keyword">import</span> *</span><br><span class="line">a1=Symbol(<span class="string">&#x27;a1&#x27;</span>)</span><br><span class="line">a2=Symbol(<span class="string">&#x27;a2&#x27;</span>)</span><br><span class="line">a3=Symbol(<span class="string">&#x27;a3&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(solve([a1*<span class="number">3</span>+a2*<span class="number">2</span>+a3*<span class="number">5</span>-<span class="number">1003</span>,a1*<span class="number">4</span>+a2*<span class="number">7</span>+a3*<span class="number">9</span>-<span class="number">2013</span>,a2*<span class="number">8</span>+a1+a3*<span class="number">2</span>-<span class="number">1109</span>],[a1,a2,a3]))</span><br><span class="line"><span class="comment">#97 101 102</span></span><br><span class="line">a4=Symbol(<span class="string">&#x27;a4&#x27;</span>)</span><br><span class="line">a5=Symbol(<span class="string">&#x27;a5&#x27;</span>)</span><br><span class="line">a6=Symbol(<span class="string">&#x27;a6&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(solve([a4*<span class="number">3</span>+a5*<span class="number">2</span>+a6*<span class="number">5</span>-<span class="number">671</span>,a4*<span class="number">4</span>+a5*<span class="number">7</span>+a6*<span class="number">9</span>-<span class="number">1252</span>,a5*<span class="number">8</span>+a4+a6*<span class="number">2</span>-<span class="number">644</span>],[a4,a5,a6]))</span><br><span class="line"><span class="comment">#102 55 51</span></span><br><span class="line">flag=<span class="built_in">chr</span>(<span class="number">97</span>)+<span class="built_in">chr</span>(<span class="number">101</span>)+<span class="built_in">chr</span>(<span class="number">102</span>)+<span class="built_in">chr</span>(<span class="number">102</span>)+<span class="built_in">chr</span>(<span class="number">55</span>)+<span class="built_in">chr</span>(<span class="number">51</span>)</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line">output=[<span class="number">101</span>,<span class="number">96</span>,<span class="number">23</span>,<span class="number">68</span>,<span class="number">112</span>,<span class="number">42</span>,<span class="number">107</span>,<span class="number">62</span>,<span class="number">96</span>,<span class="number">53</span>,<span class="number">176</span>,<span class="number">179</span>,<span class="number">98</span>,<span class="number">53</span>,<span class="number">67</span>,<span class="number">29</span>,<span class="number">41</span>,<span class="number">120</span>,<span class="number">60</span>,</span><br><span class="line">    <span class="number">106</span>,<span class="number">51</span>,<span class="number">101</span>,<span class="number">178</span>,<span class="number">189</span>,<span class="number">101</span>,<span class="number">48</span>]</span><br><span class="line">en=[<span class="number">3</span>,<span class="number">37</span>,<span class="number">72</span>,<span class="number">9</span>,<span class="number">6</span>,<span class="number">132</span>]</span><br><span class="line">k=<span class="number">0</span></span><br><span class="line"><span class="built_in">str</span>=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">13</span>):</span><br><span class="line">    <span class="built_in">str</span>+=<span class="built_in">chr</span>(en[i%<span class="number">6</span>]^output[k+<span class="number">1</span>])</span><br><span class="line">    <span class="built_in">str</span>+=<span class="built_in">chr</span>(en[i%<span class="number">6</span>]^output[k])</span><br><span class="line">    k+=<span class="number">2</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">str</span>)</span><br><span class="line"><span class="comment"># cfa2b87b3f746a8f0ac5c5963f</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">chr</span>(<span class="number">1182843538814603</span>-(((<span class="built_in">ord</span>(<span class="string">&#x27;G&#x27;</span>)*<span class="number">2020</span>+<span class="built_in">ord</span>(<span class="string">&#x27;W&#x27;</span>))*<span class="number">2020</span>+<span class="built_in">ord</span>(<span class="string">&#x27;H&#x27;</span>))*<span class="number">2020</span>+<span class="built_in">ord</span>(<span class="string">&#x27;T&#x27;</span>))*<span class="number">2020</span>))</span><br></pre></td></tr></table></figure>
<p>得到flag{cfa2b87b3f746a8f0ac5c5963faeff73}</p>
<p>摸鱼摸鱼，只有一题</p>
<h2 id="ACTF新生赛2020-Splendid-MineCraft"><a href="#ACTF新生赛2020-Splendid-MineCraft" class="headerlink" title="[ACTF新生赛2020]Splendid_MineCraft"></a>[ACTF新生赛2020]Splendid_MineCraft</h2><p>一道smc类的题目</p>
<p>放进ida</p>
<!--more-->
<img src="/2022/01/28/BUUOJ-Reverse-1/image-20220320171115020.png" class title="image-20220320171115020">
<p>unk_4051DB为函数，相关内存经红框内代码修改</p>
<p>其中的strtok函数：</p>
<img src="/2022/01/28/BUUOJ-Reverse-1/image-20220320171523419.png" class title="image-20220320171523419">
<p>在此处下断点，开始动调</p>
<img src="/2022/01/28/BUUOJ-Reverse-1/image-20220320203654146.png" class title="image-20220320203654146">
<p>可以看到，运行过程中，代码在变化</p>
<p>读一下汇编可以发现，其实是将esi+0x1F~esi+0x1F+0x151这段代码进行异或</p>
<p>利用IDC(shift+f2)修改，附上IDC脚本</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;idc.idc&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">auto</span> addr=<span class="number">0x4051DD</span>+<span class="number">0x1F</span>;</span><br><span class="line">    <span class="keyword">auto</span> i;</span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;=<span class="number">0x151</span>;i++)&#123;</span><br><span class="line">        PatchByte(addr+i,Byte(addr+i)^<span class="number">0x72</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>得到比较漂亮的函数</p>
<img src="/2022/01/28/BUUOJ-Reverse-1/image-20220320211014168.png" class title="image-20220320211014168">
<p>这部分主要是将两个字符串异或然后加35，然后与输入的字符串作比较。</p>
<p>然后就可以获得第一段字符串：yOu0y*</p>
<p>第二部分打开OD动调，在0x00cb12ac处的jmp eax处下断点，开始运行</p>
<p>输入：ACTF{yOu0y*_123456_111111}</p>
<p>开始部分是将输入放到一段内存中</p>
<img src="/2022/01/28/BUUOJ-Reverse-1/image-20220320223452685.png" class title="image-20220320223452685">
<p>然后是将输入与0x83+i异或，并把结果作为数组下标来得到一定值</p>
<img src="/2022/01/28/BUUOJ-Reverse-1/image-20220320230827719.png" class title="image-20220320230827719">
<p>通过跟踪eax指向的地址，得到数组的值</p>
<img src="/2022/01/28/BUUOJ-Reverse-1/image-20220320231128607.png" class title="image-20220320231128607">
<p>将bl和cl比较，不相等的话则会失败，说明cl是最终加密得到的值</p>
<img src="/2022/01/28/BUUOJ-Reverse-1/image-20220320230412284.png" class title="image-20220320230412284">
<p>第二部分的结果也可以得到了：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">a=[ <span class="number">0xF6</span>,<span class="number">0xA3</span>,<span class="number">0x5B</span>,<span class="number">0x9D</span>,<span class="number">0xE0</span>,<span class="number">0x95</span>,<span class="number">0x98</span>,<span class="number">0x68</span>,<span class="number">0x8C</span>,<span class="number">0x65</span>,<span class="number">0xBB</span>,<span class="number">0x76</span>,<span class="number">0x89</span>,<span class="number">0xD4</span>,<span class="number">0x09</span>,<span class="number">0xFD</span>,</span><br><span class="line"> <span class="number">0xF3</span>,<span class="number">0x5C</span>,<span class="number">0x3C</span>,<span class="number">0x4C</span>,<span class="number">0x36</span>,<span class="number">0x8E</span>,<span class="number">0x4D</span>,<span class="number">0xC4</span>,<span class="number">0x80</span>,<span class="number">0x44</span>,<span class="number">0xD6</span>,<span class="number">0xA9</span>,<span class="number">0x01</span>,<span class="number">0x32</span>,<span class="number">0x77</span>,<span class="number">0x29</span>,</span><br><span class="line"> <span class="number">0x90</span>,<span class="number">0xBC</span>,<span class="number">0xC0</span>,<span class="number">0xA8</span>,<span class="number">0xD8</span>,<span class="number">0xF9</span>,<span class="number">0xE1</span>,<span class="number">0x1D</span>,<span class="number">0xE4</span>,<span class="number">0x67</span>,<span class="number">0x7D</span>,<span class="number">0x2A</span>,<span class="number">0x2C</span>,<span class="number">0x59</span>,<span class="number">0x9E</span>,<span class="number">0x3D</span>,</span><br><span class="line"> <span class="number">0x7A</span>,<span class="number">0x34</span>,<span class="number">0x11</span>,<span class="number">0x43</span>,<span class="number">0x74</span>,<span class="number">0xD1</span>,<span class="number">0x62</span>,<span class="number">0x60</span>,<span class="number">0x02</span>,<span class="number">0x4B</span>,<span class="number">0xAE</span>,<span class="number">0x99</span>,<span class="number">0x57</span>,<span class="number">0xC6</span>,<span class="number">0x73</span>,<span class="number">0xB0</span>,</span><br><span class="line"> <span class="number">0x33</span>,<span class="number">0x18</span>,<span class="number">0x2B</span>,<span class="number">0xFE</span>,<span class="number">0xB9</span>,<span class="number">0x85</span>,<span class="number">0xB6</span>,<span class="number">0xD9</span>,<span class="number">0xDE</span>,<span class="number">0x7B</span>,<span class="number">0xCF</span>,<span class="number">0x4F</span>,<span class="number">0xB3</span>,<span class="number">0xD5</span>,<span class="number">0x08</span>,<span class="number">0x7C</span>,</span><br><span class="line"> <span class="number">0x0A</span>,<span class="number">0x71</span>,<span class="number">0x12</span>,<span class="number">0x06</span>,<span class="number">0x37</span>,<span class="number">0xFF</span>,<span class="number">0x7F</span>,<span class="number">0xB7</span>,<span class="number">0x46</span>,<span class="number">0x42</span>,<span class="number">0x25</span>,<span class="number">0xC9</span>,<span class="number">0xD0</span>,<span class="number">0x50</span>,<span class="number">0x52</span>,<span class="number">0xCE</span>,</span><br><span class="line"> <span class="number">0xBD</span>,<span class="number">0x6C</span>,<span class="number">0xE5</span>,<span class="number">0x6F</span>,<span class="number">0xA5</span>,<span class="number">0x15</span>,<span class="number">0xED</span>,<span class="number">0x64</span>,<span class="number">0xF0</span>,<span class="number">0x23</span>,<span class="number">0x35</span>,<span class="number">0xE7</span>,<span class="number">0x0C</span>,<span class="number">0x61</span>,<span class="number">0xA4</span>,<span class="number">0xD7</span>,</span><br><span class="line"> <span class="number">0x51</span>,<span class="number">0x75</span>,<span class="number">0x9A</span>,<span class="number">0xF2</span>,<span class="number">0x1E</span>,<span class="number">0xEB</span>,<span class="number">0x58</span>,<span class="number">0xF1</span>,<span class="number">0x94</span>,<span class="number">0xC3</span>,<span class="number">0x2F</span>,<span class="number">0x56</span>,<span class="number">0xF7</span>,<span class="number">0xE6</span>,<span class="number">0x86</span>,<span class="number">0x47</span>,</span><br><span class="line"> <span class="number">0xFB</span>,<span class="number">0x83</span>,<span class="number">0x5E</span>,<span class="number">0xCC</span>,<span class="number">0x21</span>,<span class="number">0x4A</span>,<span class="number">0x24</span>,<span class="number">0x07</span>,<span class="number">0x1C</span>,<span class="number">0x8A</span>,<span class="number">0x5A</span>,<span class="number">0x17</span>,<span class="number">0x1B</span>,<span class="number">0xDA</span>,<span class="number">0xEC</span>,<span class="number">0x38</span>,</span><br><span class="line"> <span class="number">0x0E</span>,<span class="number">0x7E</span>,<span class="number">0xB4</span>,<span class="number">0x48</span>,<span class="number">0x88</span>,<span class="number">0xF4</span>,<span class="number">0xB8</span>,<span class="number">0x27</span>,<span class="number">0x91</span>,<span class="number">0x00</span>,<span class="number">0x13</span>,<span class="number">0x97</span>,<span class="number">0xBE</span>,<span class="number">0x53</span>,<span class="number">0xC2</span>,<span class="number">0xE8</span>,</span><br><span class="line"> <span class="number">0xEA</span>,<span class="number">0x1A</span>,<span class="number">0xE9</span>,<span class="number">0x2D</span>,<span class="number">0x14</span>,<span class="number">0x0B</span>,<span class="number">0xBF</span>,<span class="number">0xB5</span>,<span class="number">0x40</span>,<span class="number">0x79</span>,<span class="number">0xD2</span>,<span class="number">0x3E</span>,<span class="number">0x19</span>,<span class="number">0x5D</span>,<span class="number">0xF8</span>,<span class="number">0x69</span>,</span><br><span class="line"> <span class="number">0x39</span> ,<span class="number">0x5F</span> ,<span class="number">0xDB</span> ,<span class="number">0xFA</span> ,<span class="number">0xB2</span> ,<span class="number">0x8B</span> ,<span class="number">0x6E</span> ,<span class="number">0xA2</span> ,<span class="number">0xDF</span> ,<span class="number">0x16</span> ,<span class="number">0xE2</span> ,<span class="number">0x63</span> ,<span class="number">0xB1</span> ,<span class="number">0x20</span> ,<span class="number">0xCB</span> ,<span class="number">0xBA</span> ,</span><br><span class="line"> <span class="number">0xEE</span> ,<span class="number">0x8D</span> ,<span class="number">0xAA</span> ,<span class="number">0xC8</span> ,<span class="number">0xC7</span> ,<span class="number">0xC5</span> ,<span class="number">0x05</span> ,<span class="number">0x66</span> ,<span class="number">0x6D</span> ,<span class="number">0x3A</span> ,<span class="number">0x45</span> ,<span class="number">0x72</span> ,<span class="number">0x0D</span> ,<span class="number">0xCA</span> ,<span class="number">0x84</span> ,<span class="number">0x4E</span> ,</span><br><span class="line"> <span class="number">0xF5</span> ,<span class="number">0x31</span> ,<span class="number">0x6B</span> ,<span class="number">0x92</span> ,<span class="number">0xDC</span> ,<span class="number">0xDD</span> ,<span class="number">0x9C</span> ,<span class="number">0x3F</span> ,<span class="number">0x55</span> ,<span class="number">0x96</span> ,<span class="number">0xA1</span> ,<span class="number">0x9F</span> ,<span class="number">0xCD</span> ,<span class="number">0x9B</span> ,<span class="number">0xE3</span> ,<span class="number">0xA0</span> ,</span><br><span class="line"> <span class="number">0xA7</span> ,<span class="number">0xFC</span> ,<span class="number">0xC1</span> ,<span class="number">0x78</span> ,<span class="number">0x10</span> ,<span class="number">0x2E</span> ,<span class="number">0x82</span> ,<span class="number">0x8F</span> ,<span class="number">0x30</span> ,<span class="number">0x54</span> ,<span class="number">0x04</span> ,<span class="number">0xAC</span> ,<span class="number">0x41</span> ,<span class="number">0x93</span> ,<span class="number">0xD3</span> ,<span class="number">0x3B</span> ,</span><br><span class="line"> <span class="number">0xEF</span> ,<span class="number">0x03</span> ,<span class="number">0x81</span> ,<span class="number">0x70</span> ,<span class="number">0xA6</span> ,<span class="number">0x1F</span> ,<span class="number">0x22</span> ,<span class="number">0x26</span> ,<span class="number">0x28</span> ,<span class="number">0x6A</span> ,<span class="number">0xAB</span> ,<span class="number">0x87</span> ,<span class="number">0xAD</span> ,<span class="number">0x49</span> ,<span class="number">0x0F</span> ,<span class="number">0xAF</span> ,</span><br><span class="line">]</span><br><span class="line"><span class="comment"># print(hex(len(a)))</span></span><br><span class="line">result=[<span class="number">0x30</span>,<span class="number">0x04</span>,<span class="number">0x04</span>,<span class="number">0x03</span>,<span class="number">0x30</span>,<span class="number">0x63</span>]</span><br><span class="line">flag=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(result)):</span><br><span class="line">    t=a.index(result[i])</span><br><span class="line">    t^=(<span class="number">0x83</span>+i)</span><br><span class="line">    flag+=<span class="built_in">chr</span>(t)</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="comment">#knowo3</span></span><br></pre></td></tr></table></figure>
<p>第三部分则在程序流程图中可以找到</p>
<img src="/2022/01/28/BUUOJ-Reverse-1/image-20220320232638109.png" class title="image-20220320232638109">
<p>最终flag:ACTF{yOu0y*_knowo3_5mcsM&lt;}</p>
<h3 id="参考："><a href="#参考：" class="headerlink" title="参考："></a>参考：</h3><p><a target="_blank" rel="noopener" href="https://ppppz.net/2022/01/11/ACTF新生赛2020-Splendid-MineCraft/">ACTF新生赛2020-Splendid_MineCraft - P.Z’s Blog (ppppz.net)</a></p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/av808059550">[ACTF新生赛2020]Splendid_MineCraft 手把手带你跟汇编！_哔哩哔哩_bilibili</a></p>
<p>感觉这个up主，感觉讲得很详细，推荐！</p>
<p>上大分</p>
<h2 id="Dig-the-way"><a href="#Dig-the-way" class="headerlink" title="Dig the way"></a>Dig the way</h2><p>一道逆向题，考的是栈溢出hhhh</p>
<p>先大概读一下程序流程，首先会打开文件data，但附件中并没有给出，然后根据文件大小将文件中字符读取到v7_20这个数组中（注意该数组长度只有20）</p>
<img src="/2022/01/28/BUUOJ-Reverse-1/image-20220401200712278.png" class title="image-20220401200712278">
<p>然后通过函数做了某些处理，符合要求后进入get_key函数，并产生对应flag</p>
<img src="/2022/01/28/BUUOJ-Reverse-1/image-20220401201330972.png" class title="image-20220401201330972">
<p>那么大致思路就是如何操作使得判断时v9=0，再来看看func_ptr中的三个函数</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">signed</span> <span class="keyword">int</span> __cdecl <span class="title">func0</span><span class="params">(<span class="keyword">int</span> a1, <span class="keyword">int</span> a2, <span class="keyword">int</span> a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> temp; <span class="comment">// [esp+Ch] [ebp-4h]</span></span><br><span class="line"></span><br><span class="line">  temp = *(_DWORD *)(<span class="number">4</span> * a2 + a1);</span><br><span class="line">  *(_DWORD *)(a1 + <span class="number">4</span> * a2) = *(_DWORD *)(<span class="number">4</span> * a3 + a1);</span><br><span class="line">  *(_DWORD *)(a1 + <span class="number">4</span> * a3) = temp;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>大概就是交换两个数的值</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">unsigned</span> <span class="keyword">int</span> __cdecl <span class="title">func1</span><span class="params">(<span class="keyword">int</span> basic_address, <span class="keyword">int</span> a2, <span class="keyword">int</span> a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">return</span> abs32(*(_DWORD *)(<span class="number">4</span> * a2 + basic_address) + *(_DWORD *)(<span class="number">4</span> * a3 + basic_address))</span><br><span class="line">       - abs32(*(_DWORD *)(<span class="number">4</span> * a3 + basic_address))</span><br><span class="line">       - abs32(*(_DWORD *)(<span class="number">4</span> * a2 + basic_address))</span><br><span class="line">       + <span class="number">2</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>返回 $|x+y|-|x|-|y|+2$</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">unsigned</span> <span class="keyword">int</span> __cdecl <span class="title">func2</span><span class="params">(<span class="keyword">int</span> a1, <span class="keyword">int</span> a2, <span class="keyword">int</span> a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">return</span> abs32(*(_DWORD *)(<span class="number">4</span> * a3 + a1))</span><br><span class="line">       - abs32(*(_DWORD *)(<span class="number">4</span> * a3 + a1) + *(_DWORD *)(<span class="number">4</span> * a2 + a1))</span><br><span class="line">       + abs32(*(_DWORD *)(<span class="number">4</span> * a2 + a1))</span><br><span class="line">       + <span class="number">2</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>返回 $|x|+|y|-|x+y|+2$</p>
<p>在第三轮时，v6=3，v8[v6]恰好就是v9，因此第三个函数的执行将决定了v9的值。</p>
<p>然而在func2中，由不等式$|x|+|y| \geq |x+y| $可知，该函数最少也会返回2</p>
<p>那么如何解决该问题？思路是利用栈溢出修改函数运行顺序，让第三轮运行func1函数，并令参数一个为2，另一个为-1.</p>
<p>利用读取data文件的溢出漏洞，实现覆盖变量值，并据此写出data文件的内容</p>
<img src="/2022/01/28/BUUOJ-Reverse-1/image-20220401203034967.png" class title="image-20220401203034967">
<p>得到flag: 8cda1bdbb92900b9291bdb8cda</p>
<h2 id="watevrCTF-2019-Repyc"><a href="#watevrCTF-2019-Repyc" class="headerlink" title="[watevrCTF 2019]Repyc"></a>[watevrCTF 2019]Repyc</h2><p>下载得到pyc文件，反编译得到一堆奇怪的代码</p>
<img src="/2022/01/28/BUUOJ-Reverse-1/image-20220406200533260.png" class title="image-20220406200533260">
<p>变量替换，弄好看点，发现其实是个vm题</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># visit https://tool.lu/pyc/ for more information</span></span><br><span class="line">value_0 = <span class="number">0</span></span><br><span class="line">v2 = <span class="number">1</span></span><br><span class="line">v3 = <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func1</span>(<span class="params">par1</span>):</span></span><br><span class="line">    local1 = <span class="number">0</span></span><br><span class="line">    local2 = <span class="number">0</span></span><br><span class="line">    array_0 = [<span class="number">0</span>] * <span class="number">16</span></span><br><span class="line">    array2 = [<span class="number">0</span>] * <span class="number">100</span></span><br><span class="line">    local5 = []</span><br><span class="line">    <span class="keyword">while</span> par1[local1][value_0] != <span class="string">&#x27;finish&#x27;</span>:</span><br><span class="line">        local6 = par1[local1][value_0]</span><br><span class="line">        local7 = par1[local1][<span class="number">1</span>:]</span><br><span class="line">        <span class="keyword">if</span> local6 == <span class="string">&#x27;addition&#x27;</span>:</span><br><span class="line">            array_0[local7[value_0]] = array_0[local7[<span class="number">1</span>]] + array_0[local7[<span class="number">2</span>]]</span><br><span class="line">        <span class="keyword">elif</span> local6 == <span class="string">&#x27;\xeb\xa0\x80&#x27;</span>:</span><br><span class="line">            array_0[local7[value_0]] = array_0[local7[<span class="number">1</span>]] ^ array_0[local7[<span class="number">2</span>]]</span><br><span class="line">        <span class="keyword">elif</span> local6 == <span class="string">&#x27;\xeb\xa0\xb3&#x27;</span>:</span><br><span class="line">            array_0[local7[value_0]] = array_0[local7[<span class="number">1</span>]] - array_0[local7[<span class="number">2</span>]]</span><br><span class="line">        <span class="keyword">elif</span> local6 == <span class="string">&#x27;multiple&#x27;</span>:</span><br><span class="line">            array_0[local7[value_0]] = array_0[local7[<span class="number">1</span>]] * array_0[local7[<span class="number">2</span>]]</span><br><span class="line">        <span class="keyword">elif</span> local6 == <span class="string">&#x27;\xeb\xa2\xaf&#x27;</span>:</span><br><span class="line">            array_0[local7[value_0]] = array_0[local7[<span class="number">1</span>]] / array_0[local7[<span class="number">2</span>]]</span><br><span class="line">        <span class="keyword">elif</span> local6 == <span class="string">&#x27;\xeb\xa5\x87&#x27;</span>:</span><br><span class="line">            array_0[local7[value_0]] = array_0[local7[<span class="number">1</span>]] &amp; array_0[local7[<span class="number">2</span>]]</span><br><span class="line">        <span class="keyword">elif</span> local6 == <span class="string">&#x27;\xeb\xa7\xb3&#x27;</span>:</span><br><span class="line">            array_0[local7[value_0]] = array_0[local7[<span class="number">1</span>]] | array_0[local7[<span class="number">2</span>]]</span><br><span class="line">        <span class="keyword">elif</span> local6 == <span class="string">&#x27;nop&#x27;</span>:</span><br><span class="line">            array_0[local7[value_0]] = array_0[local7[value_0]]</span><br><span class="line">        <span class="keyword">elif</span> local6 == <span class="string">&#x27;\xeb\xab\x87&#x27;</span>:</span><br><span class="line">            array_0[local7[value_0]] = array_0[local7[<span class="number">1</span>]]</span><br><span class="line">        <span class="keyword">elif</span> local6 == <span class="string">&#x27;LoadParToArray_0&#x27;</span>:</span><br><span class="line">            array_0[local7[value_0]] = local7[<span class="number">1</span>]  <span class="comment">#加载参数到array[0]，参数1为位置，参数2为被加载的参数</span></span><br><span class="line">        <span class="keyword">elif</span> local6 == <span class="string">&#x27;\xeb\xab\xbb&#x27;</span>:</span><br><span class="line">            array2[local7[value_0]] = array_0[local7[<span class="number">1</span>]]</span><br><span class="line">        <span class="keyword">elif</span> local6 == <span class="string">&#x27;\xeb\x94\x93&#x27;</span>:</span><br><span class="line">            array_0[local7[value_0]] = array2[local7[<span class="number">1</span>]]</span><br><span class="line">        <span class="keyword">elif</span> local6 == <span class="string">&#x27;\xeb\x8c\x92&#x27;</span>:</span><br><span class="line">            array_0[local7[value_0]] = value_0</span><br><span class="line">        <span class="keyword">elif</span> local6 == <span class="string">&#x27;\xeb\xac\x87&#x27;</span>:</span><br><span class="line">            array2[local7[value_0]] = value_0</span><br><span class="line">        <span class="keyword">elif</span> local6 == <span class="string">&#x27;\xeb\xac\x9f&#x27;</span>:</span><br><span class="line">            array_0[local7[value_0]] = <span class="built_in">input</span>(array_0[local7[<span class="number">1</span>]])</span><br><span class="line">        <span class="keyword">elif</span> local6 == <span class="string">&#x27;getInput&#x27;</span>:</span><br><span class="line">            array2[local7[value_0]] = <span class="built_in">input</span>(array_0[local7[<span class="number">1</span>]]) <span class="comment">#input</span></span><br><span class="line">        <span class="keyword">elif</span> local6 == <span class="string">&#x27;printArray_0&#x27;</span>:</span><br><span class="line">            <span class="built_in">print</span>(array_0[local7[value_0]])</span><br><span class="line">        <span class="keyword">elif</span> local6 == <span class="string">&#x27;\xeb\xad\x97&#x27;</span>:</span><br><span class="line">            <span class="built_in">print</span>(array2[local7[value_0]])</span><br><span class="line">        <span class="keyword">elif</span> local6 == <span class="string">&#x27;\xeb\xad\xbf&#x27;</span>:</span><br><span class="line">            local1 = array_0[local7[value_0]]</span><br><span class="line">        <span class="keyword">elif</span> local6 == <span class="string">&#x27;\xeb\xae\x93&#x27;</span>:</span><br><span class="line">            local1 = array2[local7[value_0]]</span><br><span class="line">        <span class="keyword">elif</span> local6 == <span class="string">&#x27;\xeb\xae\xb3&#x27;</span>:</span><br><span class="line">            local1 = local5.pop()</span><br><span class="line">        <span class="keyword">elif</span> local6 == <span class="string">&#x27;\xeb\xaf\x83&#x27;</span> :<span class="comment">#or array_0[local7[1]] &gt; array_0[local7[2]]:</span></span><br><span class="line">            local1 = local7[value_0]</span><br><span class="line">            local5.append(local1)</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">elif</span> local6 == <span class="string">&#x27;\xea\xbd\xb2&#x27;</span>:</span><br><span class="line">            array_0[<span class="number">7</span>] = value_0</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(array_0[local7[value_0]])):</span><br><span class="line">                <span class="keyword">if</span> array_0[local7[value_0]] != array_0[local7[<span class="number">1</span>]]:</span><br><span class="line">                    array_0[<span class="number">7</span>] = <span class="number">1</span></span><br><span class="line">                    local1 = array_0[local7[<span class="number">2</span>]]</span><br><span class="line">                    local5.append(local1)</span><br><span class="line">        <span class="keyword">elif</span> local6 == <span class="string">&#x27;stringXOR&#x27;</span>:</span><br><span class="line">            local8 = <span class="string">&#x27;&#x27;</span></span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(array_0[local7[value_0]])):</span><br><span class="line">                local8 += <span class="built_in">chr</span>(<span class="built_in">ord</span>(array_0[local7[value_0]][i]) ^ array_0[local7[<span class="number">1</span>]])</span><br><span class="line">            </span><br><span class="line">            array_0[local7[value_0]] = local8</span><br><span class="line">        <span class="keyword">elif</span> local6 == <span class="string">&#x27;StringSubtraction&#x27;</span>:</span><br><span class="line">            local8 = <span class="string">&#x27;&#x27;</span></span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(array_0[local7[value_0]])):</span><br><span class="line">                local8 += <span class="built_in">chr</span>(<span class="built_in">ord</span>(array_0[local7[value_0]][i]) - array_0[local7[<span class="number">1</span>]])</span><br><span class="line">            </span><br><span class="line">            array_0[local7[value_0]] = local8</span><br><span class="line">        <span class="keyword">elif</span> local6 == <span class="string">&#x27;\xeb\x96\x87&#x27;</span> <span class="keyword">or</span> array_0[local7[<span class="number">1</span>]] &gt; array_0[local7[<span class="number">2</span>]]:</span><br><span class="line">            local1 = array_0[local7[value_0]]</span><br><span class="line">            local5.append(local1)</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">elif</span> local6 == <span class="string">&#x27;\xeb\x97\x8b&#x27;</span> <span class="keyword">or</span> array_0[local7[<span class="number">1</span>]] &gt; array_0[local7[<span class="number">2</span>]]:</span><br><span class="line">            local1 = array2[local7[value_0]]</span><br><span class="line">            local5.append(local1)</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">elif</span> local6 == <span class="string">&#x27;\xeb\x98\xb7&#x27;</span> <span class="keyword">or</span> array_0[local7[<span class="number">1</span>]] == array_0[local7[<span class="number">2</span>]]:</span><br><span class="line">            local1 = local7[value_0]</span><br><span class="line">            local5.append(local1)</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">elif</span> local6 == <span class="string">&#x27;\xeb\x9a\xab&#x27;</span> <span class="keyword">or</span> array_0[local7[<span class="number">1</span>]] == array_0[local7[<span class="number">2</span>]]:</span><br><span class="line">            local1 = array_0[local7[value_0]]</span><br><span class="line">            local5.append(local1)</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">elif</span> local6 == <span class="string">&#x27;\xeb\x9d\x87&#x27;</span> <span class="keyword">and</span> array_0[local7[<span class="number">1</span>]] == array_0[local7[<span class="number">2</span>]]:</span><br><span class="line">            local1 = array2[local7[value_0]]</span><br><span class="line">            local5.append(local1)</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        local1 += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">func1([</span><br><span class="line">    [</span><br><span class="line">        <span class="string">&#x27;LoadParToArray_0&#x27;</span>,</span><br><span class="line">        value_0,</span><br><span class="line">        <span class="string">&#x27;Authentication token: &#x27;</span>], <span class="comment">#装载该字符串,array[0]=&#x27;Authentication token: &#x27;</span></span><br><span class="line">    [</span><br><span class="line">        <span class="string">&#x27;getInput&#x27;</span>, <span class="comment">#获取输入，装载到array2[0]</span></span><br><span class="line">        value_0,</span><br><span class="line">        value_0],</span><br><span class="line">    [</span><br><span class="line">        <span class="string">&#x27;LoadParToArray_0&#x27;</span>,  <span class="string">&#x27;\xc3\xa1\xc3\x97\xc3\xa4\xc3\x93\xc3\xa2\xc3\xa6\xc3\xad\xc3\xa4\xc3\xa0\xc3\x9f\xc3\xa5\xc3\x89\xc3\x9b\xc3\xa3\xc3\xa5\xc3\xa4\xc3\x89\xc3\x96\xc3\x93\xc3\x89\xc3\xa4\xc3\xa0\xc3\x93\xc3\x89\xc3\x96\xc3\x93\xc3\xa5\xc3\xa4\xc3\x89\xc3\x93\xc3\x9a\xc3\x95\xc3\xa6\xc3\xaf\xc3\xa8\xc3\xa4\xc3\x9f\xc3\x99\xc3\x9a\xc3\x89\xc3\x9b\xc3\x93\xc3\xa4\xc3\xa0\xc3\x99\xc3\x94\xc3\x89\xc3\x93\xc3\xa2\xc3\xa6\xc3\x89\xc3\xa0\xc3\x93\xc3\x9a\xc3\x95\xc3\x93\xc3\x92\xc3\x99\xc3\xa6\xc3\xa4\xc3\xa0\xc3\x89\xc3\xa4\xc3\xa0\xc3\x9f\xc3\xa5\xc3\x89\xc3\x9f\xc3\xa5\xc3\x89\xc3\xa4\xc3\xa0\xc3\x93\xc3\x89\xc3\x9a\xc3\x93\xc3\xa1\xc3\x89\xc2\xb7\xc3\x94\xc3\xa2\xc3\x97\xc3\x9a\xc3\x95\xc3\x93\xc3\x94\xc3\x89\xc2\xb3\xc3\x9a\xc3\x95\xc3\xa6\xc3\xaf\xc3\xa8\xc3\xa4\xc3\x9f\xc3\x99\xc3\x9a\xc3\x89\xc3\x85\xc3\xa4\xc3\x97\xc3\x9a\xc3\x94\xc3\x97\xc3\xa6\xc3\x94\xc3\x89\xc3\x97\xc3\x9a\xc3\xaf\xc3\xa1\xc3\x97\xc3\xaf\xc3\xa5\xc3\x89\xc3\x9f\xc3\x89\xc3\x94\xc3\x99\xc3\x9a\xc3\xa4\xc3\x89\xc3\xa6\xc3\x93\xc3\x97\xc3\x9c\xc3\x9c\xc3\xaf\xc3\x89\xc3\xa0\xc3\x97\xc3\xa2\xc3\x93\xc3\x89\xc3\x97\xc3\x89\xc3\x91\xc3\x99\xc3\x99\xc3\x94\xc3\x89\xc3\xa2\xc3\x9f\xc3\x94\xc3\x89\xc3\x96\xc3\xa3\xc3\xa4\xc3\x89\xc3\x9f\xc3\x89\xc3\xa6\xc3\x93\xc3\x97\xc3\x9c\xc3\x9c\xc3\xaf\xc3\x89\xc3\x93\xc3\x9a\xc3\x9e\xc3\x99\xc3\xaf\xc3\x89\xc3\xa4\xc3\xa0\xc3\x9f\xc3\xa5\xc3\x89\xc3\xa5\xc3\x99\xc3\x9a\xc3\x91\xc3\x89\xc3\x9f\xc3\x89\xc3\xa0\xc3\x99\xc3\xa8\xc3\x93\xc3\x89\xc3\xaf\xc3\x99\xc3\xa3\xc3\x89\xc3\xa1\xc3\x9f\xc3\x9c\xc3\x9c\xc3\x89\xc3\x93\xc3\x9a\xc3\x9e\xc3\x99\xc3\xaf\xc3\x89\xc3\x9f\xc3\xa4\xc3\x89\xc3\x97\xc3\xa5\xc3\xa1\xc3\x93\xc3\x9c\xc3\x9c\xc2\x97\xc3\x89\xc3\xaf\xc3\x99\xc3\xa3\xc3\xa4\xc3\xa3\xc3\x96\xc3\x93\xc2\x9a\xc3\x95\xc3\x99\xc3\x9b\xc2\x99\xc3\xa1\xc3\x97\xc3\xa4\xc3\x95\xc3\xa0\xc2\xa9\xc3\xa2\xc2\xab\xc2\xb3\xc2\xa3\xc3\xaf\xc2\xb2\xc3\x95\xc3\x94\xc3\x88\xc2\xb7\xc2\xb1\xc3\xa2\xc2\xa8\xc3\xab&#x27;</span>],</span><br><span class="line">    [</span><br><span class="line">        <span class="string">&#x27;LoadParToArray_0&#x27;</span>, <span class="comment">#array0[2]=120</span></span><br><span class="line">        <span class="number">2</span>,</span><br><span class="line">        <span class="number">120</span>],</span><br><span class="line">    [</span><br><span class="line">        <span class="string">&#x27;LoadParToArray_0&#x27;</span>, <span class="comment"># array0[4]=15</span></span><br><span class="line">        <span class="number">4</span>,</span><br><span class="line">        <span class="number">15</span>],</span><br><span class="line">    [</span><br><span class="line">        <span class="string">&#x27;LoadParToArray_0&#x27;</span>, <span class="comment">#array0[3]=1</span></span><br><span class="line">        <span class="number">3</span>,</span><br><span class="line">        <span class="number">1</span>],</span><br><span class="line">    [</span><br><span class="line">        <span class="string">&#x27;multiple&#x27;</span>, <span class="comment">#array0[2]=2*3=6</span></span><br><span class="line">        <span class="number">2</span>,</span><br><span class="line">        <span class="number">2</span>,</span><br><span class="line">        <span class="number">3</span>],</span><br><span class="line">    [</span><br><span class="line">        <span class="string">&#x27;addition&#x27;</span>, <span class="comment">#array0[2]=135</span></span><br><span class="line">        <span class="number">2</span>,</span><br><span class="line">        <span class="number">2</span>,</span><br><span class="line">        <span class="number">4</span>],</span><br><span class="line">    [</span><br><span class="line">        <span class="string">&#x27;nop&#x27;</span>,</span><br><span class="line">        value_0,</span><br><span class="line">        <span class="number">2</span>],</span><br><span class="line">    [</span><br><span class="line">        <span class="string">&#x27;\xeb\x8c\x92&#x27;</span>, <span class="comment">#array0[3]=0</span></span><br><span class="line">        <span class="number">3</span>],</span><br><span class="line">    [</span><br><span class="line">        <span class="string">&#x27;stringXOR&#x27;</span>, <span class="comment">#array0[6]=字符串^0</span></span><br><span class="line">        <span class="number">6</span>,</span><br><span class="line">        <span class="number">3</span>],</span><br><span class="line">    [</span><br><span class="line">        <span class="string">&#x27;LoadParToArray_0&#x27;</span>,<span class="comment">#array0[0]=&#x27;Thanks.&#x27;</span></span><br><span class="line">        value_0,</span><br><span class="line">        <span class="string">&#x27;Thanks.&#x27;</span>],</span><br><span class="line">    [</span><br><span class="line">        <span class="string">&#x27;LoadParToArray_0&#x27;</span>,<span class="comment">#array0[1]=&#x27;Authorizing access...&#x27;</span></span><br><span class="line">        <span class="number">1</span>,</span><br><span class="line">        <span class="string">&#x27;Authorizing access...&#x27;</span>],</span><br><span class="line">    [</span><br><span class="line">        <span class="string">&#x27;printArray_0&#x27;</span>,</span><br><span class="line">        value_0],</span><br><span class="line">    [</span><br><span class="line">        <span class="string">&#x27;\xeb\x94\x93&#x27;</span>,<span class="comment"># 将输入字符串装载到array_0[0]中</span></span><br><span class="line">        value_0,</span><br><span class="line">        value_0],</span><br><span class="line">    [</span><br><span class="line">        <span class="string">&#x27;stringXOR&#x27;</span>,<span class="comment"># ^135</span></span><br><span class="line">        value_0,</span><br><span class="line">        <span class="number">2</span>],</span><br><span class="line">    [</span><br><span class="line">        <span class="string">&#x27;StringSubtraction&#x27;</span>,<span class="comment"># 输入字符串-15</span></span><br><span class="line">        value_0,</span><br><span class="line">        <span class="number">4</span>],</span><br><span class="line">    [</span><br><span class="line">        <span class="string">&#x27;LoadParToArray_0&#x27;</span>,<span class="comment"># array0[5]=19</span></span><br><span class="line">        <span class="number">5</span>,</span><br><span class="line">        <span class="number">19</span>],</span><br><span class="line">    [</span><br><span class="line">        <span class="string">&#x27;\xea\xbd\xb2&#x27;</span>,</span><br><span class="line">        value_0,</span><br><span class="line">        <span class="number">6</span>,</span><br><span class="line">        <span class="number">5</span>],</span><br><span class="line">    [</span><br><span class="line">        <span class="string">&#x27;printArray_0&#x27;</span>, <span class="comment">#success</span></span><br><span class="line">        <span class="number">1</span>],</span><br><span class="line">    [</span><br><span class="line">        <span class="string">&#x27;finish&#x27;</span>],</span><br><span class="line">    [</span><br><span class="line">        <span class="string">&#x27;LoadParToArray_0&#x27;</span>,  <span class="comment">#fail</span></span><br><span class="line">        <span class="number">1</span>,</span><br><span class="line">        <span class="string">&#x27;Access denied!&#x27;</span>],</span><br><span class="line">    [</span><br><span class="line">        <span class="string">&#x27;printArray_0&#x27;</span>,</span><br><span class="line">        <span class="number">1</span>],</span><br><span class="line">    [</span><br><span class="line">        <span class="string">&#x27;finish&#x27;</span>]])</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>通过一步步分析可以发现，程序流程是对输入字符串和135异或，然后减15，与目标密文对比判断是否正确</p>
<p>逆一下得到flag:flag{this_must_be_the_best_encryption_method_evr_henceforth_this_is_the_new_Advanced_Encryption_Standard_anyways_i_dont_really_have_a_good_vid_but_i_really_enjoy_this_song_i_hope_you_will_enjoy_it_aswell!_youtube.com/watch?v=E5yFcdPAGv0}</p>
<h2 id="ctfshow-逆向4"><a href="#ctfshow-逆向4" class="headerlink" title="[ctfshow]逆向4"></a>[ctfshow]逆向4</h2><p>一道链表题</p>
<p>拖进IDA，一开始有点懵，找到输入输出的字符串</p>
<img src="/2022/01/28/BUUOJ-Reverse-1/image-20220407115532731.png" class title="image-20220407115532731">
<p>注意由于不是utf-8编码，需要alt+a改变编码方式（注意关掉微信，不然会调出微信的截图功能）</p>
<p>继续看，点进sub_7FF7211C10E0中查看，一开始是一段类似辗转相除的算法，只是将结果替换为数组中的值</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">v2 = <span class="number">0</span>;</span><br><span class="line">  input2 = input;</span><br><span class="line">  <span class="keyword">if</span> ( input )</span><br><span class="line">  &#123;</span><br><span class="line">    v4 = &amp;v9;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">      ++v4;</span><br><span class="line">      ++v2;</span><br><span class="line">      v5 = StrangeArray1[input2 + <span class="number">-26</span> * (input2 / <span class="number">26</span>)];<span class="comment">// 类似辗转相除</span></span><br><span class="line">      input2 /= <span class="number">26</span>i64;</span><br><span class="line">      *(v4 - <span class="number">1</span>) = v5;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ( input2 );</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>然后是sub_7FF7211C11E0，这段是将上一段的结果异或7后通过链表串联起来，注意联系开始时初始化的那几个dword</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">_QWORD *__fastcall <span class="title">sub_7FF7211C11E0</span><span class="params">(<span class="keyword">char</span> a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  _QWORD *result; <span class="comment">// rax</span></span><br><span class="line">  __int64 v3; <span class="comment">// rdx</span></span><br><span class="line"></span><br><span class="line">  result = <span class="built_in">malloc</span>(<span class="number">0x10</span>ui64);</span><br><span class="line">  v3 = globalItem1;                             <span class="comment">// 最开始时给global1赋了一块内存，此时v3指向那块内存</span></span><br><span class="line">  globalItem1 = result;                         <span class="comment">// 类似链表的结构</span></span><br><span class="line">  *(v3 + <span class="number">8</span>) = result;</span><br><span class="line">  *v3 = a1;</span><br><span class="line">  result[<span class="number">1</span>] = <span class="number">0</span>i64;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>最后进到sub_7FF7211C1220()，其实这个函数的功能就是和函数中的数组作比较，然后判断是否成功</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> __noreturn <span class="title">sub_7FF7211C1220</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 v0; <span class="comment">// r9</span></span><br><span class="line">  <span class="keyword">int</span> v1; <span class="comment">// ecx</span></span><br><span class="line">  __int64 v2; <span class="comment">// rdx</span></span><br><span class="line">  <span class="keyword">char</span> v3; <span class="comment">// al</span></span><br><span class="line">  <span class="keyword">int</span> v4; <span class="comment">// er8</span></span><br><span class="line">  __int64 v5; <span class="comment">// r9</span></span><br><span class="line">  <span class="keyword">char</span> v6; <span class="comment">// cl</span></span><br><span class="line">  <span class="keyword">int</span> v7; <span class="comment">// eax</span></span><br><span class="line"></span><br><span class="line">  v0 = globalItem2;                             <span class="comment">// 链表头</span></span><br><span class="line">  v1 = <span class="number">0</span>;</span><br><span class="line">  v2 = <span class="number">0</span>i64;</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v3 = *v0;</span><br><span class="line">    v4 = v1 + <span class="number">1</span>;</span><br><span class="line">    v5 = *(v0 + <span class="number">8</span>);</span><br><span class="line">    <span class="keyword">if</span> ( v3 != StrangeArray2[v2 - <span class="number">1</span>] )</span><br><span class="line">      v4 = v1;</span><br><span class="line">    globalItem2 = v5;</span><br><span class="line">    <span class="keyword">if</span> ( !v5 )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    v6 = *v5;</span><br><span class="line">    v7 = v4 + <span class="number">1</span>;</span><br><span class="line">    v0 = *(v5 + <span class="number">8</span>);</span><br><span class="line">    <span class="keyword">if</span> ( v6 != StrangeArray2[v2] )</span><br><span class="line">      v7 = v4;</span><br><span class="line">    globalItem2 = v0;</span><br><span class="line">    <span class="keyword">if</span> ( v0 )</span><br><span class="line">    &#123;</span><br><span class="line">      v2 += <span class="number">2</span>i64;</span><br><span class="line">      v1 = v7;</span><br><span class="line">      <span class="keyword">if</span> ( v2 &lt; <span class="number">14</span> )</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">goto</span> LABEL_11;</span><br><span class="line">  &#125;</span><br><span class="line">  v7 = v4;</span><br><span class="line">LABEL_11:</span><br><span class="line">  <span class="keyword">if</span> ( v7 == <span class="number">14</span> )</span><br><span class="line">    success();</span><br><span class="line">  fail();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>最终脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">a=[<span class="number">0x2f</span>,<span class="number">0x2e</span>,<span class="number">0x2e</span>,<span class="number">0x76</span>,<span class="number">0x34</span>,<span class="number">0x70</span>,<span class="number">0x24</span>,<span class="number">0x24</span>,<span class="number">0x21</span>,<span class="number">0x3e</span>,<span class="number">0x59</span>,<span class="number">0x35</span>,<span class="number">0x39</span>,<span class="number">0x2d</span>]</span><br><span class="line">b=[<span class="number">0x29</span>,<span class="number">0x28</span>,<span class="number">0x2a</span>,<span class="number">0x26</span>,<span class="number">0x5e</span>,<span class="number">0x25</span>,<span class="number">0x34</span>,<span class="number">0x38</span>,<span class="number">0x39</span>,<span class="number">0x24</span>,<span class="number">0x21</span>,<span class="number">0x30</span>,<span class="number">0x35</span>,<span class="number">0x37</span>,<span class="number">0x40</span>,<span class="number">0x23</span>,<span class="number">0x3e</span>,<span class="number">0x3c</span>,<span class="number">0x3a</span>,<span class="number">0x32</span>,<span class="number">0x31</span>,<span class="number">0x36</span>,<span class="number">0x33</span>,<span class="number">0x71</span>,<span class="number">0x77</span>,<span class="number">0x65</span>]</span><br><span class="line">c=[]</span><br><span class="line">d=<span class="number">0</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(b))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(a)):</span><br><span class="line">    a[i]=a[i]^<span class="number">7</span></span><br><span class="line">    c.append(b.index(a[i]))</span><br><span class="line"><span class="built_in">print</span>(c)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(c)):</span><br><span class="line">    d*=<span class="number">26</span></span><br><span class="line">    d+=c[i]</span><br><span class="line"><span class="built_in">print</span>(d)</span><br></pre></td></tr></table></figure>
<h2 id="powerPacked"><a href="#powerPacked" class="headerlink" title="powerPacked"></a>powerPacked</h2><p>powerPC架构的，里面的指令根本读不懂，解题倒是很简单</p>
<p>加了个upx的壳，脱掉后就是很简单的对比：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> __cdecl <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> i; <span class="comment">// [sp+8h] [-58h]</span></span><br><span class="line">  _BYTE v5[<span class="number">32</span>]; <span class="comment">// [sp+10h] [-50h] BYREF</span></span><br><span class="line">  <span class="keyword">char</span> v6[<span class="number">24</span>]; <span class="comment">// [sp+30h] [-30h] BYREF</span></span><br><span class="line">  <span class="keyword">int</span> v7; <span class="comment">// [sp+48h] [-18h]</span></span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">char</span> **v8; <span class="comment">// [sp+4Ch] [-14h]</span></span><br><span class="line"></span><br><span class="line">  v7 = argc;</span><br><span class="line">  v8 = argv;</span><br><span class="line">  <span class="built_in">strcpy</span>(v6, <span class="string">&quot;EHK&#125;kanqxgarqygtre&quot;</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Insert password : &quot;</span>, argv, envp);</span><br><span class="line">  _isoc99_scanf(<span class="string">&quot;%31s&quot;</span>, v5);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">21</span>; ++i )</span><br><span class="line">    v6[i] -= <span class="number">2</span>;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="built_in">strcmp</span>(v5, v6) )</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Wrong password.&quot;</span>);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Password is correct. Submit this as the flag.&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>逐位减2后就得到了flag:CFI{i_love_powerpc}</p>
<h2 id="FlareOn4-greek-to-me"><a href="#FlareOn4-greek-to-me" class="headerlink" title="[FlareOn4]greek_to_me"></a>[FlareOn4]greek_to_me</h2><p>使用c实现的网络通信</p>
<img src="/2022/01/28/BUUOJ-Reverse-1/70.jpeg" class title="img">
<h4 id="相关函数："><a href="#相关函数：" class="headerlink" title="相关函数："></a>相关函数：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">int socket(int domain, int type, int protocol);</span><br></pre></td></tr></table></figure>
<ul>
<li>type：指定socket类型。常用的socket类型有，SOCK_STREAM、SOCK_DGRAM、SOCK_RAW、SOCK_PACKET、SOCK_SEQPACKET等等（socket的类型有哪些？）。</li>
<li>domain：即协议域，又称为协议族（family）。常用的协议族有，AF_INET、AF_INET6、AF_LOCAL（或称AF_UNIX，Unix域socket）、AF_ROUTE等等。协议族决定了socket的地址类型，在通信中必须采用对应的地址，如AF_INET决定了要用ipv4地址（32位的）与端口号（16位的）的组合、AF_UNIX决定了要用一个绝对路径名作为地址。</li>
<li>protocol：故名思意，就是指定协议。常用的协议有，IPPROTO_TCP、IPPTOTO_UDP、IPPROTO_SCTP、IPPROTO_TIPC等，它们分别对应TCP传输协议、UDP传输协议、STCP传输协议、TIPC传输协议</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">int bind(int sockfd, const struct sockaddr *addr, socklen_t addrlen);</span><br></pre></td></tr></table></figure>
<ul>
<li>sockfd：即socket描述字，它是通过socket()函数创建了，唯一标识一个socket。bind()函数就是将给这个描述字绑定一个名字</li>
<li>addr：一个const struct sockaddr *指针，指向要绑定给sockfd的协议地址。这个地址结构根据地址创建socket时的地址协议族的不同而不同，如ipv4对应的是：</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">struct sockaddr_in &#123;</span><br><span class="line">    sa_family_t    sin_family; </span><br><span class="line">    in_port_t      sin_port;   </span><br><span class="line">    struct in_addr sin_addr;   </span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">struct in_addr &#123;</span><br><span class="line">    uint32_t       s_addr;     </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="开始解题"><a href="#开始解题" class="headerlink" title="开始解题"></a>开始解题</h4><p>拖进IDA，发现与是用C实现的一段网络通信</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> __usercall sub_401008@&lt;eax&gt;(<span class="keyword">int</span> _EDI@&lt;edi&gt;, _DWORD *a2@&lt;esi&gt;)</span><br><span class="line">&#123;</span><br><span class="line">  _BYTE *v2; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">char</span> v3; <span class="comment">// dl</span></span><br><span class="line">  <span class="keyword">bool</span> v5; <span class="comment">// cf</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v6; <span class="comment">// ett</span></span><br><span class="line">  <span class="keyword">int</span> v7; <span class="comment">// edx</span></span><br><span class="line">  <span class="keyword">int</span> v9; <span class="comment">// [esp-4h] [ebp-1Ch]</span></span><br><span class="line">  <span class="keyword">char</span> buf[<span class="number">4</span>]; <span class="comment">// [esp+10h] [ebp-8h] BYREF</span></span><br><span class="line">  SOCKET s; <span class="comment">// [esp+14h] [ebp-4h]</span></span><br><span class="line">  <span class="keyword">int</span> savedregs; <span class="comment">// [esp+18h] [ebp+0h] BYREF</span></span><br><span class="line"></span><br><span class="line">  s = sub_401121(buf);                          <span class="comment">// 创建进程，并接收4字节的消息，消息写入buf中</span></span><br><span class="line">  <span class="keyword">if</span> ( !s )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  v2 = &amp;loc_40107C;</span><br><span class="line">  v3 = buf[<span class="number">0</span>];</span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">  &#123;</span><br><span class="line">    *v2 = (v3 ^ *v2) + <span class="number">34</span>;                      <span class="comment">// SMC</span></span><br><span class="line">    ++v2;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">while</span> ( (<span class="keyword">int</span>)v2 &lt; (<span class="keyword">int</span>)&amp;loc_40107C + <span class="number">121</span> );</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="keyword">unsigned</span> __int16)sub_4011E6(&amp;loc_40107C, <span class="number">121</span>) == <span class="number">64350</span> )<span class="comment">// SMC解密是否正确</span></span><br><span class="line">  &#123;</span><br><span class="line">    _EBX = *(_DWORD *)(v9 + <span class="number">377554449</span>);</span><br><span class="line">    __asm &#123; lock <span class="keyword">xor</span> bl, [edi+<span class="number">61791</span>C4h] &#125;</span><br><span class="line">    v5 = __CFADD__(*(_DWORD *)(<span class="number">8</span> * (_DWORD)a2 + <span class="number">0xFB5E</span>), <span class="number">-250248954</span>);</span><br><span class="line">    *(_DWORD *)(<span class="number">8</span> * (_DWORD)a2 + <span class="number">0xFB5E</span>) -= <span class="number">250248954</span>;</span><br><span class="line">    <span class="keyword">if</span> ( v9 == <span class="number">1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      v6 = v5 + <span class="number">427886322</span>;</span><br><span class="line">      v5 = MEMORY[<span class="number">0xFB5E</span>] &lt; v6;</span><br><span class="line">      MEMORY[<span class="number">0xFB5E</span>] -= v6;</span><br><span class="line">    &#125;</span><br><span class="line">    __asm &#123; icebp &#125;</span><br><span class="line">    *a2 -= v5 + <span class="number">530171120</span>;</span><br><span class="line">    v7 = *(_DWORD *)(v9 - <span class="number">1</span> + <span class="number">494994972</span>);</span><br><span class="line">    __outbyte(<span class="number">6u</span>, <span class="number">0x5E</span>u);</span><br><span class="line">    *(_DWORD *)(v7 - <span class="number">17</span>) &amp;= <span class="number">0xF2638106</span>;</span><br><span class="line">    MEMORY[<span class="number">0xFB41</span>] &amp;= <span class="number">0x66199C4</span>u;</span><br><span class="line">    *(a2 - <span class="number">17</span>) &amp;= <span class="number">0xE6678106</span>;</span><br><span class="line">    *(_DWORD *)(<span class="number">8</span> * (_DWORD)&amp;savedregs + <span class="number">64350</span> + <span class="number">6</span>) &amp;= <span class="number">0x69D6581</span>u;</span><br><span class="line">    *(_DWORD *)(v7 - <span class="number">14</span>) -= <span class="number">107715012</span>;</span><br><span class="line">    MEMORY[<span class="number">0xFB07</span>] += <span class="number">278298362</span>;</span><br><span class="line">    *(_DWORD *)((<span class="keyword">char</span> *)a2 - <span class="number">18</span>) += <span class="number">1368424186</span>;</span><br><span class="line">    *(_DWORD *)(_EBX + <span class="number">6</span>) -= <span class="number">116354433</span>;</span><br><span class="line">    *(_DWORD *)(v7 - <span class="number">23</span>) ^= <span class="number">0x7C738106</span>u;</span><br><span class="line">    send(s, <span class="string">&quot;Congratulations! But wait, where&#x27;s my flag?&quot;</span>, <span class="number">43</span>, <span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    send(s, <span class="string">&quot;Nope, that&#x27;s not it.&quot;</span>, <span class="number">20</span>, <span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  closesocket(s);</span><br><span class="line">  <span class="keyword">return</span> WSACleanup();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>中间有一段验证函数，但是这段函数不好逆，而总情况也只有256种，不如进行一个暴力破解</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">ip = <span class="string">&#x27;127.0.0.1&#x27;</span></span><br><span class="line">port = <span class="number">2222</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">    os.startfile(<span class="string">&quot;greek_to_me.exe&quot;</span>)</span><br><span class="line">    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">    s.connect((ip, port))</span><br><span class="line">    s.send(p32(i)) <span class="comment">#注意大小端，否则跑不出来</span></span><br><span class="line">    data = s.recv(<span class="number">1024</span>)</span><br><span class="line">    s.close()</span><br><span class="line">    <span class="built_in">print</span>(data)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">b&#x27;Congratulations&#x27;</span> <span class="keyword">in</span> data:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;that&#x27;s it!&quot;</span>)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="built_in">print</span>(i)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;end&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>跑出来i=162，进行动调</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">ip = <span class="string">&#x27;127.0.0.1&#x27;</span></span><br><span class="line">port = <span class="number">2222</span></span><br><span class="line">i=<span class="number">162</span></span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">s.connect((ip, port))</span><br><span class="line">s.send(p32(i))</span><br></pre></td></tr></table></figure>
<p>按c转为代码，flag就出来了</p>
<img src="/2022/01/28/BUUOJ-Reverse-1/image-20220412203813855.png" class title="image-20220412203813855">
<h2 id="GKCTF-2021-Crash"><a href="#GKCTF-2021-Crash" class="headerlink" title="[GKCTF 2021]Crash"></a>[GKCTF 2021]Crash</h2><p>go逆向，换了IDA7.7来做，感觉真不错</p>
<p>主要的判断函数为main_check</p>
<img src="/2022/01/28/BUUOJ-Reverse-1/image-20220417233517509.png" class title="image-20220417233517509">
<p>第一段是一段3DES+base64，key和iv在off_61e540中，解出来为87f645e9-b628-412f-9d7a-</p>
<img src="/2022/01/28/BUUOJ-Reverse-1/image-20220417233553524.png" class title="image-20220417233553524">
<p>第二段是Sha256碰撞</p>
<img src="/2022/01/28/BUUOJ-Reverse-1/image-20220417233928282.png" class title="image-20220417233928282">
<p>到第三段的时候就会发现问题：这段函数返回值为0，而事实上返回值必然不能为0；并且第三段哈希值并未给出，说明这段函数的反编译出了问题</p>
<p>进到汇编函数中，把对应的retn相关代码nop掉，这时候可以看到剩余的碰撞部分</p>
<img src="/2022/01/28/BUUOJ-Reverse-1/image-20220418001120366.png" class title="image-20220418001120366">
<p>整个脚本来跑碰撞：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line">h1=<span class="string">&#x27;6e2b55c78937d63490b4b26ab3ac3cb54df4c5ca7d60012c13d2d1234a732b74&#x27;</span> <span class="comment">#sha256</span></span><br><span class="line">h2=<span class="string">&#x27;6500fe72abcab63d87f213d2218b0ee086a1828188439ca485a1a40968fd272865d5ca4d5ef5a651270a52ff952d955c9b757caae1ecce804582ae78f87fa3c9&#x27;</span> <span class="comment">#sha512</span></span><br><span class="line">h3=<span class="string">&#x27;ff6e2fd78aca4736037258f0ede4ecf0&#x27;</span> <span class="comment">#md5</span></span><br><span class="line">s=<span class="string">&#x27;&#x27;</span></span><br><span class="line">ans1=<span class="string">&#x27;&#x27;</span></span><br><span class="line">ans2=<span class="string">&#x27;&#x27;</span></span><br><span class="line">ans3=<span class="string">&#x27;&#x27;</span></span><br><span class="line">table=<span class="string">&#x27;0123456789abcdef-&#x27;</span></span><br><span class="line"><span class="comment"># print(table)</span></span><br><span class="line"><span class="keyword">for</span> i1 <span class="keyword">in</span> table:</span><br><span class="line">    <span class="keyword">for</span> i2 <span class="keyword">in</span> table:</span><br><span class="line">        <span class="keyword">for</span> i3 <span class="keyword">in</span> table:</span><br><span class="line">            <span class="keyword">for</span> i4 <span class="keyword">in</span> table:</span><br><span class="line">                s=i1+i2+i3+i4</span><br><span class="line">                <span class="keyword">if</span> hashlib.sha256(s.encode()).hexdigest()==h1:</span><br><span class="line">                    ans1=s</span><br><span class="line">                <span class="keyword">if</span> hashlib.sha512(s.encode()).hexdigest()==h2:</span><br><span class="line">                    ans2=s</span><br><span class="line">                <span class="keyword">if</span> hashlib.md5(s.encode()).hexdigest()==h3:</span><br><span class="line">                    ans3=s</span><br><span class="line"><span class="built_in">print</span>(ans1+ans2+ans3)</span><br></pre></td></tr></table></figure>
<p>拼起来即可得到flag</p>
<h2 id="GKCTF-2021-SoMuchCode"><a href="#GKCTF-2021-SoMuchCode" class="headerlink" title="[GKCTF 2021]SoMuchCode"></a>[GKCTF 2021]SoMuchCode</h2><p>动调是个好东西</p>
<p>动调定位到输入和输出函数，然后在1209行找到关键的encrypt函数</p>
<img src="/2022/01/28/BUUOJ-Reverse-1/image-20220507200201619.png" class title="image-20220507200201619">
<p>点进行，按x查看引用，能大概看出是个XTEA算法</p>
<img src="/2022/01/28/BUUOJ-Reverse-1/image-20220507200239324.png" class title="image-20220507200239324">
<p>循环12轮</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">*input += ((key[(v75 &gt;&gt; <span class="number">2</span>) &amp; <span class="number">3</span>] ^ input[<span class="number">7</span>]) + (input[<span class="number">1</span>] ^ v75)) ^ (((<span class="number">16</span> * input[<span class="number">7</span>]) ^ (input[<span class="number">1</span>] &gt;&gt; <span class="number">3</span>)) + ((input[<span class="number">7</span>] &gt;&gt; <span class="number">5</span>) ^ (<span class="number">4</span> * input[<span class="number">1</span>])));</span><br><span class="line">input[<span class="number">1</span>] += (((key[v120] ^ input[<span class="number">0</span>]) + (input[<span class="number">2</span>] ^ v75)) ^ (((<span class="number">16</span> * input[<span class="number">0</span>]) ^ (input[<span class="number">2</span>] &gt;&gt; <span class="number">3</span>))+ ((input[<span class="number">0</span>] &gt;&gt; <span class="number">5</span>) ^ (<span class="number">4</span> * input[<span class="number">2</span>]))));</span><br><span class="line">input[<span class="number">2</span>] += + ((((<span class="number">16</span> * input[<span class="number">1</span>]) ^ (input[<span class="number">3</span>] &gt;&gt; <span class="number">3</span>)) + ((input[<span class="number">1</span>] &gt;&gt; <span class="number">5</span>) ^ (<span class="number">4</span> * input[<span class="number">3</span>]))) ^ ((input[<span class="number">3</span>] ^ v75) + (key[v123] ^ input[<span class="number">1</span>])));</span><br><span class="line">input[<span class="number">3</span>] += + ((((<span class="number">16</span> * input[<span class="number">2</span>]) ^ (input[<span class="number">4</span>] &gt;&gt; <span class="number">3</span>)) + ((input[<span class="number">2</span>] &gt;&gt; <span class="number">5</span>) ^ (<span class="number">4</span> * input[<span class="number">4</span>]))) ^ ((input[<span class="number">4</span>] ^ v75) + (key[v115 ^ <span class="number">3</span>] ^ input[<span class="number">2</span>])));</span><br><span class="line">input[<span class="number">4</span>]=input[<span class="number">4</span>] + ((((<span class="number">16</span> * input[<span class="number">3</span>]) ^ (input[<span class="number">5</span>] &gt;&gt; <span class="number">3</span>)) + ((input[<span class="number">3</span>] &gt;&gt; <span class="number">5</span>) ^ (<span class="number">4</span> * input[<span class="number">5</span>]))) ^ ((input[<span class="number">5</span>] ^ v75) + (key[v99] ^ input[<span class="number">3</span>])));</span><br><span class="line">input[<span class="number">5</span>]=(((key[v120] ^ input[<span class="number">4</span>]) + (input[<span class="number">6</span>] ^ v75)) ^ (((<span class="number">16</span> * input[<span class="number">4</span>]) ^ (input[<span class="number">6</span>] &gt;&gt; <span class="number">3</span>))+ ((input[<span class="number">4</span>] &gt;&gt; <span class="number">5</span>) ^ (<span class="number">4</span> * input[<span class="number">6</span>]))))+ v127</span><br><span class="line">input[<span class="number">6</span>]+= ((((<span class="number">16</span> * input[<span class="number">5</span>]) ^ (input[<span class="number">7</span>] &gt;&gt; <span class="number">3</span>)) + ((input[<span class="number">5</span>] &gt;&gt; <span class="number">5</span>) ^ (<span class="number">4</span> * input[<span class="number">7</span>]))) ^ ((key[v123] ^ input[<span class="number">5</span>])+ (input[<span class="number">7</span>] ^ v75)));</span><br><span class="line">input[<span class="number">7</span>] += ((input[<span class="number">6</span>]&gt;&gt;<span class="number">5</span>)+(input[<span class="number">0</span>]*<span class="number">4</span>) + ((input[<span class="number">0</span>] &gt;&gt; <span class="number">3</span>) ^ (<span class="number">16</span> * input[<span class="number">6</span>]))) ^ ((input[<span class="number">0</span>] ^ v75) + (key[v210] ^ input[<span class="number">6</span>]));</span><br></pre></td></tr></table></figure>
<p>每轮加密过程如以下形式，v75可以推测是sum值，动调出来发现每轮自增0x33445566</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">input[x] += + ((((16 * input[x-1]) ^ (input[x+1] &gt;&gt; 3)) + ((input[x-1] &gt;&gt; 5) ^ (4 * input[x+1]))) ^ ((input[x+1] ^ v75) + (key[?] ^ input[1])));</span><br></pre></td></tr></table></figure>
<p>动调找到key</p>
<img src="/2022/01/28/BUUOJ-Reverse-1/image-20220507155120187.png" class title="image-20220507155120187">
<p>动调找到要对比的数据</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">.data:00007FF6C82CA6D0 byte_7FF6C82CA6D0 db 5Ch                ; DATA XREF: main+F69↑w</span><br><span class="line">.data:00007FF6C82CA6D0                                         ; main:loc_7FF6C82C3945↑w ...</span><br><span class="line">.data:00007FF6C82CA6D1 byte_7FF6C82CA6D1 db 0ABh               ; DATA XREF: main+1119↑w</span><br><span class="line">.data:00007FF6C82CA6D1                                         ; main:loc_7FF6C82C3AF5↑w</span><br><span class="line">.data:00007FF6C82CA6D2 byte_7FF6C82CA6D2 db 3Ch                ; DATA XREF: main+12C9↑w</span><br><span class="line">.data:00007FF6C82CA6D2                                         ; main:loc_7FF6C82C3CA5↑w</span><br><span class="line">.data:00007FF6C82CA6D3 byte_7FF6C82CA6D3 db 99h                ; DATA XREF: main+147A↑w</span><br><span class="line">.data:00007FF6C82CA6D3                                         ; main:loc_7FF6C82C3E56↑w</span><br><span class="line">.data:00007FF6C82CA6D4 byte_7FF6C82CA6D4 db 29h                ; DATA XREF: main:loc_7FF6C82C3F1F↑w</span><br><span class="line">.data:00007FF6C82CA6D5 byte_7FF6C82CA6D5 db 0E1h               ; DATA XREF: main:loc_7FF6C82C3FEF↑w</span><br><span class="line">.data:00007FF6C82CA6D6 byte_7FF6C82CA6D6 db 40h                ; DATA XREF: main:loc_7FF6C82C40BF↑w</span><br><span class="line">.data:00007FF6C82CA6D7 byte_7FF6C82CA6D7 db 3Fh                ; DATA XREF: main:loc_7FF6C82C418F↑w</span><br><span class="line">.data:00007FF6C82CA6D8 byte_7FF6C82CA6D8 db 0DEh               ; DATA XREF: main:loc_7FF6C82C425F↑w</span><br><span class="line">.data:00007FF6C82CA6D9 byte_7FF6C82CA6D9 db 91h                ; DATA XREF: main:loc_7FF6C82C432F↑w</span><br><span class="line">.data:00007FF6C82CA6DA byte_7FF6C82CA6DA db 77h                ; DATA XREF: main:loc_7FF6C82C43FF↑w</span><br><span class="line">.data:00007FF6C82CA6DB byte_7FF6C82CA6DB db 77h                ; DATA XREF: main:loc_7FF6C82C44CF↑w</span><br><span class="line">.data:00007FF6C82CA6DC byte_7FF6C82CA6DC db 0A6h               ; DATA XREF: main:loc_7FF6C82C459F↑w</span><br><span class="line">.data:00007FF6C82CA6DD byte_7FF6C82CA6DD db 0FEh               ; DATA XREF: main:loc_7FF6C82C466F↑w</span><br><span class="line">.data:00007FF6C82CA6DE byte_7FF6C82CA6DE db 7Dh                ; DATA XREF: main:loc_7FF6C82C473F↑w</span><br><span class="line">.data:00007FF6C82CA6DF byte_7FF6C82CA6DF db 73h                ; DATA XREF: main:loc_7FF6C82C480F↑w</span><br><span class="line">.data:00007FF6C82CA6E0 byte_7FF6C82CA6E0 db 0E6h               ; DATA XREF: main:loc_7FF6C82C48DF↑w</span><br><span class="line">.data:00007FF6C82CA6E1 byte_7FF6C82CA6E1 db 59h                ; DATA XREF: main:loc_7FF6C82C49AF↑w</span><br><span class="line">.data:00007FF6C82CA6E2 byte_7FF6C82CA6E2 db 0CFh               ; DATA XREF: main:loc_7FF6C82C4A7F↑w</span><br><span class="line">.data:00007FF6C82CA6E3 byte_7FF6C82CA6E3 db 0ECh               ; DATA XREF: main:loc_7FF6C82C4B4F↑w</span><br><span class="line">.data:00007FF6C82CA6E4 byte_7FF6C82CA6E4 db 0E3h               ; DATA XREF: main:loc_7FF6C82C4C1F↑w</span><br><span class="line">.data:00007FF6C82CA6E5 byte_7FF6C82CA6E5 db 4Ch                ; DATA XREF: main:loc_7FF6C82C4CEF↑w</span><br><span class="line">.data:00007FF6C82CA6E6 byte_7FF6C82CA6E6 db 60h                ; DATA XREF: main:loc_7FF6C82C4DBF↑w</span><br><span class="line">.data:00007FF6C82CA6E7 byte_7FF6C82CA6E7 db 0C9h               ; DATA XREF: main:loc_7FF6C82C4E8F↑w</span><br><span class="line">.data:00007FF6C82CA6E8 byte_7FF6C82CA6E8 db 0A5h               ; DATA XREF: main:loc_7FF6C82C4F5F↑w</span><br><span class="line">.data:00007FF6C82CA6E9 byte_7FF6C82CA6E9 db 0C0h               ; DATA XREF: main:loc_7FF6C82C502F↑w</span><br><span class="line">.data:00007FF6C82CA6EA byte_7FF6C82CA6EA db 82h                ; DATA XREF: main:loc_7FF6C82C50FF↑w</span><br><span class="line">.data:00007FF6C82CA6EB byte_7FF6C82CA6EB db 96h                ; DATA XREF: main:loc_7FF6C82C526C↑w</span><br><span class="line">.data:00007FF6C82CA6EC byte_7FF6C82CA6EC db 1Eh                ; DATA XREF: main:loc_7FF6C82C53D9↑w</span><br><span class="line">.data:00007FF6C82CA6ED byte_7FF6C82CA6ED db 2Ah                ; DATA XREF: main:loc_7FF6C82C5546↑w</span><br><span class="line">.data:00007FF6C82CA6EE byte_7FF6C82CA6EE db 6Fh                ; DATA XREF: main:loc_7FF6C82C56B3↑w</span><br><span class="line">.data:00007FF6C82CA6EF byte_7FF6C82CA6EF db 55h                ; DATA XREF: main:loc_7FF6C82C5820↑w</span><br></pre></td></tr></table></figure>
<p>写出解题脚本：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">decipher</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">int</span> num_rounds, <span class="keyword">unsigned</span> <span class="keyword">int</span> input[<span class="number">8</span>], <span class="keyword">unsigned</span> <span class="keyword">int</span> key[<span class="number">4</span>])</span> </span>&#123;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> i;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> delta=<span class="number">0x33445566</span>, sum=delta*num_rounds;</span><br><span class="line">    <span class="keyword">for</span> (i=<span class="number">0</span>; i &lt; num_rounds; i++) &#123;</span><br><span class="line">        input[<span class="number">7</span>]-= ((((<span class="number">16</span> * input[<span class="number">6</span>]) ^ (input[<span class="number">0</span>] &gt;&gt; <span class="number">3</span>)) + ((input[<span class="number">6</span>] &gt;&gt; <span class="number">5</span>) ^ (<span class="number">4</span> * input[<span class="number">0</span>]))) ^ ((input[<span class="number">0</span>] ^ sum) + (key[((sum &gt;&gt; <span class="number">2</span>) &amp; <span class="number">3</span>)^<span class="number">3</span>] ^ input[<span class="number">6</span>])));</span><br><span class="line">        input[<span class="number">6</span>]-= ((((<span class="number">16</span> * input[<span class="number">5</span>]) ^ (input[<span class="number">7</span>] &gt;&gt; <span class="number">3</span>)) + ((input[<span class="number">5</span>] &gt;&gt; <span class="number">5</span>) ^ (<span class="number">4</span> * input[<span class="number">7</span>]))) ^ ((key[((sum &gt;&gt; <span class="number">2</span>) &amp; <span class="number">3</span>)^<span class="number">2</span>] ^ input[<span class="number">5</span>])+ (input[<span class="number">7</span>] ^ sum)));</span><br><span class="line">        input[<span class="number">5</span>]-= ((((<span class="number">16</span> * input[<span class="number">4</span>]) ^ (input[<span class="number">6</span>] &gt;&gt; <span class="number">3</span>)) + ((input[<span class="number">4</span>] &gt;&gt; <span class="number">5</span>) ^ (<span class="number">4</span> * input[<span class="number">6</span>]))) ^ ((key[((sum &gt;&gt; <span class="number">2</span>) &amp; <span class="number">3</span>)^<span class="number">1</span>] ^ input[<span class="number">4</span>]) + (input[<span class="number">6</span>] ^ sum)) );</span><br><span class="line">		input[<span class="number">4</span>]-= ((((<span class="number">16</span> * input[<span class="number">3</span>]) ^ (input[<span class="number">5</span>] &gt;&gt; <span class="number">3</span>)) + ((input[<span class="number">3</span>] &gt;&gt; <span class="number">5</span>) ^ (<span class="number">4</span> * input[<span class="number">5</span>]))) ^ ((input[<span class="number">5</span>] ^ sum) + (key[(sum &gt;&gt; <span class="number">2</span>) &amp; <span class="number">3</span>] ^ input[<span class="number">3</span>])));</span><br><span class="line">		input[<span class="number">3</span>]-= ((((<span class="number">16</span> * input[<span class="number">2</span>]) ^ (input[<span class="number">4</span>] &gt;&gt; <span class="number">3</span>)) + ((input[<span class="number">2</span>] &gt;&gt; <span class="number">5</span>) ^ (<span class="number">4</span> * input[<span class="number">4</span>]))) ^ ((input[<span class="number">4</span>] ^ sum) + (key[((sum &gt;&gt; <span class="number">2</span>) &amp; <span class="number">3</span>) ^ <span class="number">3</span>] ^ input[<span class="number">2</span>])));</span><br><span class="line">		input[<span class="number">2</span>]-= ((((<span class="number">16</span> * input[<span class="number">1</span>]) ^ (input[<span class="number">3</span>] &gt;&gt; <span class="number">3</span>)) + ((input[<span class="number">1</span>] &gt;&gt; <span class="number">5</span>) ^ (<span class="number">4</span> * input[<span class="number">3</span>]))) ^ ((input[<span class="number">3</span>] ^ sum) + (key[((sum &gt;&gt; <span class="number">2</span>) &amp; <span class="number">3</span>)^<span class="number">2</span>] ^ input[<span class="number">1</span>])));</span><br><span class="line">		input[<span class="number">1</span>]-= ((((<span class="number">16</span> * input[<span class="number">0</span>]) ^ (input[<span class="number">2</span>] &gt;&gt; <span class="number">3</span>)) + ((input[<span class="number">0</span>] &gt;&gt; <span class="number">5</span>) ^ (<span class="number">4</span> * input[<span class="number">2</span>]))) ^ ((key[((sum &gt;&gt; <span class="number">2</span>) &amp; <span class="number">3</span>)^<span class="number">1</span>] ^ input[<span class="number">0</span>]) + (input[<span class="number">2</span>] ^ sum)));</span><br><span class="line">		input[<span class="number">0</span>]-= ((((<span class="number">16</span> * input[<span class="number">7</span>]) ^ (input[<span class="number">1</span>] &gt;&gt; <span class="number">3</span>)) + ((input[<span class="number">7</span>] &gt;&gt; <span class="number">5</span>) ^ (<span class="number">4</span> * input[<span class="number">1</span>]))) ^ ((key[(sum &gt;&gt; <span class="number">2</span>) &amp; <span class="number">3</span>] ^ input[<span class="number">7</span>]) + (input[<span class="number">1</span>] ^ sum))) ;</span><br><span class="line">		sum -= delta;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> v[<span class="number">8</span>]=&#123;<span class="number">0x993cab5c</span>,<span class="number">0x3f40e129</span>,<span class="number">0x777791de</span>,<span class="number">0x737dfea6</span>,<span class="number">0xeccf59e6</span>,<span class="number">0xc9604ce3</span>,<span class="number">0x9682c0a5</span>,<span class="number">0x556f2a1e</span>&#125;;</span><br><span class="line">	<span class="comment">//unsigned int v[8]=&#123;0x5cab3c99,0x29e1403f,0xde917777,0xa6fe7d73,0xe659cfec,0xe34c60c9,0xa5c08296,0x1e2a6f55&#125;;</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> k[<span class="number">4</span>]=&#123;<span class="number">0x36b0</span>,<span class="number">0x13816</span>,<span class="number">0x10</span>,<span class="number">0x1e0f3</span>&#125;;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> r=<span class="number">12</span>;<span class="comment">//num_rounds建议取值为32</span></span><br><span class="line">    <span class="comment">// v为要加密的数据是两个32位无符号整数</span></span><br><span class="line">    <span class="comment">// k为加密解密密钥，为4个32位无符号整数，即密钥长度为128位</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;加密前原始数据：%x %x\n&quot;</span>,v[<span class="number">0</span>],v[<span class="number">1</span>]);</span><br><span class="line">    decipher(r, v, k);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;解密后的数据：%s\n&quot;</span>,v);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>GKCTF{9b34a61df773acf0e4dec25ea5fb0e29}</p>
<h2 id="GKCTF-2021-app-debug"><a href="#GKCTF-2021-app-debug" class="headerlink" title="[GKCTF 2021]app-debug"></a>[GKCTF 2021]app-debug</h2><p>一开始用jadx打开，进到mainActivity，有个关键的check函数没有出来，看了网上的wp才知道引用了外部库</p>
<p>IDA打开，发现有.so文件</p>
<img src="/2022/01/28/BUUOJ-Reverse-1/image-20220510195215506.png" class title="image-20220510195215506">
<p>进去后搜索main，进到关键加密函数，是一个TEA加密的结构</p>
<img src="/2022/01/28/BUUOJ-Reverse-1/image-20220528160552459.png" class title="image-20220528160552459">
<p>但是其中key的值是假的，程序通过TracerPid进行反调试，通过寻找交叉引用可以找到真正的key</p>
<blockquote>
<p><strong>当我们使用IDA attach程序的时候，在/proc/{PID}/status文件的TracerPid字段会写入调试程序的PID</strong></p>
<p><strong>也就是说使用TracerPid反调试的原理就是检测这个字段是否为0，为0说明没有被调试，不为0说明正在被调试，检测调试器直接退出就可以达到反调试的效果</strong></p>
<p>作者：Sharkchilli<br>链接：<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/cae682a27f0c">https://www.jianshu.com/p/cae682a27f0c</a><br><img src="/2022/01/28/BUUOJ-Reverse-1/image-20220528160800200.png" class title="image-20220528160800200"></p>
</blockquote>
<h2 id="RCTF2019-DontEatMe"><a href="#RCTF2019-DontEatMe" class="headerlink" title="[RCTF2019]DontEatMe"></a>[RCTF2019]DontEatMe</h2><p>发现存在反调试，把17改为16绕过</p>
<img src="/2022/01/28/BUUOJ-Reverse-1/image-20220510205116532.png" class title="image-20220510205116532">
<img src="/2022/01/28/BUUOJ-Reverse-1/image-20220510205150477.png" class title="image-20220510205150477">
<p>测试输入：0123456798abcdef0123456798abcdef</p>
<p>分析一下程序的流程，大致是获取十六进制输入，对输入做加密，然后生成迷宫，走迷宫</p>
<p>从迷宫开始分析，大致就是先给某个数据段附了值，然后将该数据段与某一串数据进行异或，异或后的值转为二进制来生成迷宫</p>
<img src="/2022/01/28/BUUOJ-Reverse-1/image-20220511112512620.png" class title="image-20220511112512620">
<p>将生成后的迷宫放出来：(s为起点，e为终点)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 </span><br><span class="line">1 0 0 0 0 0 0 0 0 0 1 1 1 1 1 1 </span><br><span class="line">1 0 1 1 1 1 1 1 1 0 1 1 1 1 1 1</span><br><span class="line">1 0 1 1 1 1 1 1 1 0 1 1 1 1 1 1</span><br><span class="line">1 0 1 1 1 1 0 0 0 e 0 0 0 1 1 1</span><br><span class="line">1 0 1 1 1 1 0 1 1 1 1 1 0 1 1 1</span><br><span class="line">1 0 1 1 1 1 0 1 1 1 1 1 0 1 1 1</span><br><span class="line">1 0 1 1 1 1 0 0 0 0 1 1 0 1 1 1</span><br><span class="line">1 0 1 1 1 1 1 1 1 0 1 1 0 1 1 1</span><br><span class="line">1 0 1 1 1 1 1 1 1 0 1 1 0 1 1 1</span><br><span class="line">1 0 0 0 0 s 0 0 0 0 1 1 0 1 1 1</span><br><span class="line">1 1 1 1 1 0 1 1 1 1 1 1 0 1 1 1</span><br><span class="line">1 1 1 1 1 0 0 0 0 0 0 0 0 1 1 1</span><br><span class="line">1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1</span><br><span class="line">1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1</span><br><span class="line">1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1</span><br></pre></td></tr></table></figure>
<p>迷宫路径：ddddwwwaaawwwddd</p>
<p>然后要做的就是解密了</p>
<p>中间的解密算法了解了一下才知道是BLOWFISH加密算法</p>
<p>flag{db824ef8605c5235b4bbacfa2ff8e087}</p>
<h2 id="SUSCTF-2022-hell-world"><a href="#SUSCTF-2022-hell-world" class="headerlink" title="[SUSCTF 2022]hell_world"></a>[SUSCTF 2022]hell_world</h2><p>参考<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1H34y187ae?spm_id_from=333.999.0.0">【SUSCTF2022】DigitalCircuits &amp; hell_world &amp; tttree去花_哔哩哔哩_bilibili</a></p>
<p>IDA64打开，可以发现有很多函数，其中有大量代码，难以入手</p>
<img src="/2022/01/28/BUUOJ-Reverse-1/image-20220518163305874.png" class title="image-20220518163305874">
<p>shift+f12搜索字符串，查找flag，交叉引用进到相关函数中，可以发现一个类似虚拟机的东西</p>
<img src="/2022/01/28/BUUOJ-Reverse-1/image-20220518163424882.png" class title="image-20220518163424882">
<p>动调，case0执行完并没有输出其中的字符串”Input Flag:”，猜测只是将字符串加载到缓冲区中</p>
<img src="/2022/01/28/BUUOJ-Reverse-1/image-20220518163630410.png" class title="image-20220518163630410">
<p>case1执行完后，”Input Flag”被输出，猜测该部分作用为输出缓冲区内容</p>
<img src="/2022/01/28/BUUOJ-Reverse-1/image-20220518163913162.png" class title="image-20220518163913162">
<p>在case2中单步调试时停止不动，开始输入，可知该部分作用为获得输入</p>
<img src="/2022/01/28/BUUOJ-Reverse-1/image-20220518164217000.png" class title="image-20220518164217000">
<p>而case2运行完后接着运行case3，其中v2=5时进入case 5，case 5中”Wrong”提示不能进入该部分，同时猜测该case3作用为判断输入长度</p>
<img src="/2022/01/28/BUUOJ-Reverse-1/image-20220518164338069.png" class title="image-20220518164338069">
<p>接下来的流程为case9 -&gt; case10 -&gt; case11-&gt;case10-&gt;case11-&gt;case10…</p>
<p>而case10为加密块，case11为验证块，提取出其中的数组，做异或即可得到flag</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">a=[<span class="number">0x56</span>,<span class="number">0x0DA</span>,<span class="number">0x0CD</span>,<span class="number">0x3A</span>,<span class="number">0x7E</span>,<span class="number">0x86</span>,<span class="number">0x13</span>,<span class="number">0x0B5</span>,<span class="number">0x1D</span>,<span class="number">0x9D</span>,<span class="number">0x0FC</span>,<span class="number">0x97</span>,<span class="number">0x8C</span>,</span><br><span class="line"><span class="number">0x31</span>,<span class="number">0x6B</span>,<span class="number">0x0C9</span>,<span class="number">0x0FB</span>,<span class="number">0x1A</span>,<span class="number">0x0E2</span>,<span class="number">0x2D</span>,<span class="number">0x0DC</span>,<span class="number">0x0D3</span>,<span class="number">0x0F1</span>,<span class="number">0x0F4</span>,<span class="number">0x36</span>,<span class="number">0x9</span>,</span><br><span class="line"><span class="number">0x20</span>,<span class="number">0x42</span>,<span class="number">0x4</span>,<span class="number">0x6A</span>,<span class="number">0x71</span>,<span class="number">0x53</span>,<span class="number">0x78</span>,<span class="number">0x0A4</span>,<span class="number">0x97</span>,<span class="number">0x8F</span>,<span class="number">0x7A</span>,<span class="number">0x72</span>,<span class="number">0x39</span>,<span class="number">0x0E8</span>,</span><br><span class="line"><span class="number">0x3D</span>,<span class="number">0x0FA</span>,<span class="number">0x40</span>,<span class="number">0x3D</span>]</span><br><span class="line">b=[<span class="number">0x5</span>,<span class="number">0x8F</span>,<span class="number">0x9E</span>,<span class="number">0x79</span>,<span class="number">0x2A</span>,<span class="number">0x0C0</span>,<span class="number">0x68</span>,<span class="number">0x81</span>,<span class="number">0x2D</span>,<span class="number">0x0FC</span>,<span class="number">0x0CF</span>,<span class="number">0x0A4</span>,<span class="number">0x0B5</span>,</span><br><span class="line"><span class="number">0x55</span>,<span class="number">0x5F</span>,<span class="number">0x0E4</span>,<span class="number">0x9D</span>,<span class="number">0x23</span>,<span class="number">0x0D6</span>,<span class="number">0x1D</span>,<span class="number">0x0F1</span>,<span class="number">0x0E7</span>,<span class="number">0x97</span>,<span class="number">0x91</span>,<span class="number">0x6</span>,<span class="number">0x24</span>,<span class="number">0x42</span>,</span><br><span class="line"><span class="number">0x71</span>,<span class="number">0x3C</span>,<span class="number">0x58</span>,<span class="number">0x5C</span>,<span class="number">0x30</span>,<span class="number">0x19</span>,<span class="number">0x0C6</span>,<span class="number">0x0F5</span>,<span class="number">0x0BC</span>,<span class="number">0x4B</span>,<span class="number">0x42</span>,<span class="number">0x5D</span>,<span class="number">0x0DA</span>,</span><br><span class="line"><span class="number">0x58</span>,<span class="number">0x9B</span>,<span class="number">0x24</span>,<span class="number">0x40</span>]</span><br><span class="line">s=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(a)):</span><br><span class="line">    s+=<span class="built_in">chr</span>(a[i]^b[i])</span><br><span class="line"><span class="built_in">print</span>(s)</span><br><span class="line"><span class="comment"># SUSCTF&#123;40a339d4-f940-4fe0-b382-cabb310d2ead&#125;</span></span><br></pre></td></tr></table></figure>
<h2 id="CFI-CTF-2018-Automated-Reversing"><a href="#CFI-CTF-2018-Automated-Reversing" class="headerlink" title="[CFI-CTF 2018]Automated Reversing"></a>[CFI-CTF 2018]Automated Reversing</h2><p>下载附件，得到一堆elf文件</p>
<img src="/2022/01/28/BUUOJ-Reverse-1/image-20220519155314534.png" class title="image-20220519155314534">
<p>拖进IDA里，只有汇编代码，不过逻辑还是挺简单的，只是做了加减、异或的操作，然后与一个数比较</p>
<img src="/2022/01/28/BUUOJ-Reverse-1/image-20220519155402267.png" class title="image-20220519155402267">
<p>那么我们可以做逆操作，利用固定偏移量依次提取出操作符、操作值和比较值，进行逆计算获取这些预期字符，看看它们是什么，然后就出flag了</p>
<p>下载的附件中含有生成代码和解题代码，这里附上</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># generator.py</span></span><br><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">text = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Aenean commodo ligula dolor. Aenean massa. Cum sociis natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Donec quam felis, ultricies nec, pellentesque eu, pretium quis, sem. Nulla consequat massa quis enim. Donec pede justo, fringilla vel, aliquet nec, vulputate eget, arcu. In enim justo, rhoncus ut, imperdiet a, venenatis vitae, justo. Nullam dictum felis eu pede mollis pretium. Integer tincidunt. Cras dapibus. The flag is CFI&#123;1s_th1s_4_pr0g_ch4ll_0r_4_r3ve3se_ch4ll?&#125;. Aenean vulputate eleifend tellus. Aenean leo ligula, porttitor eu, consequat vitae, eleifend ac, enim. I stole this idea directly from Defcon Quals 2016. Phasellus viverra nulla ut metus varius laoreet. Quisque rutrum. Aenean imperdiet. Etiam ultricies nisi vel augue. Curabitur ullamcorper ultricies nisi. Nam eget dui. Etiam rhoncus. Maecenas tempus, tellus eget condimentum rhoncus, sem quam semper libero, sit amet adipiscing sem neque sed ipsum.</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">context(arch=<span class="string">&#x27;amd64&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i, c <span class="keyword">in</span> <span class="built_in">enumerate</span>(text):</span><br><span class="line">    operator = [<span class="string">&quot;xor&quot;</span>, <span class="string">&quot;sub&quot;</span>, <span class="string">&quot;add&quot;</span>][randint(<span class="number">0</span>, <span class="number">2</span>)]</span><br><span class="line">	key = randint(<span class="number">1</span>, <span class="number">100</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> operator == <span class="string">&quot;xor&quot;</span>:</span><br><span class="line">            check = (<span class="built_in">ord</span>(c) ^ key) &amp; <span class="number">0xff</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> operator == <span class="string">&quot;sub&quot;</span>:</span><br><span class="line">            check = (<span class="built_in">ord</span>(c) - key) &amp; <span class="number">0xff</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> operator == <span class="string">&quot;add&quot;</span>:</span><br><span class="line">            check = (<span class="built_in">ord</span>(c) + key) &amp; <span class="number">0xff</span></span><br><span class="line"></span><br><span class="line">	code = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">		push 0</span></span><br><span class="line"><span class="string">		push 5</span></span><br><span class="line"><span class="string">		mov rdi, rsp</span></span><br><span class="line"><span class="string">		mov rax, 0x23</span></span><br><span class="line"><span class="string">		syscall</span></span><br><span class="line"><span class="string">		pop rax</span></span><br><span class="line"><span class="string">		pop rax</span></span><br><span class="line"><span class="string">		mov rax, [rsp + 0x10]</span></span><br><span class="line"><span class="string">		mov dl, byte ptr [rax]</span></span><br><span class="line"><span class="string">                &#123;&#125; dl, &#123;&#125;</span></span><br><span class="line"><span class="string">		cmp dl, &#123;&#125;</span></span><br><span class="line"><span class="string">		jne error</span></span><br><span class="line"><span class="string">		mov rdi, 0</span></span><br><span class="line"><span class="string">		mov rax, 0x3c</span></span><br><span class="line"><span class="string">		syscall</span></span><br><span class="line"><span class="string">		error:</span></span><br><span class="line"><span class="string">			mov rdi, 1</span></span><br><span class="line"><span class="string">			mov rax, 0x3c</span></span><br><span class="line"><span class="string">			syscall</span></span><br><span class="line"><span class="string">	&quot;&quot;&quot;</span>.<span class="built_in">format</span>(operator, key, check)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;binaries/binary&#123;&#125;&quot;</span>.<span class="built_in">format</span>(i), <span class="string">&quot;w&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">		elf = make_elf(asm(code))</span><br><span class="line">		f.write(elf)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#solution.py</span></span><br><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"></span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1007</span>):</span><br><span class="line">    path = <span class="string">&quot;binaries/binaries/binary&#123;&#125;&quot;</span>.<span class="built_in">format</span>(i)</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(path, <span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        binary = f.read()</span><br><span class="line">        operator = binary[<span class="number">0xca</span>]</span><br><span class="line">        key = binary[<span class="number">0xcb</span>]</span><br><span class="line">        check = binary[<span class="number">0xce</span>]</span><br><span class="line">        <span class="keyword">if</span> operator == <span class="number">0xc2</span>: <span class="comment"># add</span></span><br><span class="line">            flag += <span class="built_in">chr</span>((check - key) &amp; <span class="number">0xff</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">elif</span> operator == <span class="number">0xea</span>: <span class="comment"># sub</span></span><br><span class="line">            flag += <span class="built_in">chr</span>((check + key) &amp; <span class="number">0xff</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            flag += <span class="built_in">chr</span>(check ^ key)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="MRCTF2020-Virtual-tree"><a href="#MRCTF2020-Virtual-tree" class="headerlink" title="[MRCTF2020 Virtual_tree]"></a>[MRCTF2020 Virtual_tree]</h2><p>ida32打开，流程还是挺明白的</p>
<img src="/2022/01/28/BUUOJ-Reverse-1/image-20220519162329377.png" class title="image-20220519162329377">
<p>中间存在花指令，修复掉</p>
<p>进到sub_401680中，类似一颗树的前序遍历，取其中的对输入字符串做异或加密</p>
<img src="/2022/01/28/BUUOJ-Reverse-1/image-20220519171806342.png" class title="image-20220519171806342">
<p>动调提取出a1的数据：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MLGPOKFCJENIHDBA</span><br></pre></td></tr></table></figure>
<p>然后到sub_5F16F0，一开始以为一直调用的是sub_5f1510这个函数，只不过传入的参数每次都不一样</p>
<p>但实际上动调的时候我们可以发现，实际的函数是这样的…里面调用的函数被替换掉了</p>
<img src="/2022/01/28/BUUOJ-Reverse-1/image-20220520164811489.png" class title="image-20220520164811489">
<p>实际上分别是一些加减、异或的操作</p>
<img src="/2022/01/28/BUUOJ-Reverse-1/image-20220520164627752.png" class title="image-20220520164627752">
<img src="/2022/01/28/BUUOJ-Reverse-1/image-20220520164635309.png" class title="image-20220520164635309">
<img src="/2022/01/28/BUUOJ-Reverse-1/image-20220520164644647.png" class title="image-20220520164644647">
<p>接着逆即可,减法的时候需要注意绝对值的问题：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">a =[</span><br><span class="line">  <span class="number">0x17</span>, <span class="number">0x63</span>, <span class="number">0x77</span>, <span class="number">0x03</span>, <span class="number">0x52</span>, <span class="number">0x2E</span>, <span class="number">0x4A</span>, <span class="number">0x28</span>, <span class="number">0x52</span>, <span class="number">0x1B</span>, </span><br><span class="line">  <span class="number">0x17</span>, <span class="number">0x12</span>, <span class="number">0x3A</span>, <span class="number">0x0A</span>, <span class="number">0x6C</span>, <span class="number">0x62</span></span><br><span class="line">]</span><br><span class="line">a[<span class="number">15</span>]=(a[<span class="number">15</span>]-<span class="number">2</span>)%<span class="number">256</span></span><br><span class="line">a[<span class="number">14</span>]^=a[<span class="number">15</span>]</span><br><span class="line">a[<span class="number">12</span>]=(a[<span class="number">2</span>]-a[<span class="number">12</span>])%<span class="number">256</span></span><br><span class="line">a[<span class="number">11</span>]^=a[<span class="number">12</span>]</span><br><span class="line">a[<span class="number">10</span>]=(a[<span class="number">7</span>]-a[<span class="number">10</span>])%<span class="number">256</span></span><br><span class="line">a[<span class="number">9</span>]=(a[<span class="number">8</span>]-a[<span class="number">9</span>])%<span class="number">256</span></span><br><span class="line">a[<span class="number">8</span>]^=a[<span class="number">7</span>]</span><br><span class="line">a[<span class="number">7</span>]=(a[<span class="number">7</span>]-<span class="number">3</span>)%<span class="number">256</span></span><br><span class="line">a[<span class="number">6</span>]=a[<span class="number">1</span>]-a[<span class="number">6</span>]</span><br><span class="line">a[<span class="number">4</span>]^=a[<span class="number">5</span>]</span><br><span class="line">a[<span class="number">3</span>]=(a[<span class="number">7</span>]-a[<span class="number">3</span>]%<span class="number">256</span>)</span><br><span class="line">a[<span class="number">2</span>]=(a[<span class="number">2</span>]-<span class="number">7</span>)%<span class="number">256</span></span><br><span class="line">a[<span class="number">1</span>]^=a[<span class="number">2</span>]</span><br><span class="line">a[<span class="number">0</span>]=(a[<span class="number">0</span>]-<span class="number">10</span>)%<span class="number">256</span></span><br><span class="line">s=<span class="string">&#x27;MLGPOKFCJENIHDBA&#x27;</span></span><br><span class="line">f=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">    f+=<span class="built_in">chr</span>(<span class="built_in">ord</span>(s[i])^a[i])</span><br><span class="line"><span class="built_in">print</span>(f)</span><br></pre></td></tr></table></figure>
<h5 id="一些去花小感想"><a href="#一些去花小感想" class="headerlink" title="一些去花小感想"></a>一些去花小感想</h5><p>这题去花指令的过程挺曲折的</p>
<img src="/2022/01/28/BUUOJ-Reverse-1/image-20220520163047206.png" class title="image-20220520163047206">
<p>像这样的花指令，以往都是两条指令都nop掉，但实际上这样子操作是错误的，因为jump的时候跳到的还是下面的那条指令，只不过由于加了偏移量的关系，实际上执行的不是call xxxx这条指令，而是另一条指令，实际操作只需要将下面的指令nop一次，将余下的字节在重新整理为代码即可。</p>
<h2 id="羊城杯-2020-babyre"><a href="#羊城杯-2020-babyre" class="headerlink" title="[羊城杯 2020]babyre"></a>[羊城杯 2020]babyre</h2><p>下载文件，运行时会发现缺少了某个库而无法运行</p>
<img src="/2022/01/28/BUUOJ-Reverse-1/image-20220527154558056.png" class title="image-20220527154558056">
<p>原因是缺少了libcrypto.so.1.0.0这个库，安装这个库即可，命令如下</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget http://archive.ubuntu.com/ubuntu/pool/main/o/openssl1.0/libssl1.0.0_1.0.2n-1ubuntu5.9_amd64.deb </span><br><span class="line">sudo dpkg -i libssl1.0.0_1.0.2n-1ubuntu5.9_amd64.deb</span><br></pre></td></tr></table></figure>
<p>然后就可以快乐动调了</p>
<p>动调得到密钥数据</p>
<img src="/2022/01/28/BUUOJ-Reverse-1/image-20220527155009034.png" class title="image-20220527155009034">
<p>然后可以解main中的DES了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> DES</span><br><span class="line">target=[</span><br><span class="line">  <span class="number">0x0A</span>, <span class="number">0xF4</span>, <span class="number">0xEE</span>, <span class="number">0xC8</span>, <span class="number">0x42</span>, <span class="number">0x8A</span>, <span class="number">0x9B</span>, <span class="number">0xDB</span>, <span class="number">0xA2</span>, <span class="number">0x26</span>, </span><br><span class="line">  <span class="number">0x6F</span>, <span class="number">0xEE</span>, <span class="number">0xEE</span>, <span class="number">0xE0</span>, <span class="number">0xD8</span>, <span class="number">0xA2</span></span><br><span class="line">]</span><br><span class="line">cipher=<span class="string">b&#x27;\x0A\xF4\xEE\xC8\x42\x8A\x9B\xDB\xA2\x26\x6F\xEE\xEE\xE0\xD8\xA2&#x27;</span></span><br><span class="line">key=<span class="string">b&#x27;\xAD\x52\xF3\x4D\xE2\x2C\x20\xD6&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(key))</span><br><span class="line">cryptor=DES.new(key,DES.MODE_CBC,<span class="string">b&#x27;\x00\x00\x00\x00\x00\x00\x00\x00&#x27;</span>)</span><br><span class="line">m=cryptor.decrypt(cipher)</span><br><span class="line"><span class="built_in">print</span>(m)</span><br><span class="line"><span class="comment"># th1s1sth3n1c3k3y</span></span><br></pre></td></tr></table></figure>
<p>把其中SMC的代码调出</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> __fastcall __noreturn <span class="title">sub_40272D</span><span class="params">(__int64 a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> i; <span class="comment">// [rsp+18h] [rbp-128h]</span></span><br><span class="line">  <span class="keyword">int</span> j; <span class="comment">// [rsp+1Ch] [rbp-124h]</span></span><br><span class="line">  <span class="keyword">int</span> k; <span class="comment">// [rsp+24h] [rbp-11Ch]</span></span><br><span class="line">  <span class="keyword">int</span> l; <span class="comment">// [rsp+28h] [rbp-118h]</span></span><br><span class="line">  <span class="keyword">char</span> v5[<span class="number">192</span>]; <span class="comment">// [rsp+30h] [rbp-110h] BYREF</span></span><br><span class="line">  <span class="keyword">char</span> s[<span class="number">16</span>]; <span class="comment">// [rsp+F0h] [rbp-50h] BYREF</span></span><br><span class="line">  _BYTE v7[<span class="number">56</span>]; <span class="comment">// [rsp+100h] [rbp-40h] BYREF</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v8; <span class="comment">// [rsp+138h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v8 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%40s&quot;</span>, s);</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="keyword">unsigned</span> <span class="keyword">int</span>)<span class="built_in">strlen</span>(s) != <span class="number">32</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Wrong!&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  sub_400C91(v5, a1);</span><br><span class="line">  sub_401B8E(v5, s);</span><br><span class="line">  sub_401B8E(v5, v7);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">31</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">for</span> ( j = <span class="number">0</span>; i / <span class="number">4</span> &gt; j; ++j )</span><br><span class="line">      s[i] ^= s[j];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> ( k = <span class="number">1</span>; k &lt;= <span class="number">31</span>; ++k )</span><br><span class="line">    byte_6040D0[k - <span class="number">1</span>] = (<span class="number">2</span> * (s[k - <span class="number">1</span>] ^ <span class="number">0x13</span>) + <span class="number">7</span>) ^ ((<span class="keyword">unsigned</span> __int8)s[k - <span class="number">1</span>] % <span class="number">9u</span> + s[k] + <span class="number">2</span>);</span><br><span class="line">  <span class="keyword">if</span> ( v7[<span class="number">15</span>] == <span class="number">0xC4</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">for</span> ( l = <span class="number">0</span>; l &lt;= <span class="number">30</span>; ++l )</span><br><span class="line">      ;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>调出的代码还有点问题…但大概是出来了，只是中间比较的部分缺少了，只能看汇编了，其中byte_604100是要比较的数据</p>
<img src="/2022/01/28/BUUOJ-Reverse-1/image-20220527164919681.png" class title="image-20220527164919681">
<p>提取其中的数据</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> ida_chars[] =</span><br><span class="line">&#123;</span><br><span class="line">  <span class="number">0xBD</span>, <span class="number">0xAD</span>, <span class="number">0xB4</span>, <span class="number">0x84</span>, <span class="number">0x10</span>, <span class="number">0x63</span>, <span class="number">0xB3</span>, <span class="number">0xE1</span>, <span class="number">0xC6</span>, <span class="number">0x84</span>, </span><br><span class="line">  <span class="number">0x2D</span>, <span class="number">0x6F</span>, <span class="number">0xBA</span>, <span class="number">0x88</span>, <span class="number">0x74</span>, <span class="number">0xC4</span>, <span class="number">0x90</span>, <span class="number">0x32</span>, <span class="number">0xEA</span>, <span class="number">0x2E</span>, </span><br><span class="line">  <span class="number">0xC6</span>, <span class="number">0x28</span>, <span class="number">0x65</span>, <span class="number">0x70</span>, <span class="number">0xC9</span>, <span class="number">0x75</span>, <span class="number">0x78</span>, <span class="number">0xA0</span>, <span class="number">0x0B</span>, <span class="number">0x9F</span>, </span><br><span class="line">  <span class="number">0xA6</span>, <span class="number">0x00</span>, <span class="number">0x30</span>, <span class="number">0xE4</span>, <span class="number">0xD2</span>, <span class="number">0xC3</span>, <span class="number">0xEF</span>, <span class="number">0x75</span>, <span class="number">0xED</span>, <span class="number">0xA8</span>, </span><br><span class="line">  <span class="number">0xE1</span>, <span class="number">0xA1</span>, <span class="number">0x73</span>, <span class="number">0x81</span>, <span class="number">0xE2</span>, <span class="number">0xE9</span>, <span class="number">0xAB</span>, <span class="number">0xC8</span>, <span class="number">0xBF</span>, <span class="number">0xCA</span>, </span><br><span class="line">  <span class="number">0x52</span>, <span class="number">0xE8</span>, <span class="number">0xED</span>, <span class="number">0x6B</span>, <span class="number">0xA2</span>, <span class="number">0x39</span>, <span class="number">0x86</span>, <span class="number">0x21</span>, <span class="number">0xD0</span>, <span class="number">0xF6</span>, </span><br><span class="line">  <span class="number">0x50</span>, <span class="number">0x3E</span>, <span class="number">0xF3</span>, <span class="number">0x5C</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>中间的加密函数是一个类似AES的结构</p>
<img src="/2022/01/28/BUUOJ-Reverse-1/image-20220527170000216.png" class title="image-20220527170000216">
<p>然后是两个异或加密，前一个可逆，后一个需要进行爆破</p>
<img src="/2022/01/28/BUUOJ-Reverse-1/image-20220527172908880.png" class title="image-20220527172908880">
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">key=<span class="string">b&#x27;th1s1sth3n1c3k3y&#x27;</span></span><br><span class="line">cipher =[</span><br><span class="line">  <span class="number">0xBD</span>, <span class="number">0xAD</span>, <span class="number">0xB4</span>, <span class="number">0x84</span>, <span class="number">0x10</span>, <span class="number">0x63</span>, <span class="number">0xB3</span>, <span class="number">0xE1</span>, <span class="number">0xC6</span>, <span class="number">0x84</span>, </span><br><span class="line">  <span class="number">0x2D</span>, <span class="number">0x6F</span>, <span class="number">0xBA</span>, <span class="number">0x88</span>, <span class="number">0x74</span>, <span class="number">0xC4</span>, <span class="number">0x90</span>, <span class="number">0x32</span>, <span class="number">0xEA</span>, <span class="number">0x2E</span>, </span><br><span class="line">  <span class="number">0xC6</span>, <span class="number">0x28</span>, <span class="number">0x65</span>, <span class="number">0x70</span>, <span class="number">0xC9</span>, <span class="number">0x75</span>, <span class="number">0x78</span>, <span class="number">0xA0</span>, <span class="number">0x0B</span>, <span class="number">0x9F</span>, </span><br><span class="line">  <span class="number">0xA6</span>, <span class="number">0x00</span>, <span class="number">0x30</span>, <span class="number">0xE4</span>, <span class="number">0xD2</span>, <span class="number">0xC3</span>, <span class="number">0xEF</span>, <span class="number">0x75</span>, <span class="number">0xED</span>, <span class="number">0xA8</span>, </span><br><span class="line">  <span class="number">0xE1</span>, <span class="number">0xA1</span>, <span class="number">0x73</span>, <span class="number">0x81</span>, <span class="number">0xE2</span>, <span class="number">0xE9</span>, <span class="number">0xAB</span>, <span class="number">0xC8</span>, <span class="number">0xBF</span>, <span class="number">0xCA</span>, </span><br><span class="line">  <span class="number">0x52</span>, <span class="number">0xE8</span>, <span class="number">0xED</span>, <span class="number">0x6B</span>, <span class="number">0xA2</span>, <span class="number">0x39</span>, <span class="number">0x86</span>, <span class="number">0x21</span>, <span class="number">0xD0</span>, <span class="number">0xF6</span>, </span><br><span class="line">  <span class="number">0x50</span>, <span class="number">0x3E</span>, <span class="number">0xF3</span>, <span class="number">0x5C</span></span><br><span class="line">]</span><br><span class="line">middle=[<span class="number">0</span>]*<span class="number">32</span></span><br><span class="line">middle[<span class="number">31</span>]=<span class="number">0xc4</span></span><br><span class="line">cryptor=AES.new(key,AES.MODE_ECB)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">xor</span>():</span></span><br><span class="line">    tmp_ar=[<span class="number">0</span>]*<span class="number">32</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">        tmp_ar[i]=middle[i]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">31</span>,-<span class="number">1</span>,-<span class="number">1</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,i//<span class="number">4</span>):</span><br><span class="line">            tmp_ar[i]^=tmp_ar[j]</span><br><span class="line">    f=<span class="string">b&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">        f+=long_to_bytes(tmp_ar[i])</span><br><span class="line">    <span class="built_in">print</span>(cryptor.decrypt(f))</span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">deep_search</span>(<span class="params">i</span>):</span></span><br><span class="line">    <span class="keyword">if</span> i==-<span class="number">1</span>:</span><br><span class="line">        <span class="comment"># print(middle)</span></span><br><span class="line">        xor()</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">        tmp=((<span class="number">2</span>*(j^<span class="number">0x13</span>)+<span class="number">7</span>)^(j%<span class="number">9</span>+middle[i+<span class="number">1</span>]+<span class="number">2</span>))&amp;<span class="number">0xff</span></span><br><span class="line">        <span class="keyword">if</span> tmp==cipher[i]:</span><br><span class="line">            middle[i]=j</span><br><span class="line">            deep_search(i-<span class="number">1</span>)</span><br><span class="line">deep_search(<span class="number">30</span>)</span><br><span class="line">               </span><br></pre></td></tr></table></figure>
<p>运行便可以得到flag了</p>
<img src="/2022/01/28/BUUOJ-Reverse-1/image-20220527172954733.png" class title="image-20220527172954733">
<h2 id="SWPU2019-EasiestRe"><a href="#SWPU2019-EasiestRe" class="headerlink" title="[SWPU2019]EasiestRe"></a>[SWPU2019]EasiestRe</h2><p>做最简单的re，挨最毒的打</p>
<p>将加密函数隐藏在子进程，主要通过ReadProcessMemory和WriteProcessMemory这两个函数实现</p>
<img src="/2022/01/28/BUUOJ-Reverse-1/image-20220528212151886.png" class title="image-20220528212151886">
<p>在这之前我们需要先了解int 3这个指令，通过搜索我们可以发现int 3会引起异常</p>
<blockquote>
<p>INT3断点是断点的一种，在诸如Ollydbg中的快捷键是F2，是一种很常用的断点类型。INT3指令的<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/机器码">机器码</a>为CC，所以通常也称之为CC指令。当被调试进程执行INT3指令导致一个异常时，调试器就会捕捉这个异常从而停在断点处，然后将断点处的指令恢复成原来的指令。</p>
</blockquote>
<p>而ReadProcessMemory和WriteProcessMemory这两个函数中的基址参数为</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lpBaseAddress = DebugEvent.u.Exception.ExceptionRecord.ExceptionAddress;</span><br></pre></td></tr></table></figure>
<p>也就是说，程序会捕捉子进程中引起异常的地方，对其中内容进行读取和改写</p>
<p>而决定改写地方和改写内容是通过nop数量来实现的</p>
<img src="/2022/01/28/BUUOJ-Reverse-1/image-20220528212810447.png" class title="image-20220528212810447">
<p>例如</p>
<img src="/2022/01/28/BUUOJ-Reverse-1/image-20220528212837593.png" class title="image-20220528212837593">
<p>那么我们要做的就是将参数v16和v15中的内容写到相应的地方来分析</p>
<p>首先将v16改写</p>
<img src="/2022/01/28/BUUOJ-Reverse-1/image-20220528213341784.png" class title="image-20220528213341784">
<p>然后是v15</p>
<img src="/2022/01/28/BUUOJ-Reverse-1/image-20220528222429471.png" class title="image-20220528222429471">
<p>然后就是对着算法开逆</p>
<img src="/2022/01/28/BUUOJ-Reverse-1/image-20220528234545090.png" class title="image-20220528234545090">
<h2 id="SUCTF2019-hardcpp"><a href="#SUCTF2019-hardcpp" class="headerlink" title="[SUCTF2019]hardcpp"></a>[SUCTF2019]hardcpp</h2><p>脚本去除控制流平坦化</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python deflat.py .\hardCpp 0x4007e0</span><br></pre></td></tr></table></figure>
<p>核心代码不难</p>
<img src="/2022/01/28/BUUOJ-Reverse-1/image-20220621143123237.png" class title="image-20220621143123237">
<p>解题代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">enc =[</span><br><span class="line">  0xF3, 0x2E, 0x18, 0x36, 0xE1, 0x4C, 0x22, 0xD1, 0xF9, 0x8C, </span><br><span class="line">  0x40, 0x76, 0xF4, 0x0E, 0x00, 0x05, 0xA3, 0x90, 0x0E, 0xA5,0x00</span><br><span class="line">]</span><br><span class="line">def encrypt(s):</span><br><span class="line">    for i in range(1,21):</span><br><span class="line">        cipher=s[i]</span><br><span class="line">        v3=s[i-1]%7</span><br><span class="line">        cipher=(s[i]+v3)%256</span><br><span class="line">        v6=((s[i-1]^18)*3+2)%256</span><br><span class="line">        cipher=cipher^v6</span><br><span class="line">        </span><br><span class="line">flag=[ord(&#x27;#&#x27;)]</span><br><span class="line">for i in range(1,20):</span><br><span class="line">    cipher=enc[i-1]</span><br><span class="line">    v3=flag[i-1]%7</span><br><span class="line">    v6=((flag[i-1]^18)*3+2)%256</span><br><span class="line">    cipher=cipher^v6</span><br><span class="line">    flag.append(cipher-v3)</span><br><span class="line">s=&#x27;&#x27;</span><br><span class="line">for i in range(len(flag)):</span><br><span class="line">    s+=chr(flag[i])</span><br><span class="line">print(s)</span><br></pre></td></tr></table></figure>
</div><div class="article-licensing box"><div class="licensing-title"><p>Reverse 刷题记录</p><p><a href="http://curator-kim.github.io/2022/01/28/BUUOJ-Reverse-1/">http://curator-kim.github.io/2022/01/28/BUUOJ-Reverse-1/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>Author</h6><a href="http://Curator-Kim.github.io"><p>Curator-Kim</p></a></div></div><div class="level-item is-narrow"><div><h6>Posted on</h6><p>2022-01-28</p></div></div><div class="level-item is-narrow"><div><h6>Updated on</h6><p>2022-12-26</p></div></div><div class="level-item is-narrow"><div><h6>Licensed under</h6><p><a class="icon" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a><a class="icon" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a><a class="icon" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="recommend-area"><div class="recommend-post"><span class="is-size-6 has-text-grey has-mr-7"># Related Post</span><br><span>  1.<a class="is-size-6" href="/2023/02/08/HGAME2023WP/" target="_blank"> </a><br></span><span>  2.<a class="is-size-6" href="/2023/01/09/HWS2023%20Winter%20Wp/" target="_blank"> </a><br></span><span>  3.<a class="is-size-6" href="/2023/01/09/%E5%A4%8D%E5%81%A5%E8%AE%AD%E7%BB%83/" target="_blank">复健训练</a><br></span><span>  4.<a class="is-size-6" href="/2022/09/06/%E7%BE%8A%E5%9F%8E%E6%9D%AFwp/" target="_blank">羊城杯2022 wp</a><br></span><span>  5.<a class="is-size-6" href="/2022/08/14/Crypto-NTRU%E5%AF%86%E7%A0%81%E7%B3%BB%E7%BB%9F/" target="_blank">Crypto NTRU密码系统</a><br></span><span>  6.<a class="is-size-6" href="/2022/08/14/HWS2022%E7%A1%AC%E4%BB%B6%E5%AE%89%E5%85%A8%E5%9C%A8%E7%BA%BF%E5%A4%8F%E4%BB%A4%E8%90%A5/" target="_blank">HWS2022硬件安全在线夏令营</a><br></span><span>  7.<a class="is-size-6" href="/2022/07/24/DASCTF-2022-07-wp/" target="_blank">DASCTF 2022.07 wp</a><br></span><span>  8.<a class="is-size-6" href="/2022/05/27/DASCTF-MAY/" target="_blank">DASCTF MAY</a><br></span></div></div><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/social-share.js/1.0.16/css/share.min.css"><div class="social-share"></div><script src="https://cdnjs.loli.net/ajax/libs/social-share.js/1.0.16/js/social-share.min.js"></script></article></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered">Like this article? Support the author with</h3><div class="buttons is-centered"><a class="button donate" data-type="alipay"><span class="icon is-small"><i class="fab fa-alipay"></i></span><span>Alipay</span><span class="qrcode"><img src="https://github.com/Curator-Kim/Curator-Kim.github.io/blob/master/img/alipay.png?raw=true" alt="Alipay"></span></a><a class="button donate" data-type="wechat"><span class="icon is-small"><i class="fab fa-weixin"></i></span><span>Wechat</span><span class="qrcode"><img src="https://github.com/Curator-Kim/Curator-Kim.github.io/blob/master/img/wechat.png?raw=true" alt="Wechat"></span></a></div></div></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2022/01/28/%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80-2-%E7%AC%AC%E4%B8%80%E4%B8%AA%E7%A8%8B%E5%BA%8F/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">汇编语言(2) 第一个程序</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2022/01/27/%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80%EF%BC%881%EF%BC%89%E5%AF%84%E5%AD%98%E5%99%A8%EF%BC%88%E5%86%85%E5%AD%98%E8%AE%BF%E9%97%AE%EF%BC%89/"><span class="level-item">汇编语言（1）寄存器（内存访问）</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><!--!--><div class="card"><div class="card-content"><div class="title is-5">Comments</div><div id="comment-container"></div><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/gitalk/1.6.0/gitalk.css"><script> $.getScript('/js/gitalk.min.js', function () { 
            var gitalk = new Gitalk({
            language:'zh-CN',
            id: '23f105c1a5aebc619a7ae9af53a700d7',
            repo: 'blog_comment',
            owner: 'Curator-Kim',
            clientID: '46a9f3481b46ea0129d8',
            clientSecret: '79c7c9cb847e141757d7864453bcbf89f0655b24',
            admin: ["Curator-Kim"],
            createIssueManually: true,
            distractionFreeMode: false,
            perPage: 10,
            pagerDirection: 'last',
            proxy: 'https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_token',
            
            enableHotKey: true,
            isLocked: false
        })
        gitalk.render('comment-container')});</script></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1 is-sticky"><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">Catalogue</h3><ul class="menu-list"><li><a class="is-flex is-mobile" href="#CFI-CTF-2018-IntroToPE"><span>[CFI-CTF 2018]IntroToPE</span></a></li><li><a class="is-flex is-mobile" href="#WUSTCTF2020-funnyre"><span>[WUSTCTF2020]funnyre</span></a></li><li><a class="is-flex is-mobile" href="#羊城杯-2020-login"><span>[羊城杯 2020]login</span></a></li><li><a class="is-flex is-mobile" href="#QCTF2018-Xman-babymips"><span>[QCTF2018]Xman-babymips</span></a></li><li><a class="is-flex is-mobile" href="#SCTF2019-babyre"><span>[SCTF2019]babyre</span></a></li><li><a class="is-flex is-mobile" href="#2019红帽杯-Snake"><span>[2019红帽杯]Snake</span></a></li><li><a class="is-flex is-mobile" href="#FlareOn2-very-success"><span>[FlareOn2]very_success</span></a></li><li><a class="is-flex is-mobile" href="#CISCN2018-2ex"><span>[CISCN2018]2ex</span></a></li><li><a class="is-flex is-mobile" href="#SCTF2019-Who-is-he"><span>[SCTF2019]Who is he</span></a></li><li><a class="is-flex is-mobile" href="#SUSCTF-2022-DigitalCircuits"><span>[SUSCTF 2022]DigitalCircuits</span></a><ul class="menu-list"><ul class="menu-list"><li><a class="is-flex is-mobile" href="#对f10的逆向："><span>对f10的逆向：</span></a></li></ul></ul></li><li><a class="is-flex is-mobile" href="#羊城杯-2020-Bytecode"><span>[羊城杯 2020]Bytecode</span></a></li><li><a class="is-flex is-mobile" href="#ACTF新生赛2020-Splendid-MineCraft"><span>[ACTF新生赛2020]Splendid_MineCraft</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#参考："><span>参考：</span></a></li></ul></li><li><a class="is-flex is-mobile" href="#Dig-the-way"><span>Dig the way</span></a></li><li><a class="is-flex is-mobile" href="#watevrCTF-2019-Repyc"><span>[watevrCTF 2019]Repyc</span></a></li><li><a class="is-flex is-mobile" href="#ctfshow-逆向4"><span>[ctfshow]逆向4</span></a></li><li><a class="is-flex is-mobile" href="#powerPacked"><span>powerPacked</span></a></li><li><a class="is-flex is-mobile" href="#FlareOn4-greek-to-me"><span>[FlareOn4]greek_to_me</span></a><ul class="menu-list"><ul class="menu-list"><li><a class="is-flex is-mobile" href="#相关函数："><span>相关函数：</span></a></li><li><a class="is-flex is-mobile" href="#开始解题"><span>开始解题</span></a></li></ul></ul></li><li><a class="is-flex is-mobile" href="#GKCTF-2021-Crash"><span>[GKCTF 2021]Crash</span></a></li><li><a class="is-flex is-mobile" href="#GKCTF-2021-SoMuchCode"><span>[GKCTF 2021]SoMuchCode</span></a></li><li><a class="is-flex is-mobile" href="#GKCTF-2021-app-debug"><span>[GKCTF 2021]app-debug</span></a></li><li><a class="is-flex is-mobile" href="#RCTF2019-DontEatMe"><span>[RCTF2019]DontEatMe</span></a></li><li><a class="is-flex is-mobile" href="#SUSCTF-2022-hell-world"><span>[SUSCTF 2022]hell_world</span></a></li><li><a class="is-flex is-mobile" href="#CFI-CTF-2018-Automated-Reversing"><span>[CFI-CTF 2018]Automated Reversing</span></a></li><li><a class="is-flex is-mobile" href="#MRCTF2020-Virtual-tree"><span>[MRCTF2020 Virtual_tree]</span></a><ul class="menu-list"><ul class="menu-list"><li><a class="is-flex is-mobile" href="#一些去花小感想"><span>一些去花小感想</span></a></li></ul></ul></li><li><a class="is-flex is-mobile" href="#羊城杯-2020-babyre"><span>[羊城杯 2020]babyre</span></a></li><li><a class="is-flex is-mobile" href="#SWPU2019-EasiestRe"><span>[SWPU2019]EasiestRe</span></a></li><li><a class="is-flex is-mobile" href="#SUCTF2019-hardcpp"><span>[SUCTF2019]hardcpp</span></a></li></ul></div></div><style>.menu-list > li > a.is-active + .menu-list { display: block; }.menu-list > li > a + .menu-list { display: none; }</style><script src="/js/toc.js" defer></script></div><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="https://github.com/Curator-Kim/Curator-Kim.github.io/blob/22a41709ffc26f62191d72a87ffbb342d46bfce3/img/icon.jpg?raw=true" alt="Curator-Kim"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Curator-Kim</p><p class="is-size-6 is-block">寻几处好景破星光</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>火星</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">33</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">0</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">14</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/ppoffice" target="_blank" rel="noopener">Follow</a></div><div class="level is-mobile"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/curator-kim"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Email" href="/804242129@qq.com"><i class="fa fa-envelope"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/atom.xml"><i class="fas fa-rss"></i></a></div><div><hr><p id="hitokoto">:D 一言句子获取中...</p><script type="text/javascript" defer>function getYiyan(){
                                $.getJSON("https://v1.hitokoto.cn/", function (data) {
                                if(data){
                                    $('#hitokoto').html("");
                                    $('#hitokoto').append("<strong style='color: #3273dc;'>"+data.hitokoto+"</strong>"+
                                    "<p>"+"From《"+data.from+"》</p><p>Provider-"+data.creator+"</p>");
                                }});}
                                $(function (){getYiyan();$('#hitokoto').click(function(){getYiyan();})});</script></div></div></div><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">Links</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://hexo.io" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Hexo</span></span><span class="level-right"><span class="level-item tag">hexo.io</span></span></a></li><li><a class="level is-mobile" href="https://bulma.io" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Bulma</span></span><span class="level-right"><span class="level-item tag">bulma.io</span></span></a></li></ul></div></div></div><!--!--><div class="card widget"><div class="card-content"><h3 class="menu-label">Recents</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-02-08T15:21:22.000Z">2023-02-08</time></p><p class="title"><a href="/2023/02/08/HGAME2023WP/"> </a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-01-09T13:23:27.000Z">2023-01-09</time></p><p class="title"><a href="/2023/01/09/HWS2023%20Winter%20Wp/"> </a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-01-09T13:23:07.000Z">2023-01-09</time></p><p class="title"><a href="/2023/01/09/%E5%A4%8D%E5%81%A5%E8%AE%AD%E7%BB%83/">复健训练</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-09-05T16:22:59.000Z">2022-09-06</time></p><p class="title"><a href="/2022/09/06/%E7%BE%8A%E5%9F%8E%E6%9D%AFwp/">羊城杯2022 wp</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-08-14T09:42:10.000Z">2022-08-14</time></p><p class="title"><a href="/2022/08/14/Crypto-NTRU%E5%AF%86%E7%A0%81%E7%B3%BB%E7%BB%9F/">Crypto NTRU密码系统</a></p></div></article></div></div><!--!--><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Archives</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/archives/2023/02/"><span class="level-start"><span class="level-item">February 2023</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2023/01/"><span class="level-start"><span class="level-item">January 2023</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2022/09/"><span class="level-start"><span class="level-item">September 2022</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2022/08/"><span class="level-start"><span class="level-item">August 2022</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2022/07/"><span class="level-start"><span class="level-item">July 2022</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><a class="level is-mobile is-marginless" href="/archives/"><span class="level-start"><span class="level-item">查看全部&gt;&gt;</span></span></a></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Tags</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/CTF/"><span class="tag">CTF</span><span class="tag is-grey-lightest">14</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80/"><span class="tag">汇编语言</span><span class="tag is-grey-lightest">12</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Crypto/"><span class="tag">Crypto</span><span class="tag is-grey-lightest">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ctf/"><span class="tag">ctf</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/pwn/"><span class="tag">pwn</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/CopperSmith/"><span class="tag">CopperSmith</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/DES/"><span class="tag">DES</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/HWS/"><span class="tag">HWS</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/NTRU/"><span class="tag">NTRU</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/RE/"><span class="tag">RE</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Reverse/"><span class="tag">Reverse</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/angr/"><span class="tag">angr</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/"><span class="tag">参考资料</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E9%A2%84%E5%A4%87%E7%9F%A5%E8%AF%86/"><span class="tag">预备知识</span><span class="tag is-grey-lightest">1</span></a></div></div></div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">Subscribe for updates</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="Subscribe"></div></div></form></div></div></div><!--!--><div class="column-right-shadow is-hidden-widescreen"></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="https://github.com/Curator-Kim/Curator-Kim.github.io/blob/master/img/logo.png?raw=true" alt="Curator-Kim的小站" height="28"></a><p class="size-small"><span>&copy; 2023 Curator-Kim</span>  Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank">Icarus</a> &amp; <a href="https://github.com/removeif/hexo-theme-amazing" target="_blank">Amazing</a> <br><span>© <a href="http://www.beian.miit.gov.cn/" target="_blank">粤ICP备88888888号-8（测试）</a><br></span><span>© 版权说明：[本网站所有内容均收集于互联网或自己创作,<br />&nbsp;&nbsp;&nbsp;&nbsp;方便于网友与自己学习交流，如有侵权，请<a href="/message" target="_blank">留言</a>，立即处理]<br /></span><span><span id="statistic-times">loading...</span><script>function createTime(time) {
            var n = new Date(time);
            now.setTime(now.getTime() + 250),
                days = (now - n) / 1e3 / 60 / 60 / 24,
                dnum = Math.floor(days),
                hours = (now - n) / 1e3 / 60 / 60 - 24 * dnum,
                hnum = Math.floor(hours),
            1 == String(hnum).length && (hnum = "0" + hnum),
                minutes = (now - n) / 1e3 / 60 - 1440 * dnum - 60 * hnum,
                mnum = Math.floor(minutes),
            1 == String(mnum).length && (mnum = "0" + mnum),
                seconds = (now - n) / 1e3 - 86400 * dnum - 3600 * hnum - 60 * mnum,
                snum = Math.round(seconds),
            1 == String(snum).length && (snum = "0" + snum),
                document.getElementById("statistic-times").innerHTML = "❤️Site from <strong>"+time.split(" ")[0].replace(/\//g,".")+"</strong> has existed <strong>" + dnum + "</strong> d <strong>" + hnum + "</strong> h <strong>" + mnum + "</strong> m <strong>" + snum + "</strong> s！❤️";
        }var now = new Date();setInterval("createTime('2022/1/21 00:00:00')", 250,"");</script><br></span><div class="size-small"><span>❤️Thx <strong><span id="busuanzi_value_site_uv">99+</span></strong> users <strong><span id="busuanzi_value_site_pv">99+</span></strong> visited！❤️</span></div></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/removeif/hexo-theme-amazing"><i class="fab fa-github"></i></a></p></div><div class="sideMusic"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css"><script src="/js/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script><meting-js style="width: auto;height: 2000px;" server="netease" type="playlist" id="137510737" theme="#2980b9" loop="all" autoplay="false" order="list" storageName="aplayer-setting" lrctype="0" list-max-height="400px" fixed="true"></meting-js></div></div></div></div></footer><script src="https://cdnjs.loli.net/ajax/libs/moment.js/2.22.2/moment-with-locales.min.js"></script><script src="https://cdnjs.loli.net/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" async></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdnjs.loli.net/ajax/libs/lightgallery/1.6.8/js/lightgallery.min.js" defer></script><script src="https://cdnjs.loli.net/ajax/libs/justifiedGallery/3.7.0/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><script type="text/x-mathjax-config">MathJax.Hub.Config({
            'HTML-CSS': {
                matchFontHeight: false
            },
            SVG: {
                matchFontHeight: false
            },
            CommonHTML: {
                matchFontHeight: false
            },
            tex2jax: {
                inlineMath: [
                    ['$','$'],
                    ['\\(','\\)']
                ]
            }
        });</script><script src="https://cdnjs.loli.net/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" defer></script><!--!--><script src="/js/main.js" defer></script><script>$.getScript('/js/comment-issue-data.js',function(){loadIssueData('46a9f3481b46ea0129d8','79c7c9cb847e141757d7864453bcbf89f0655b24','Curator-Kim','blog_comment',false);})</script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script><script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.js"></script><script type="text/javascript">var pjax = new Pjax({
            elements: "a",//代表点击链接就更新
            selectors: [  //代表要更新的节点
                ".section",
                "title"
            ],
            cache: true,
            cacheBust:false
        })

        function loadBusuanzi(){
        $.getScript("//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js", function () {});
        }

        function loadMathJax() { //加载mathjax
            $.getScript("//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML", function () {
                MathJax.Hub.Config({ tex2jax: { inlineMath: [['$', '$'], ['\(', '\)']] } });
                var math = document.getElementsByClassName("entry-content")[0];
                MathJax.Hub.Queue(["Typeset", MathJax.Hub, math]);
            });
        };

        // 开始 PJAX 执行的函数
        document.addEventListener('pjax:send', function () {
        });
        
        // PJAX 完成之后执行的函数，可以和上面的重载放在一起
        document.addEventListener('pjax:complete', function () {
            $(".section").css({opacity:1});
            if(false){
                $.getScript('/js/comment-issue-data.js',function(){loadIssueData('46a9f3481b46ea0129d8','79c7c9cb847e141757d7864453bcbf89f0655b24','Curator-Kim','blog_comment',false);});
            }
            if(false){
                loadMathJax();
            }
            loadMainJs(jQuery, window.moment, window.ClipboardJS, window.IcarusThemeSettings);
            loadBackTop();
            loadBusuanzi();
            if(typeof loadBanner == 'function'){
                loadBanner();
            }
        });</script></body></html>