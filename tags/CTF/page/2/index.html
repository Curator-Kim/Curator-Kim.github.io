<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Tag: CTF - Curator-Kim的小站</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="Curator-Kim的小站"><meta name="msapplication-TileImage" content="https://cdn.jsdelivr.net/gh/removeif/removeif-demo@latest/img/favicon.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Curator-Kim的小站"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="NothingLe3t_h3re"><meta property="og:type" content="blog"><meta property="og:title" content="Curator-Kim"><meta property="og:url" content="https://curator-kim.github.io/"><meta property="og:site_name" content="Curator-Kim"><meta property="og:description" content="NothingLe3t_h3re"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://curator-kim.github.io/img/icon.jpg"><meta property="article:author" content="Curator-Kim"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/img/icon.jpg"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://Curator-Kim.github.io"},"headline":"Curator-Kim的小站","image":["http://curator-kim.github.io/img/og_image.png"],"author":{"@type":"Person","name":"Curator-Kim"},"description":"NothingLe3t_h3re"}</script><link rel="icon" href="https://cdn.jsdelivr.net/gh/removeif/removeif-demo@latest/img/favicon.png"><meta name="referrer" content="no-referrer-when-downgrade"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/font-awesome/5.12.0/css/all.min.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/highlight.js/9.12.0/styles/atom-one-light.min.css"><link rel="stylesheet" href="https://fonts.loli.net/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/font-awesome/5.12.0/css/all.min.css"><link rel="stylesheet" href="https://fonts.loli.net/css?family=Ubuntu:400,600|Source+Code+Pro|Monda:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Microsoft YaHei:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&amp;amp;subset=latin,latin-ext|Inconsolata|Itim|Lobster.css"><script src="https://cdnjs.loli.net/ajax/libs/jquery/3.3.1/jquery.min.js"></script><script src="/js/globalUtils.js"></script><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><!--!--><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/lightgallery/1.6.8/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/justifiedGallery/3.7.0/css/justifiedGallery.min.css"><!--!--><!--!--><!--!--><script src="https://cdnjs.loli.net/ajax/libs/pace/1.0.2/pace.min.js"></script><link rel="stylesheet" href="/live2d/waifu.css"><script type="text/javascript" async src="/live2d/autoload.js"></script><meta name="generator" content="Hexo 5.4.0"></head><body class="is-3-column has-navbar-fixed-top"><nav class="navbar navbar-main is-fixed-top"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="https://github.com/Curator-Kim/Curator-Kim.github.io/blob/master/img/logo.png?raw=true" alt="Curator-Kim的小站" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a><a class="navbar-item" href="/album">Album</a><a class="navbar-item" href="/friend">Friend</a><a class="navbar-item" href="/message">Message</a><a class="navbar-item" href="/self-talking">Self-talking</a><a class="navbar-item" href="/music">Music</a><a class="navbar-item" href="/media">Media</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Join Gitter" href="https://gitter.im/hexo-theme-amazing/community"><i class="fab fa-gitter"></i></a><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/removeif/hexo-theme-amazing"><i class="fab fa-github"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a><a class="navbar-item" id="night-nav" title="Night Mode" href="javascript:;"><i class="fas fa-moon" id="night-icon"></i></a></div></div></div></nav><script type="text/javascript" src="/js/theme-setting.js"></script><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><div class="card-content"><nav class="breadcrumb" aria-label="breadcrumbs"><ul><li><a href="/tags">Tags</a></li><li class="is-active"><a href="#" aria-current="page">CTF</a></li></ul></nav></div></div><!--!--><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><i class="far fa-calendar-plus"> </i>2022-03-12  <a class="commentCountImg" href="/2022/03/12/Crypto-2/#comment-container"><span class="display-none-class">0ec702580b2214b2cd779c9c9939cfe4</span><i class="far fa-comment-dots"></i> <span class="commentCount" id="0ec702580b2214b2cd779c9c9939cfe4">99+</span>  </a><span class="level-item"><i class="far fa-clock"> </i>22 m  <i class="fas fa-pencil-alt"> </i>3.3 k</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/03/12/Crypto-2/">Crypto 2</a></h1><div class="content"><h2 id="N1CTF-2023-e2w-rmup"><a href="#N1CTF-2023-e2w-rmup" class="headerlink" title="[N1CTF 2023]e2w@rmup"></a>[N1CTF 2023]e2w@rmup</h2><p>题目描述</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> ecdsa</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> pad</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gen</span>():</span></span><br><span class="line">    curve = ecdsa.NIST256p.generator</span><br><span class="line">    order = curve.order()</span><br><span class="line">    d = randint(<span class="number">1</span>, order-<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">while</span> d.bit_length() != <span class="number">256</span>:</span><br><span class="line">        d = randint(<span class="number">1</span>, order-<span class="number">1</span>)</span><br><span class="line">    pubkey = ecdsa.ecdsa.Public_key(curve, curve * d)</span><br><span class="line">    privkey = ecdsa.ecdsa.Private_key(pubkey, d)</span><br><span class="line">    <span class="keyword">return</span> pubkey, privkey, d</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">nonce_gen</span>(<span class="params">msg, d</span>):</span></span><br><span class="line">    msg_bin = <span class="built_in">bin</span>(msg)[<span class="number">2</span>:].zfill(<span class="number">256</span>)</span><br><span class="line">    d_bin = <span class="built_in">bin</span>(d)[<span class="number">2</span>:].zfill(<span class="number">256</span>)</span><br><span class="line">    nonce = <span class="built_in">int</span>(msg_bin[:<span class="number">128</span>] + d_bin[:<span class="number">128</span>], <span class="number">2</span>)</span><br><span class="line">    <span class="keyword">return</span> nonce</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sign</span>(<span class="params">msg, privkey, d</span>):</span></span><br><span class="line">    msg_hash = bytes_to_long(hashlib.sha256(msg).digest())</span><br><span class="line">    nonce = nonce_gen(msg_hash, d)</span><br><span class="line">    sig = privkey.sign(msg_hash, nonce)</span><br><span class="line">    s, r = sig.s, sig.r</span><br><span class="line">    <span class="keyword">return</span> s, r</span><br><span class="line"></span><br><span class="line">pk, sk, d = gen()</span><br><span class="line">msg = <span class="string">b&#x27;welcome to n1ctf2023!&#x27;</span></span><br><span class="line">s, r = sign(msg, sk, d)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;s = <span class="subst">&#123;s&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;r = <span class="subst">&#123;r&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line">m = pad(flag, <span class="number">16</span>)</span><br><span class="line">aes = AES.new(long_to_bytes(d), mode=AES.MODE_ECB)</span><br><span class="line">cipher = aes.encrypt(m)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;cipher = <span class="subst">&#123;cipher&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">s = 98064531907276862129345013436610988187051831712632166876574510656675679745081</span></span><br><span class="line"><span class="string">r = 9821122129422509893435671316433203251343263825232865092134497361752993786340</span></span><br><span class="line"><span class="string">cipher = b&#x27;\xf3#\xff\x17\xdf\xbb\xc0\xc6v\x1bg\xc7\x8a6\xf2\xdf~\x12\xd8]\xc5\x02Ot\x99\x9f\xf7\xf3\x98\xbc\x045\x08\xfb\xce1@e\xbcg[I\xd1\xbf\xf8\xea\n-&#x27;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>
<p>解法参考论文：<a target="_blank" rel="noopener" href="https://eprint.iacr.org/2023/841">The curious case of the half-half Bitcoin ECDSA nonces (iacr.org)</a></p>
<p>题目中使用了如下方法构造Nonce:</p>
<script type="math/tex; mode=display">
nonce=msg_h<<128+d_h</script><p>则由ECDSA的签名公式</p>
<script type="math/tex; mode=display">
s=k^{-1}(h(m)+d*r) \mod p</script><p>可以整理为</p>
<script type="math/tex; mode=display">
s=(msg+(d_h*2^{128}+d_l)*r)*(msg_h<<128+d_h)^{-1}</script><p>进一步整理</p>
<script type="math/tex; mode=display">
d_l=(s*(msg_h<<128+d_h)-msg)*r^{-1}-(d_h*2^{128})</script><p>将$d_h$整理到一起，有</p>
<script type="math/tex; mode=display">
d_l=d_h(sr^{-1}-2^{128})+(s*m_h<<128-m)*r^{-1}</script><p>令$A=sr^{-1}-2^{128},B=(s<em>m_h&lt;&lt;128-m)</em>r^{-1}$，有$d_l=d_hA+B$</p>
<p>期望通过构造以下格解决</p>
<script type="math/tex; mode=display">
\begin{bmatrix}
    A & 0 & 1 \\
    B & 2^{127} & 0 \\
    p & 0 & 0 \\
\end{bmatrix}</script><p>但由高斯启发式判断并不满足</p>
<script type="math/tex; mode=display">
\sigma(L)=\sqrt{\frac{n}{2\pi e}}(\det L)^{\frac1n}</script><p>爆破一位最小向量，可转化为</p>
<script type="math/tex; mode=display">
x<<127+d_l'=A*(1<<127+m_h')+B\\
d_l'=Am_h'+B+A*(1<<127)-x<<127</script><p>构造以下格</p>
<script type="math/tex; mode=display">
\begin{bmatrix}
    A & 0 & 1 \\
    B+A*(1<<127)-x<<127 & 2^{127} & 0 \\
    p & 0 & 0 \\
\end{bmatrix}</script><p>exp: 参考<a target="_blank" rel="noopener" href="https://blog.csdn.net/XiongSiqi_blog/article/details/134460326">记录一些涉及到界的题_因此在方程f,模数n确认的情况下,我们可以通过-CSDN博客</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> ecdsa</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line">curve = ecdsa.NIST256p.generator</span><br><span class="line">q = curve.order()</span><br><span class="line">a=ecdsa.NIST256p.curve.a()</span><br><span class="line">b=ecdsa.NIST256p.curve.b()</span><br><span class="line">p=ecdsa.NIST256p.curve.p()</span><br><span class="line">msg = <span class="string">b&#x27;welcome to n1ctf2023!&#x27;</span></span><br><span class="line">msg_hash = bytes_to_long(hashlib.sha256(msg).digest())</span><br><span class="line"></span><br><span class="line">s = <span class="number">98064531907276862129345013436610988187051831712632166876574510656675679745081</span></span><br><span class="line">r = <span class="number">9821122129422509893435671316433203251343263825232865092134497361752993786340</span></span><br><span class="line">cipher = <span class="string">b&#x27;\xf3#\xff\x17\xdf\xbb\xc0\xc6v\x1bg\xc7\x8a6\xf2\xdf~\x12\xd8]\xc5\x02Ot\x99\x9f\xf7\xf3\x98\xbc\x045\x08\xfb\xce1@e\xbcg[I\xd1\xbf\xf8\xea\n-&#x27;</span></span><br><span class="line"></span><br><span class="line">y = <span class="number">1</span> &lt;&lt; <span class="number">127</span></span><br><span class="line">x = <span class="number">1</span> &lt;&lt; <span class="number">127</span></span><br><span class="line">A = (s * inverse(r,q) - <span class="number">2</span> ** <span class="number">128</span>) % q</span><br><span class="line">B = (s * (msg_hash // <span class="number">2</span> ** <span class="number">128</span>) * <span class="number">2</span> ** <span class="number">128</span> - msg_hash) * inverse(r,q) % q</span><br><span class="line"></span><br><span class="line">BB = ((A * y - x) + B) % q</span><br><span class="line"></span><br><span class="line">M = matrix(ZZ,[[q,<span class="number">0</span>,<span class="number">0</span>],</span><br><span class="line">               [A,<span class="number">1</span>,<span class="number">0</span>],</span><br><span class="line">               [BB,<span class="number">0</span>,<span class="number">2</span> ** <span class="number">127</span>]])</span><br><span class="line"></span><br><span class="line">L = M.LLL()[<span class="number">0</span>]</span><br><span class="line">d = (L[<span class="number">1</span>] + y) * <span class="number">2</span> ** <span class="number">128</span> + L[<span class="number">0</span>] + x</span><br><span class="line">aes = AES.new(long_to_bytes(d), mode=AES.MODE_ECB)</span><br><span class="line"><span class="built_in">print</span>(aes.decrypt(cipher))</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>另外也可以将$[0,2^l]$转化到$[-2^{l-1},2^{l-1}]$上，也有一定可能能求解出来</p>
<h2 id="N1CTF-2023-e2-m4"><a href="#N1CTF-2023-e2-m4" class="headerlink" title="[N1CTF 2023]e2$m4"></a>[N1CTF 2023]e2$m4</h2><p>题目描述</p>
<p>task.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> util</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line">FLAG = os.environ.get(<span class="string">&#x27;FLAG&#x27;</span>, <span class="string">&#x27;n1ctf&#123;XXXXFAKE_FLAGXXXX&#125;&#x27;</span>)</span><br><span class="line">key = os.urandom(<span class="number">16</span>)</span><br><span class="line"></span><br><span class="line">ct = []</span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">    ct.append(util.crypt_ecb(FLAG.encode(), key, <span class="number">31</span>-_).<span class="built_in">hex</span>())</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Dance_Box = <span class="subst">&#123;util.Dance_Box&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;ct = &#125;</span>&quot;</span>)</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Dance_Box = [[46, 38, 43, 106, 114, 176, 12, 69, 1, 21, 82, 27, 184, 109, 170, 0, 179, 25, 4, 145, 33, 61, 66, 223, 85, 238, 22, 23, 59, 64, 19, 174, 180, 240, 111, 128, 187, 65, 72, 35, 77, 221, 157, 172, 13, 197, 44, 229, 226, 130, 220, 49, 198, 24, 103, 76, 39, 211, 191, 115, 165, 206, 30, 7, 98, 156, 205, 181, 89, 252, 58, 138, 253, 104, 212, 236, 54, 224, 166, 155, 118, 8, 93, 140, 28, 95, 225, 248, 80, 182, 112, 63, 192, 116, 47, 217, 91, 84, 144, 53, 124, 117, 16, 73, 218, 254, 188, 18, 11, 107, 222, 5, 52, 129, 194, 173, 81, 9, 137, 246, 242, 143, 175, 147, 74, 195, 41, 133, 207, 120, 92, 17, 164, 169, 171, 48, 241, 57, 31, 83, 55, 96, 29, 185, 68, 232, 70, 148, 243, 209, 100, 214, 37, 244, 219, 131, 203, 139, 126, 183, 167, 199, 101, 159, 50, 230, 168, 45, 149, 123, 119, 87, 134, 75, 127, 67, 250, 228, 247, 135, 113, 60, 62, 177, 150, 121, 162, 227, 142, 34, 178, 42, 15, 160, 161, 216, 235, 234, 163, 186, 154, 141, 233, 208, 78, 151, 204, 190, 86, 152, 245, 239, 108, 196, 158, 210, 99, 237, 251, 3, 40, 90, 125, 132, 36, 215, 193, 71, 255, 200, 102, 56, 32, 136, 146, 79, 97, 110, 249, 20, 202, 231, 122, 88, 94, 6, 153, 105, 14, 10, 2, 201, 189, 213, 51, 26], [246, 56, 103, 21, 181, 105, 216, 118, 145, 183, 169, 211, 27, 242, 190, 162, 237, 179, 244, 199, 206, 35, 120, 38, 95, 133, 25, 231, 3, 70, 40, 238, 223, 45, 127, 245, 4, 15, 250, 11, 52, 215, 142, 129, 167, 191, 61, 241, 188, 226, 249, 146, 221, 184, 104, 109, 157, 39, 176, 114, 236, 240, 254, 253, 251, 158, 198, 37, 42, 19, 87, 230, 153, 43, 77, 76, 208, 26, 32, 18, 150, 195, 122, 90, 80, 148, 197, 44, 83, 51, 166, 75, 88, 73, 64, 252, 20, 119, 46, 201, 196, 121, 222, 115, 22, 128, 164, 102, 97, 5, 217, 172, 177, 81, 58, 234, 168, 60, 29, 124, 147, 101, 224, 151, 130, 65, 98, 225, 155, 91, 108, 152, 140, 219, 9, 24, 189, 203, 138, 160, 59, 48, 193, 14, 69, 159, 233, 53, 135, 143, 33, 165, 41, 132, 57, 187, 227, 93, 200, 1, 0, 149, 137, 194, 23, 117, 170, 247, 17, 255, 92, 205, 47, 213, 136, 66, 2, 209, 6, 110, 78, 63, 28, 74, 235, 229, 30, 139, 154, 94, 131, 49, 86, 185, 163, 79, 68, 8, 72, 174, 99, 111, 141, 107, 210, 34, 207, 239, 106, 144, 228, 186, 89, 204, 55, 54, 171, 161, 100, 16, 13, 7, 50, 182, 112, 173, 212, 31, 214, 85, 156, 180, 175, 116, 248, 243, 36, 82, 134, 123, 220, 10, 125, 96, 67, 62, 12, 202, 126, 71, 84, 113, 232, 178, 192, 218], [46, 38, 43, 106, 114, 176, 12, 69, 1, 21, 82, 27, 184, 109, 170, 0, 179, 25, 4, 145, 33, 61, 66, 223, 85, 238, 22, 23, 59, 64, 19, 174, 180, 240, 111, 128, 187, 65, 72, 35, 77, 221, 157, 172, 13, 197, 44, 229, 226, 130, 220, 49, 198, 24, 103, 76, 39, 211, 191, 115, 165, 206, 30, 7, 98, 156, 205, 181, 89, 252, 58, 138, 253, 104, 212, 236, 54, 224, 166, 155, 118, 8, 93, 140, 28, 95, 225, 248, 80, 182, 112, 63, 192, 116, 47, 217, 91, 84, 144, 53, 124, 117, 16, 73, 218, 254, 188, 18, 11, 107, 222, 5, 52, 129, 194, 173, 81, 9, 137, 246, 242, 143, 175, 147, 74, 195, 41, 133, 207, 120, 92, 17, 164, 169, 171, 48, 241, 57, 31, 83, 55, 96, 29, 185, 68, 232, 70, 148, 243, 209, 100, 214, 37, 244, 219, 131, 203, 139, 126, 183, 167, 199, 101, 159, 50, 230, 168, 45, 149, 123, 119, 87, 134, 75, 127, 67, 250, 228, 247, 135, 113, 60, 62, 177, 150, 121, 162, 227, 142, 34, 178, 42, 15, 160, 161, 216, 235, 234, 163, 186, 154, 141, 233, 208, 78, 151, 204, 190, 86, 152, 245, 239, 108, 196, 158, 210, 99, 237, 251, 3, 40, 90, 125, 132, 36, 215, 193, 71, 255, 200, 102, 56, 32, 136, 146, 79, 97, 110, 249, 20, 202, 231, 122, 88, 94, 6, 153, 105, 14, 10, 2, 201, 189, 213, 51, 26], [206, 165, 193, 37, 187, 108, 248, 246, 44, 139, 152, 201, 173, 214, 77, 72, 97, 35, 70, 24, 3, 79, 178, 175, 30, 66, 18, 198, 114, 125, 32, 210, 180, 224, 235, 28, 62, 136, 149, 227, 82, 147, 90, 119, 85, 199, 126, 121, 51, 20, 88, 4, 75, 101, 38, 151, 109, 115, 110, 223, 43, 17, 146, 249, 226, 26, 222, 232, 87, 195, 200, 131, 245, 81, 113, 157, 220, 12, 16, 184, 204, 192, 84, 31, 197, 215, 129, 94, 93, 181, 218, 194, 65, 148, 158, 112, 221, 34, 25, 33, 243, 78, 10, 67, 209, 6, 252, 196, 237, 42, 172, 164, 161, 244, 111, 191, 46, 170, 128, 69, 183, 212, 60, 99, 8, 122, 49, 86, 247, 96, 179, 57, 135, 106, 0, 58, 100, 202, 55, 98, 1, 254, 53, 155, 156, 83, 132, 9, 19, 171, 48, 95, 166, 68, 22, 104, 7, 14, 142, 211, 213, 50, 150, 234, 182, 203, 217, 64, 185, 163, 73, 45, 41, 118, 103, 134, 186, 230, 241, 250, 52, 207, 162, 124, 140, 116, 167, 228, 92, 63, 47, 176, 239, 238, 5, 216, 225, 188, 137, 160, 80, 231, 102, 11, 89, 91, 59, 23, 240, 105, 153, 177, 138, 219, 174, 123, 36, 159, 76, 21, 56, 242, 61, 107, 133, 143, 154, 130, 233, 15, 145, 255, 13, 189, 120, 251, 236, 117, 208, 190, 169, 168, 74, 229, 54, 2, 39, 127, 29, 253, 141, 71, 205, 40, 144, 27]]</span></span><br><span class="line"><span class="string">ct = [&#x27;e5a304ea2ffc53a1ff94337c2b2ae5368b46c6da3cc37f8438eb967b29249d4e&#x27;, &#x27;6733baa353d4cfc4ff94337c58dc7fdbd6df83f4fbf6e5e838eb967b98d7e8d3&#x27;, &#x27;e77dbfe7868701fbd7072e6358dc7fdba067d296707bad1b0f4541dc98d7e8d3&#x27;, &#x27;54b772d532556d5573a6ab667c9ff76857b5efc3b62130668e46a79b163138e4&#x27;, &#x27;47339f6738dd9f4c9581fbd496dde76ea320d95b457e0373cddb910acc41fe35&#x27;]</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>
<p>util.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> sample</span><br><span class="line"></span><br><span class="line">i2l = <span class="keyword">lambda</span> x: [(x &gt;&gt; <span class="number">24</span>) &amp; <span class="number">0xff</span>, (x &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xff</span>, (x &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xff</span>, x &amp; <span class="number">0xff</span>]</span><br><span class="line">l2i = <span class="keyword">lambda</span> x: (x[<span class="number">0</span>] &lt;&lt; <span class="number">24</span>)|(x[<span class="number">1</span>] &lt;&lt; <span class="number">16</span>)|(x[<span class="number">2</span>] &lt;&lt; <span class="number">8</span>)|x[<span class="number">3</span>]</span><br><span class="line">rotl32 = <span class="keyword">lambda</span> x, n: ((x &lt;&lt; n) &amp; <span class="number">0xffffffff</span>) | ((x &gt;&gt; (<span class="number">32</span>-n)) &amp; <span class="number">0xffffffff</span>)</span><br><span class="line">rotl8 = <span class="keyword">lambda</span> x, n: ((x &lt;&lt; n) &amp; <span class="number">0xff</span>) | ((x &gt;&gt; (<span class="number">8</span>-n)) &amp; <span class="number">0xff</span>)</span><br><span class="line">xor = <span class="keyword">lambda</span> x, y: <span class="built_in">list</span>(<span class="built_in">map</span>(<span class="keyword">lambda</span> a, b: a ^ b, x, y))</span><br><span class="line">pad = <span class="keyword">lambda</span> data, block=<span class="number">16</span>: data + [<span class="number">16</span> - <span class="built_in">len</span>(data) % block]*(<span class="number">16</span> - <span class="built_in">len</span>(data) % block)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">SM4_BOXES_TABLE = [</span><br><span class="line">    <span class="number">0xd6</span>, <span class="number">0x90</span>, <span class="number">0xe9</span>, <span class="number">0xfe</span>, <span class="number">0xcc</span>, <span class="number">0xe1</span>, <span class="number">0x3d</span>, <span class="number">0xb7</span>, <span class="number">0x16</span>, <span class="number">0xb6</span>, <span class="number">0x14</span>, <span class="number">0xc2</span>, <span class="number">0x28</span>, <span class="number">0xfb</span>, <span class="number">0x2c</span>,</span><br><span class="line">    <span class="number">0x05</span>, <span class="number">0x2b</span>, <span class="number">0x67</span>, <span class="number">0x9a</span>, <span class="number">0x76</span>, <span class="number">0x2a</span>, <span class="number">0xbe</span>, <span class="number">0x04</span>, <span class="number">0xc3</span>, <span class="number">0xaa</span>, <span class="number">0x44</span>, <span class="number">0x13</span>, <span class="number">0x26</span>, <span class="number">0x49</span>, <span class="number">0x86</span>,</span><br><span class="line">    <span class="number">0x06</span>, <span class="number">0x99</span>, <span class="number">0x9c</span>, <span class="number">0x42</span>, <span class="number">0x50</span>, <span class="number">0xf4</span>, <span class="number">0x91</span>, <span class="number">0xef</span>, <span class="number">0x98</span>, <span class="number">0x7a</span>, <span class="number">0x33</span>, <span class="number">0x54</span>, <span class="number">0x0b</span>, <span class="number">0x43</span>, <span class="number">0xed</span>,</span><br><span class="line">    <span class="number">0xcf</span>, <span class="number">0xac</span>, <span class="number">0x62</span>, <span class="number">0xe4</span>, <span class="number">0xb3</span>, <span class="number">0x1c</span>, <span class="number">0xa9</span>, <span class="number">0xc9</span>, <span class="number">0x08</span>, <span class="number">0xe8</span>, <span class="number">0x95</span>, <span class="number">0x80</span>, <span class="number">0xdf</span>, <span class="number">0x94</span>, <span class="number">0xfa</span>,</span><br><span class="line">    <span class="number">0x75</span>, <span class="number">0x8f</span>, <span class="number">0x3f</span>, <span class="number">0xa6</span>, <span class="number">0x47</span>, <span class="number">0x07</span>, <span class="number">0xa7</span>, <span class="number">0xfc</span>, <span class="number">0xf3</span>, <span class="number">0x73</span>, <span class="number">0x17</span>, <span class="number">0xba</span>, <span class="number">0x83</span>, <span class="number">0x59</span>, <span class="number">0x3c</span>,</span><br><span class="line">    <span class="number">0x19</span>, <span class="number">0xe6</span>, <span class="number">0x85</span>, <span class="number">0x4f</span>, <span class="number">0xa8</span>, <span class="number">0x68</span>, <span class="number">0x6b</span>, <span class="number">0x81</span>, <span class="number">0xb2</span>, <span class="number">0x71</span>, <span class="number">0x64</span>, <span class="number">0xda</span>, <span class="number">0x8b</span>, <span class="number">0xf8</span>, <span class="number">0xeb</span>,</span><br><span class="line">    <span class="number">0x0f</span>, <span class="number">0x4b</span>, <span class="number">0x70</span>, <span class="number">0x56</span>, <span class="number">0x9d</span>, <span class="number">0x35</span>, <span class="number">0x1e</span>, <span class="number">0x24</span>, <span class="number">0x0e</span>, <span class="number">0x5e</span>, <span class="number">0x63</span>, <span class="number">0x58</span>, <span class="number">0xd1</span>, <span class="number">0xa2</span>, <span class="number">0x25</span>,</span><br><span class="line">    <span class="number">0x22</span>, <span class="number">0x7c</span>, <span class="number">0x3b</span>, <span class="number">0x01</span>, <span class="number">0x21</span>, <span class="number">0x78</span>, <span class="number">0x87</span>, <span class="number">0xd4</span>, <span class="number">0x00</span>, <span class="number">0x46</span>, <span class="number">0x57</span>, <span class="number">0x9f</span>, <span class="number">0xd3</span>, <span class="number">0x27</span>, <span class="number">0x52</span>,</span><br><span class="line">    <span class="number">0x4c</span>, <span class="number">0x36</span>, <span class="number">0x02</span>, <span class="number">0xe7</span>, <span class="number">0xa0</span>, <span class="number">0xc4</span>, <span class="number">0xc8</span>, <span class="number">0x9e</span>, <span class="number">0xea</span>, <span class="number">0xbf</span>, <span class="number">0x8a</span>, <span class="number">0xd2</span>, <span class="number">0x40</span>, <span class="number">0xc7</span>, <span class="number">0x38</span>,</span><br><span class="line">    <span class="number">0xb5</span>, <span class="number">0xa3</span>, <span class="number">0xf7</span>, <span class="number">0xf2</span>, <span class="number">0xce</span>, <span class="number">0xf9</span>, <span class="number">0x61</span>, <span class="number">0x15</span>, <span class="number">0xa1</span>, <span class="number">0xe0</span>, <span class="number">0xae</span>, <span class="number">0x5d</span>, <span class="number">0xa4</span>, <span class="number">0x9b</span>, <span class="number">0x34</span>,</span><br><span class="line">    <span class="number">0x1a</span>, <span class="number">0x55</span>, <span class="number">0xad</span>, <span class="number">0x93</span>, <span class="number">0x32</span>, <span class="number">0x30</span>, <span class="number">0xf5</span>, <span class="number">0x8c</span>, <span class="number">0xb1</span>, <span class="number">0xe3</span>, <span class="number">0x1d</span>, <span class="number">0xf6</span>, <span class="number">0xe2</span>, <span class="number">0x2e</span>, <span class="number">0x82</span>,</span><br><span class="line">    <span class="number">0x66</span>, <span class="number">0xca</span>, <span class="number">0x60</span>, <span class="number">0xc0</span>, <span class="number">0x29</span>, <span class="number">0x23</span>, <span class="number">0xab</span>, <span class="number">0x0d</span>, <span class="number">0x53</span>, <span class="number">0x4e</span>, <span class="number">0x6f</span>, <span class="number">0xd5</span>, <span class="number">0xdb</span>, <span class="number">0x37</span>, <span class="number">0x45</span>,</span><br><span class="line">    <span class="number">0xde</span>, <span class="number">0xfd</span>, <span class="number">0x8e</span>, <span class="number">0x2f</span>, <span class="number">0x03</span>, <span class="number">0xff</span>, <span class="number">0x6a</span>, <span class="number">0x72</span>, <span class="number">0x6d</span>, <span class="number">0x6c</span>, <span class="number">0x5b</span>, <span class="number">0x51</span>, <span class="number">0x8d</span>, <span class="number">0x1b</span>, <span class="number">0xaf</span>,</span><br><span class="line">    <span class="number">0x92</span>, <span class="number">0xbb</span>, <span class="number">0xdd</span>, <span class="number">0xbc</span>, <span class="number">0x7f</span>, <span class="number">0x11</span>, <span class="number">0xd9</span>, <span class="number">0x5c</span>, <span class="number">0x41</span>, <span class="number">0x1f</span>, <span class="number">0x10</span>, <span class="number">0x5a</span>, <span class="number">0xd8</span>, <span class="number">0x0a</span>, <span class="number">0xc1</span>,</span><br><span class="line">    <span class="number">0x31</span>, <span class="number">0x88</span>, <span class="number">0xa5</span>, <span class="number">0xcd</span>, <span class="number">0x7b</span>, <span class="number">0xbd</span>, <span class="number">0x2d</span>, <span class="number">0x74</span>, <span class="number">0xd0</span>, <span class="number">0x12</span>, <span class="number">0xb8</span>, <span class="number">0xe5</span>, <span class="number">0xb4</span>, <span class="number">0xb0</span>, <span class="number">0x89</span>,</span><br><span class="line">    <span class="number">0x69</span>, <span class="number">0x97</span>, <span class="number">0x4a</span>, <span class="number">0x0c</span>, <span class="number">0x96</span>, <span class="number">0x77</span>, <span class="number">0x7e</span>, <span class="number">0x65</span>, <span class="number">0xb9</span>, <span class="number">0xf1</span>, <span class="number">0x09</span>, <span class="number">0xc5</span>, <span class="number">0x6e</span>, <span class="number">0xc6</span>, <span class="number">0x84</span>,</span><br><span class="line">    <span class="number">0x18</span>, <span class="number">0xf0</span>, <span class="number">0x7d</span>, <span class="number">0xec</span>, <span class="number">0x3a</span>, <span class="number">0xdc</span>, <span class="number">0x4d</span>, <span class="number">0x20</span>, <span class="number">0x79</span>, <span class="number">0xee</span>, <span class="number">0x5f</span>, <span class="number">0x3e</span>, <span class="number">0xd7</span>, <span class="number">0xcb</span>, <span class="number">0x39</span>,</span><br><span class="line">    <span class="number">0x48</span>,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">SM4_FK = [<span class="number">0xa3b1bac6</span>, <span class="number">0x56aa3350</span>, <span class="number">0x677d9197</span>, <span class="number">0xb27022dc</span>]</span><br><span class="line"></span><br><span class="line">SM4_CK = [</span><br><span class="line">    <span class="number">0x00070e15</span>, <span class="number">0x1c232a31</span>, <span class="number">0x383f464d</span>, <span class="number">0x545b6269</span>,</span><br><span class="line">    <span class="number">0x70777e85</span>, <span class="number">0x8c939aa1</span>, <span class="number">0xa8afb6bd</span>, <span class="number">0xc4cbd2d9</span>,</span><br><span class="line">    <span class="number">0xe0e7eef5</span>, <span class="number">0xfc030a11</span>, <span class="number">0x181f262d</span>, <span class="number">0x343b4249</span>,</span><br><span class="line">    <span class="number">0x50575e65</span>, <span class="number">0x6c737a81</span>, <span class="number">0x888f969d</span>, <span class="number">0xa4abb2b9</span>,</span><br><span class="line">    <span class="number">0xc0c7ced5</span>, <span class="number">0xdce3eaf1</span>, <span class="number">0xf8ff060d</span>, <span class="number">0x141b2229</span>,</span><br><span class="line">    <span class="number">0x30373e45</span>, <span class="number">0x4c535a61</span>, <span class="number">0x686f767d</span>, <span class="number">0x848b9299</span>,</span><br><span class="line">    <span class="number">0xa0a7aeb5</span>, <span class="number">0xbcc3cad1</span>, <span class="number">0xd8dfe6ed</span>, <span class="number">0xf4fb0209</span>,</span><br><span class="line">    <span class="number">0x10171e25</span>, <span class="number">0x2c333a41</span>, <span class="number">0x484f565d</span>, <span class="number">0x646b7279</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">box = sample(SM4_BOXES_TABLE, <span class="number">256</span>)</span><br><span class="line">Dance_Box = [box, sample(box, <span class="number">256</span>), box, sample(box, <span class="number">256</span>)]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dance</span>():</span></span><br><span class="line">    <span class="keyword">global</span> Dance_Box</span><br><span class="line">    Dance_Box = Dance_Box[<span class="number">2</span>:]+Dance_Box[:<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">round_key</span>(<span class="params">k</span>):</span></span><br><span class="line">    ar = [SM4_BOXES_TABLE[i] <span class="keyword">for</span> i <span class="keyword">in</span> i2l(k)]</span><br><span class="line">    b = l2i(ar)</span><br><span class="line">    <span class="keyword">return</span> b ^ rotl32(b, <span class="number">13</span>) ^ rotl32(b, <span class="number">23</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">expand_key</span>(<span class="params">master_key</span>):</span></span><br><span class="line">    master_key = <span class="built_in">list</span>(master_key)</span><br><span class="line">    MK = [l2i(master_key[:<span class="number">4</span>]), l2i(master_key[<span class="number">4</span>:<span class="number">8</span>]),\</span><br><span class="line">           l2i(master_key[<span class="number">8</span>:<span class="number">12</span>]), l2i(master_key[<span class="number">12</span>:])]</span><br><span class="line">    k = [<span class="number">0</span>]*<span class="number">36</span></span><br><span class="line">    k[<span class="number">0</span>:<span class="number">4</span>] = xor(MK, SM4_FK)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">        k[i + <span class="number">4</span>] = k[i] ^ (round_key(k[i + <span class="number">1</span>] ^ k[i + <span class="number">2</span>] ^ k[i + <span class="number">3</span>] ^ SM4_CK[i]))</span><br><span class="line">    <span class="keyword">return</span> k[<span class="number">4</span>:]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tfunc</span>(<span class="params">bk</span>):</span></span><br><span class="line">    ar = [SM4_BOXES_TABLE[i] <span class="keyword">for</span> i <span class="keyword">in</span> i2l(bk)]</span><br><span class="line">    b = l2i(ar)</span><br><span class="line">    <span class="keyword">return</span> b ^ rotl32(b, <span class="number">2</span>) ^ rotl32(b, <span class="number">10</span>) ^ rotl32(b, <span class="number">18</span>) ^ rotl32(b, <span class="number">24</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pfunc</span>(<span class="params">bk</span>):</span></span><br><span class="line">    res = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">        sbox = Dance_Box[i]</span><br><span class="line">        ar = [sbox[_] <span class="keyword">for</span> _ <span class="keyword">in</span> i2l(bk[i])]</span><br><span class="line">        b = [rotl8(ar[i], i+<span class="number">3</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>)]</span><br><span class="line">        res.append(l2i(b))</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">one_round</span>(<span class="params">bk, rk, dt</span>):</span></span><br><span class="line">    out = []</span><br><span class="line">    buf = [<span class="number">0</span>]*<span class="number">36</span></span><br><span class="line">    buf[:<span class="number">4</span>] = [l2i(bk[:<span class="number">4</span>]), l2i(bk[<span class="number">4</span>:<span class="number">8</span>]), l2i(bk[<span class="number">8</span>:<span class="number">12</span>]), l2i(bk[<span class="number">12</span>:])]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">        <span class="keyword">if</span> dt == i:</span><br><span class="line">            dance()</span><br><span class="line">        buf[i+<span class="number">4</span>] = buf[i] ^ tfunc(buf[i+<span class="number">1</span>]^buf[i+<span class="number">2</span>]^buf[i+<span class="number">3</span>]^rk[i])</span><br><span class="line">        buf[i+<span class="number">1</span>:i+<span class="number">5</span>] = pfunc(buf[i+<span class="number">1</span>:i+<span class="number">5</span>])</span><br><span class="line">    dance()</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">        out += i2l(buf[-<span class="number">1</span>-_])</span><br><span class="line">    <span class="keyword">return</span> out</span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">crypt_ecb</span>(<span class="params">pt, key, dance_time=-<span class="number">1</span></span>):</span></span><br><span class="line">    pt = pad(<span class="built_in">list</span>(pt))</span><br><span class="line">    rk = expand_key(key)</span><br><span class="line">    block = [pt[_:_+<span class="number">16</span>] <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(pt), <span class="number">16</span>)]</span><br><span class="line">    result = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> block:</span><br><span class="line">        result += <span class="built_in">bytes</span>(one_round(i, rk, dt=dance_time))</span><br><span class="line">    <span class="keyword">return</span> result</span><br></pre></td></tr></table></figure>
<h2 id="N1CTF-2022-ezdlp"><a href="#N1CTF-2022-ezdlp" class="headerlink" title="[N1CTF 2022] ezdlp"></a>[N1CTF 2022] ezdlp</h2><p>题目描述</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> prod</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">keygen</span>(<span class="params">pbits,kbits,k</span>):</span></span><br><span class="line">    p = getPrime(pbits)</span><br><span class="line">    x = [getPrime(kbits + <span class="number">1</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(k)]</span><br><span class="line">    y = prod(x)</span><br><span class="line">    <span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">        r = getPrime(pbits - kbits * k)</span><br><span class="line">        q = <span class="number">2</span> * y * r + <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> isPrime(q):</span><br><span class="line">            <span class="keyword">return</span> p*q, (p, q, r, x)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt</span>(<span class="params">key, message</span>):</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">pow</span>(<span class="number">0x10001</span>, message, key)</span><br><span class="line"></span><br><span class="line">key = keygen(<span class="number">512</span>, <span class="number">24</span>, <span class="number">20</span>)</span><br><span class="line">flag = bytes_to_long(flag)</span><br><span class="line">messages = [getPrime(flag.bit_length()) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">47</span>)] + [flag]</span><br><span class="line">enc = [encrypt(key[<span class="number">0</span>], message) <span class="keyword">for</span> message <span class="keyword">in</span> messages]</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(messages[:-<span class="number">1</span>])</span><br><span class="line"><span class="built_in">print</span>(enc)</span><br></pre></td></tr></table></figure>
<h2 id="N1CTF-2023-e2D1p"><a href="#N1CTF-2023-e2D1p" class="headerlink" title="[N1CTF 2023]e2D1p"></a>[N1CTF 2023]e2D1p</h2><p>题目描述</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line">FLAG = os.environ.get(<span class="string">&#x27;FLAG&#x27;</span>, <span class="string">b&#x27;n1ctf&#123;XXXXFAKE_FLAGXXXX&#125;&#x27;</span>)</span><br><span class="line"><span class="keyword">assert</span> FLAG[:<span class="number">6</span>] == <span class="string">b&#x27;n1ctf&#123;&#x27;</span> <span class="keyword">and</span> FLAG[-<span class="number">1</span>:] == <span class="string">b&#x27;&#125;&#x27;</span></span><br><span class="line">FLAG = FLAG[<span class="number">6</span>:-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">keygen</span>(<span class="params">nbits</span>):</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        q = getPrime(nbits)</span><br><span class="line">        <span class="keyword">if</span> isPrime(<span class="number">2</span>*q+<span class="number">1</span>):</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">pow</span>(<span class="number">0x10001</span>, q, <span class="number">2</span>*q+<span class="number">1</span>) == <span class="number">1</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="number">2</span>*q+<span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt</span>(<span class="params">key, message, mask</span>):</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">pow</span>(<span class="number">0x10001</span>, message^mask, key)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p = keygen(<span class="number">512</span>)</span><br><span class="line">flag = bytes_to_long(FLAG)</span><br><span class="line">messages = [getRandomNBitInteger(flag.bit_length()) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">200</span>)]</span><br><span class="line">enc = [encrypt(p, message, flag) <span class="keyword">for</span> message <span class="keyword">in</span> messages]</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;message = <span class="subst">&#123;messages&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;enc = <span class="subst">&#123;enc&#125;</span>&#x27;</span>)</span><br></pre></td></tr></table></figure>
<h2 id="第五届RWCTF-体验赛-babyCurve"><a href="#第五届RWCTF-体验赛-babyCurve" class="headerlink" title="[第五届RWCTF 体验赛]babyCurve"></a>[第五届RWCTF 体验赛]babyCurve</h2><p>题目描述</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randrange</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"></span><br><span class="line">p = <span class="number">193387944202565886198256260591909756041</span></span><br><span class="line"></span><br><span class="line">i = <span class="keyword">lambda</span> x: <span class="built_in">pow</span>(x, p-<span class="number">2</span>, p)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">A, B</span>):</span></span><br><span class="line">    (u, v), (w, x) = A, B</span><br><span class="line">    <span class="keyword">assert</span> u != w <span class="keyword">or</span> v == x</span><br><span class="line">    <span class="keyword">if</span> u == w: m = (<span class="number">3</span>*u*w + <span class="number">4</span>*u + <span class="number">1</span>) * i(v+x)</span><br><span class="line">    <span class="keyword">else</span>: m = (x-v) * i(w-u)</span><br><span class="line">    y = m*m - u - w - <span class="number">2</span></span><br><span class="line">    z = m*(u-y) - v</span><br><span class="line">    <span class="keyword">return</span> y % p, z % p</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">mul</span>(<span class="params">t, A, B=<span class="number">0</span></span>):</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> t: <span class="keyword">return</span> B</span><br><span class="line">    <span class="keyword">return</span> mul(t//<span class="number">2</span>, add(A,A), B <span class="keyword">if</span> <span class="keyword">not</span> t&amp;<span class="number">1</span> <span class="keyword">else</span> add(B,A) <span class="keyword">if</span> B <span class="keyword">else</span> A)</span><br><span class="line"></span><br><span class="line">x = randrange(p)</span><br><span class="line">aes = AES.new(x.to_bytes(<span class="number">16</span>, <span class="string">&#x27;big&#x27;</span>), AES.MODE_CBC, <span class="built_in">bytes</span>(<span class="number">16</span>))</span><br><span class="line">flag = <span class="built_in">open</span>(<span class="string">&#x27;flag.txt&#x27;</span>).read().strip()</span><br><span class="line">cipher = aes.encrypt(flag.ljust((<span class="built_in">len</span>(flag)+<span class="number">15</span>)//<span class="number">16</span>*<span class="number">16</span>).encode())</span><br><span class="line"><span class="built_in">print</span>(*mul(x, (<span class="number">4</span>, <span class="number">10</span>)), cipher.<span class="built_in">hex</span>(), file=<span class="built_in">open</span>(<span class="string">&#x27;flag.enc&#x27;</span>, <span class="string">&#x27;w&#x27;</span>))</span><br><span class="line"><span class="comment"># 65639504587209705872811542111125696405 125330437930804525313353306745824609665 b3669dc657cef9dc17db4de5287cd1a1e8a48184ed9746f4c52d3b9f8186ec046d6fb1b8ed1b45111c35b546204b68e0</span></span><br></pre></td></tr></table></figure>
<p>分析：</p>
<p>ECC上的DLP问题，但不是在经典曲线上</p>
<p>看加法的实现</p>
<script type="math/tex; mode=display">
m=\left\{
\begin{aligned}
    & (3*x_1*x_2+4*x_1+1)*(y_1+y_2)^{-1},  x_1=x_2\\
    & ((y_2-y_1)*(x_2-x_1)^{-1})
\end{aligned}
\right.
\</script><script type="math/tex; mode=display">
x_3 \equiv m*m-x_1-x_2-2 \mod p\\
y_3 \equiv m*(x_1-x_3)-y_1 \mod p</script><p>还原出曲线的形式为$y^2=x^3+2x^2+x+c$，又根据(4，10)在曲线上，可得到c=0，即$y^2=x(x+1)^2$</p>
<p>然后根据以下方法构造同构$x=x-\frac23$</p>
<img src="/2022/03/12/Crypto-2/image-20240116203542439.png" class title="image-20240116203542439">
<p>得到$x^3-\frac13x-\frac{2}{27}$，（ppt里的公式似乎有点问题？）</p>
<p>计算判别式$\Delta=-16(4a^3+27b^2)=0$，奇异点为$(-\frac13,0)$，可以下等式将dlp问题映射到乘法群上，参考</p>
<script type="math/tex; mode=display">
(x, y) \mapsto \frac{y + 7020x}{y - 7020x}\,,</script><p><a target="_blank" rel="noopener" href="https://crypto.stackexchange.com/questions/61302/how-to-solve-this-ecdlp">elliptic curves - How to solve this ECDLP? - Cryptography Stack Exchange</a></p>
<p>官方wp，注意加上群的阶数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">from Crypto.Util.number import *</span><br><span class="line">from Crypto.Cipher import AES</span><br><span class="line">p = 193387944202565886198256260591909756041</span><br><span class="line">P.&lt;x&gt; = GF(p)[]</span><br><span class="line">f = x^3 + 2*x^2 + x</span><br><span class="line">P = (4, 10)</span><br><span class="line">Q = (65639504587209705872811542111125696405,125330437930804525313353306745824609665)</span><br><span class="line">f_ = f.subs(x=x-1)</span><br><span class="line">print(f_.factor())</span><br><span class="line"></span><br><span class="line">P_ = (P[0] +1, P[1])</span><br><span class="line">Q_ = (Q[0] +1, Q[1])</span><br><span class="line"></span><br><span class="line">t = GF(p)(p-1).square_root()</span><br><span class="line">u = (P_[1] + t*P_[0])/(P_[1] - t*P_[0]) % p</span><br><span class="line">v = (Q_[1] + t*Q_[0])/(Q_[1] - t*Q_[0]) % p</span><br><span class="line">print(v.log(u))</span><br><span class="line">k = 4470735776084208177429085432176719338</span><br><span class="line">for i in range(4):</span><br><span class="line">    aes = AES.new(long_to_bytes(k).ljust(16, b&#x27;\0&#x27;), AES.MODE_CBC, &#x27;\0&#x27;*16)</span><br><span class="line">    flag = b&quot;&quot;.fromhex(&quot;b3669dc657cef9dc17db4de5287cd1a1e8a48184ed9746f4c52d3b9f8186ec046d6fb1b8ed1b45111c35b546204b68e0&quot;)</span><br><span class="line">    print(len(flag))</span><br><span class="line">    plaintext = aes.decrypt(flag)</span><br><span class="line">    print(plaintext)</span><br><span class="line">    k+= (p-1) // 4</span><br></pre></td></tr></table></figure>
<h2 id="NSSRound-18-Basic-New-Year-Ring1"><a href="#NSSRound-18-Basic-New-Year-Ring1" class="headerlink" title="[NSSRound#18 Basic]New Year Ring1"></a>[NSSRound#18 Basic]New Year Ring1</h2><p>题目描述</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">from Crypto.Util.number import *</span><br><span class="line">from random import *</span><br><span class="line">from secret import flag</span><br><span class="line"></span><br><span class="line">p = getPrime(128)</span><br><span class="line">n = 64</span><br><span class="line">assert len(flag) &lt; n</span><br><span class="line"></span><br><span class="line">PRp.&lt;x&gt; = PolynomialRing(Zmod(p))</span><br><span class="line">f = x^n+2024</span><br><span class="line">PR = PRp.quo(f)</span><br><span class="line">assert f.is_irreducible()</span><br><span class="line"></span><br><span class="line">A = [randint(0, p) for i in range(n)]</span><br><span class="line">E = [randint(-4, 4) for i in range(n)]</span><br><span class="line">S = [ord(flag[i]) for i in range(len(flag))]</span><br><span class="line"></span><br><span class="line">B = PR(A)*PR(S)+PR(E)</span><br><span class="line">print(A)</span><br><span class="line">print(B.list())</span><br><span class="line">print(p)</span><br><span class="line"></span><br><span class="line">#[203211966212120647994404162543901058385, 113998159211311856163959557092243561040, 300945935078651395200612763362025786190, 289539358962072307485802285781112184506, 266860644401078099268835882620812059236, 109469988130078797414202659254940150397, 142193430695353860553837582452159920561, 163603443131512016589524436620766900399, 125570052004030843134707673404921516235, 289517595415670285587801685152176297797, 260336477592153246815046507549532230446, 89128330175853905837766718032373473126, 187717315035064338496744033397006646838, 47398231438108384695170959715078016751, 320133498675264306580441374518511607677, 289224545427213583554005441616103706530, 48124450498844786580485017131751952117, 139700877104641187048620578708689412417, 71574579434689200165233820726593943746, 138252394765364749010226318178055019086, 261521192680609185598298661488532314373, 226827408720691280529315243806063440819, 312302166514031202715929873278517388968, 41543713499646037109947736777306720313, 265649922622063773566846630839697709881, 243184423040946982395304999253912592156, 206198258022435934039803402480943364253, 26031203447491686152181680360833340987, 267200487804167757054737887061948559784, 301825292179107181769802726785989059100, 245678367957552191949253880949910260990, 171086126608355874606827637031412493750, 238890683861901290139689496391030872360, 22845910272546674819720769022817968767, 28421978727921425902205492605476665131, 171865962533483544755013698922220144571, 133361830829435140268114465077140337526, 86265129464226210912927536339928098681, 68669331909862762270788724935161403154, 201866646039120111937128925580825280486, 13363589230429215865126757180274178298, 17909430443917365585897023486940736171, 91757667623716596753047172893731203404, 46825614193892927425213536328954419018, 131552079476235333764480742173849445520, 235812708672214623030453261917981487844, 128419026868422646823814506658958018620, 165071194644940049087362229894395125949, 119007848732714973887391773573107966930, 142175857554093924103634649494868118501, 324116975329566500720942384202511507819, 145202961579339260969095793970625895397, 302068925092915352636494174062039213344, 204865812301701145536309778960425467197, 73204183646529021271666811846606597696, 305266620775559116657495389805588046145, 38573243820497560644612322159835262762, 204132117511623685134894865125985283485, 152661573492853637425833316355962196973, 234147606390346795925961511757446390699, 101214795511329059676976012743816028858, 45259554101612024332508390665659000501, 69808091348685800959727855379331581323, 96236770545429224235813571394198156104]</span><br><span class="line">#[122276244512812151700561410687880152355, 288902265068638112029210922418017307765, 227157280930411828282688954386270375417, 51392889392439935890454046852827718770, 107818090106926819686128970258855341987, 39797693303511873260100821082668360148, 165165311283389310714977999739406590465, 145742713856100761940986808065029032102, 85681122792038178595571398323505588215, 161750232371529874705027252096297284499, 65492947650590100527727115268504178500, 158980937836523416847183159463389719119, 217622237154991741032187619647917235486, 214403448117831129512734472087177528755, 7203970244866082501778704003244517036, 209327947737263058848347484690330837593, 261471938052725575109694161428073566879, 290548445194039386389333379248698464710, 786777047021934678707520080022646500, 181116047323074255804762916647191259040, 321394759425138484862188864303222149962, 172828377940330639355360387538637264455, 66514389687485973164456706712404934406, 123351805496712587796702291879739918777, 52527849016391552904401277415521541344, 269082045250550515743652451127140175208, 46611178931314336386280465499464556662, 306738233577541073584072095728624359658, 27700046031756446145225137030746217892, 90225963569273234686624144350335934112, 67692467833088163585206113599832005433, 323500338166210082579512376483956531150, 268393735497552347113220159171930201434, 303137349721700995847836323480358301717, 37409490969034515063902941681541879806, 89987553043378360059649171549894177100, 177195833588614025644477178454034861283, 186453862621405866128018280976135392700, 134539827243365382868881776050914249090, 174423939567752183215031097600196039560, 141295420547653230540490506885038874517, 71077155156144579112947495766255667953, 219294250229364145810766028169964010349, 32511078113518753980651829431342417337, 303329577727497287329206502612155346064, 90557253357868638265309134765551619996, 274174517174776162629592599514881337711, 49932861529770838835799830915660452043, 12677314962488846037929508134986771433, 234965385179859810854399287906068885976, 11962701379314564572722140202812617562, 315105728460289255044517314167781474357, 92397698128764550243762952707724608359, 79161472796010129344236399474925315198, 8230717415162461432383488082982662910, 187550346095617606538292501947907284159, 111838535125019998906719357578490542024, 127632981408215865540832181515313916183, 77787230784265032836219137545199240126, 209675082880646980235572000733260128373, 318088800052782828672155510824979199450, 197936332876846440605381880211398578620, 163607618093826671398256369217224613243, 325974106851521509536970685901401508674]</span><br><span class="line">#330464659390823375471800230370495966901</span><br></pre></td></tr></table></figure>
<p>RLWE问题，在$x^{64}+2024$上构建的环，计算$B=AS+E$，其中$S$为flag</p>
<p>多项式的度较小，只有64，则相应的格的维度约为129，可用LLL解之</p>
<p>构建卷积矩阵</p>
<script type="math/tex; mode=display">
A=\begin{pmatrix}
a_0 & a_1 & a_2 & ... & a_{64}\\
-2024*a_{64} & a_0 & a_1 & ... & a_{63}\\
\vdots & \vdots & \vdots & ... & \vdots\\
-2024*a_1 & -2024*a_2 & -2024*a_3 & ... & a_0
\end{pmatrix}</script><p>然后构建分块矩阵</p>
<script type="math/tex; mode=display">
\begin{pmatrix}
A & & \\
pI & I & \\
B & & 128
\end{pmatrix}</script><p>解题脚本</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">A=[203211966212120647994404162543901058385, 113998159211311856163959557092243561040, 300945935078651395200612763362025786190, 289539358962072307485802285781112184506, 266860644401078099268835882620812059236, 109469988130078797414202659254940150397, 142193430695353860553837582452159920561, 163603443131512016589524436620766900399, 125570052004030843134707673404921516235, 289517595415670285587801685152176297797, 260336477592153246815046507549532230446, 89128330175853905837766718032373473126, 187717315035064338496744033397006646838, 47398231438108384695170959715078016751, 320133498675264306580441374518511607677, 289224545427213583554005441616103706530, 48124450498844786580485017131751952117, 139700877104641187048620578708689412417, 71574579434689200165233820726593943746, 138252394765364749010226318178055019086, 261521192680609185598298661488532314373, 226827408720691280529315243806063440819, 312302166514031202715929873278517388968, 41543713499646037109947736777306720313, 265649922622063773566846630839697709881, 243184423040946982395304999253912592156, 206198258022435934039803402480943364253, 26031203447491686152181680360833340987, 267200487804167757054737887061948559784, 301825292179107181769802726785989059100, 245678367957552191949253880949910260990, 171086126608355874606827637031412493750, 238890683861901290139689496391030872360, 22845910272546674819720769022817968767, 28421978727921425902205492605476665131, 171865962533483544755013698922220144571, 133361830829435140268114465077140337526, 86265129464226210912927536339928098681, 68669331909862762270788724935161403154, 201866646039120111937128925580825280486, 13363589230429215865126757180274178298, 17909430443917365585897023486940736171, 91757667623716596753047172893731203404, 46825614193892927425213536328954419018, 131552079476235333764480742173849445520, 235812708672214623030453261917981487844, 128419026868422646823814506658958018620, 165071194644940049087362229894395125949, 119007848732714973887391773573107966930, 142175857554093924103634649494868118501, 324116975329566500720942384202511507819, 145202961579339260969095793970625895397, 302068925092915352636494174062039213344, 204865812301701145536309778960425467197, 73204183646529021271666811846606597696, 305266620775559116657495389805588046145, 38573243820497560644612322159835262762, 204132117511623685134894865125985283485, 152661573492853637425833316355962196973, 234147606390346795925961511757446390699, 101214795511329059676976012743816028858, 45259554101612024332508390665659000501, 69808091348685800959727855379331581323, 96236770545429224235813571394198156104]</span><br><span class="line">B=[122276244512812151700561410687880152355, 288902265068638112029210922418017307765, 227157280930411828282688954386270375417, 51392889392439935890454046852827718770, 107818090106926819686128970258855341987, 39797693303511873260100821082668360148, 165165311283389310714977999739406590465, 145742713856100761940986808065029032102, 85681122792038178595571398323505588215, 161750232371529874705027252096297284499, 65492947650590100527727115268504178500, 158980937836523416847183159463389719119, 217622237154991741032187619647917235486, 214403448117831129512734472087177528755, 7203970244866082501778704003244517036, 209327947737263058848347484690330837593, 261471938052725575109694161428073566879, 290548445194039386389333379248698464710, 786777047021934678707520080022646500, 181116047323074255804762916647191259040, 321394759425138484862188864303222149962, 172828377940330639355360387538637264455, 66514389687485973164456706712404934406, 123351805496712587796702291879739918777, 52527849016391552904401277415521541344, 269082045250550515743652451127140175208, 46611178931314336386280465499464556662, 306738233577541073584072095728624359658, 27700046031756446145225137030746217892, 90225963569273234686624144350335934112, 67692467833088163585206113599832005433, 323500338166210082579512376483956531150, 268393735497552347113220159171930201434, 303137349721700995847836323480358301717, 37409490969034515063902941681541879806, 89987553043378360059649171549894177100, 177195833588614025644477178454034861283, 186453862621405866128018280976135392700, 134539827243365382868881776050914249090, 174423939567752183215031097600196039560, 141295420547653230540490506885038874517, 71077155156144579112947495766255667953, 219294250229364145810766028169964010349, 32511078113518753980651829431342417337, 303329577727497287329206502612155346064, 90557253357868638265309134765551619996, 274174517174776162629592599514881337711, 49932861529770838835799830915660452043, 12677314962488846037929508134986771433, 234965385179859810854399287906068885976, 11962701379314564572722140202812617562, 315105728460289255044517314167781474357, 92397698128764550243762952707724608359, 79161472796010129344236399474925315198, 8230717415162461432383488082982662910, 187550346095617606538292501947907284159, 111838535125019998906719357578490542024, 127632981408215865540832181515313916183, 77787230784265032836219137545199240126, 209675082880646980235572000733260128373, 318088800052782828672155510824979199450, 197936332876846440605381880211398578620, 163607618093826671398256369217224613243, 325974106851521509536970685901401508674]</span><br><span class="line">p=330464659390823375471800230370495966901</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">n = 64</span><br><span class="line">PRp.&lt;x&gt; = PolynomialRing(Zmod(p))</span><br><span class="line">f = x^n+2024</span><br><span class="line">PR = PRp.quo(f)</span><br><span class="line">A = PR(A)</span><br><span class="line">B = PR(B)</span><br><span class="line"></span><br><span class="line">M=matrix(ZZ,n*2+1,n*2+1)</span><br><span class="line">for i in range(n):</span><br><span class="line">    for j in range(n):</span><br><span class="line">        if i&gt;j:</span><br><span class="line">            M[i,j]=-2024*A[(j-i)%64]</span><br><span class="line">        else:</span><br><span class="line">            M[i,j]=A[(j-i)%64]</span><br><span class="line">for i in range(64,128):</span><br><span class="line">    M[i,i-64]=p</span><br><span class="line">    M[i,i]=1</span><br><span class="line">for i in range(64):</span><br><span class="line">    M[-1,i]=B[i]</span><br><span class="line">    </span><br><span class="line">M[-1,-1]=128</span><br><span class="line">w=M.LLL()[0]</span><br><span class="line">v=w*M^(-1)</span><br><span class="line"></span><br><span class="line">print(v)</span><br><span class="line">flag=&#x27;&#x27;.join(chr(-i) for i in v[:64])</span><br><span class="line">print(flag)</span><br></pre></td></tr></table></figure>
<h2 id="NSSRound-18-Basic-New-Year-Ring2"><a href="#NSSRound-18-Basic-New-Year-Ring2" class="headerlink" title="[NSSRound#18 Basic]New Year Ring2"></a>[NSSRound#18 Basic]New Year Ring2</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">from Crypto.Util.number import *</span><br><span class="line">from random import *</span><br><span class="line">from secret import flag</span><br><span class="line"></span><br><span class="line">p = getPrime(128)</span><br><span class="line">n = 64</span><br><span class="line">assert len(flag) &lt; n</span><br><span class="line"></span><br><span class="line">PRp.&lt;x&gt; = PolynomialRing(Zmod(p))</span><br><span class="line">f = x^n+2*x^3+0*x^2+2*x+4  #welcome to 2024!</span><br><span class="line">PR = PRp.quo(f)</span><br><span class="line">assert f.is_irreducible()</span><br><span class="line"></span><br><span class="line">A = [randint(0, p) for i in range(n)]</span><br><span class="line">E = [randint(-4, 4) for i in range(n)]</span><br><span class="line">S = [ord(flag[i]) for i in range(len(flag))]</span><br><span class="line"></span><br><span class="line">B = PR(A)*PR(S)+PR(E)</span><br><span class="line">print(A)</span><br><span class="line">print(B.list())</span><br><span class="line">print(p)</span><br><span class="line"></span><br><span class="line">#[25628433222756085994492259068849402115, 108192689210265022288173745176216677895, 85974352459523213168503152436203993854, 41828313114844948099739205193013146660, 15961445864161535368425735570577871568, 59860624089211511801244965491114405123, 72238114736535717286419734164194491146, 1731419769773538054984020741260144321, 110926179088722293171658261432626666958, 4729059639835826882559436203284470206, 168495809056757598731123948067040373565, 3338360642630078653320363127167526308, 19389936220034072874232261675901806153, 10438117635879553768611012406691341169, 153667038046207304584441437937384897775, 72166665774655568880543097047667804863, 95319528381704092095798376951073542165, 62898039808274250589921375492358418705, 38256076367009076141369526506747299307, 116682168147974451260364221046574659055, 26917522774848180141649752130328445540, 155767907175579627310170473659502971153, 77475859845928815191730640478115081925, 70014064310214050035280946814599808820, 85993451838284022745989979544017241858, 1559588202521630621698182776746048258, 52424771201426327411234245307354332594, 92380990205273211168316314938871853614, 55868954214861940284812204603983552046, 86766496415006406161245997036503548760, 65631024912623216715877274133399692328, 165552413066518454864366169079315182837, 27090806019996818214310558040178209015, 24884235560487406082425405304334927881, 167131388381252997695719535111304864318, 84309157064049564271714180786273613498, 53226032826639984552629376026393806036, 10043888404273006035387494091731007691, 12579929759225042382751229048796566699, 166363316914893642035801926729741157934, 37839073681950914796852925854557791313, 59823734019834883911363191453005985507, 72713054697995652053446065501322532087, 7355549923971285393506940087861413681, 21734747677920938504945342916533076569, 93933129166049277428941778125233010374, 58955842096425290408052247755008181893, 35959399375270454336325579486716264076, 134512300913738209016228764504703580317, 156877088942396466398635185398252103142, 104513294126348280186621088034948750337, 58139022317938952038809444482141783106, 98565612260156356115401166878515345986, 114416081175175578305854221578018095237, 22901750234260702478992290068664968479, 156611313609023033314989985233189973832, 125083132555321363078288077242345281728, 41404163164349704408020008746598776378, 148785934103979787297708145558354509586, 60576000474984112015781658795707443603, 157378782433123699827402744836263199181, 115808625117495689666174307128964343007, 55532885470248050887252206269085843644, 167226824329071601899518640284153209079]</span><br><span class="line">#[125436276837023032466255967451858640606, 144448119937248956307846718982491347769, 162306129951573761575068204811168998078, 83181011846487027653033036479190112408, 40957533970438134530667298492545012058, 39781894692503876914564462045404705807, 164051006333092368306831348749408921012, 111012742481005666423330275146981180733, 7715720858029882578293974044643808669, 157677217515339873901600902409190036650, 47743593975916243882559558507891093023, 157986164305142738632123943371346719550, 127635891927296917312348404019956617317, 29559276398124624593609203169860820474, 65960871111768788316941346555260753893, 168042316135611110131429808009369471733, 1212659292467585393525194729053590464, 131142075720852427381782478157244639696, 102842995705164719704337121568124710266, 34358829636338044181518280022135929086, 46061675284276849395800943167734760351, 135977825342856793359560567810384022667, 79194609568617048147045548433187673199, 3676419995870098657902754244090307337, 129102404404523795672123957629514020212, 132931883751740337774987369503377603250, 157631873978881249131112881234813720862, 25064634967243118171242164160769943822, 90201135758213533081777343764941590513, 28708219563163506588485189820706388938, 56568253458138625936076514562071708932, 6347413009696777418004642228340087455, 142708918733729617152197380466325161544, 90675635242552386205397936839615479057, 92501808867676816791538575898905495372, 119574898086174634261072854178847743198, 109965735435324316785759245560872940757, 88027969746581556885954470651939385855, 134321591115155640446804238393795645472, 138737181251155600814378949277591209336, 99644145229459444132485749993357552167, 72102411291892187794699247448258325603, 83762370748394317206974170435605895442, 50088402451174667055894866569295371337, 151985189458457003469569692195947019009, 94074842589490698882361618773816024181, 73064286019059695311967281427732071049, 15926695040044471692620032927734856548, 92040182094543438421700664648795356800, 72067816134410856572981520568082148623, 51543145349488111975169803932104264498, 133476358234399233123899184886685568681, 138871089323661273034769987507240180967, 135182088478518211398715618356312799892, 142132493504501637417871042380487888261, 152821195684002682180600788766787854997, 108605984719600234041614912160255546443, 107009285527858918462712915168386920973, 142315287684855833566016316758770217595, 120564701831156855156008640956601967150, 76342952544707200039421682949094541165, 1616883292120605398623492917180224681, 114803483209077151333130433872010751344, 59602734024539592667147877839382863851]</span><br><span class="line">#p = 171384865635734387982308861436753436427</span><br></pre></td></tr></table></figure>
<p>思路与上一题差不多，只是换了多项式，稍微改一下格的构造方法即可</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">A=[25628433222756085994492259068849402115, 108192689210265022288173745176216677895, 85974352459523213168503152436203993854, 41828313114844948099739205193013146660, 15961445864161535368425735570577871568, 59860624089211511801244965491114405123, 72238114736535717286419734164194491146, 1731419769773538054984020741260144321, 110926179088722293171658261432626666958, 4729059639835826882559436203284470206, 168495809056757598731123948067040373565, 3338360642630078653320363127167526308, 19389936220034072874232261675901806153, 10438117635879553768611012406691341169, 153667038046207304584441437937384897775, 72166665774655568880543097047667804863, 95319528381704092095798376951073542165, 62898039808274250589921375492358418705, 38256076367009076141369526506747299307, 116682168147974451260364221046574659055, 26917522774848180141649752130328445540, 155767907175579627310170473659502971153, 77475859845928815191730640478115081925, 70014064310214050035280946814599808820, 85993451838284022745989979544017241858, 1559588202521630621698182776746048258, 52424771201426327411234245307354332594, 92380990205273211168316314938871853614, 55868954214861940284812204603983552046, 86766496415006406161245997036503548760, 65631024912623216715877274133399692328, 165552413066518454864366169079315182837, 27090806019996818214310558040178209015, 24884235560487406082425405304334927881, 167131388381252997695719535111304864318, 84309157064049564271714180786273613498, 53226032826639984552629376026393806036, 10043888404273006035387494091731007691, 12579929759225042382751229048796566699, 166363316914893642035801926729741157934, 37839073681950914796852925854557791313, 59823734019834883911363191453005985507, 72713054697995652053446065501322532087, 7355549923971285393506940087861413681, 21734747677920938504945342916533076569, 93933129166049277428941778125233010374, 58955842096425290408052247755008181893, 35959399375270454336325579486716264076, 134512300913738209016228764504703580317, 156877088942396466398635185398252103142, 104513294126348280186621088034948750337, 58139022317938952038809444482141783106, 98565612260156356115401166878515345986, 114416081175175578305854221578018095237, 22901750234260702478992290068664968479, 156611313609023033314989985233189973832, 125083132555321363078288077242345281728, 41404163164349704408020008746598776378, 148785934103979787297708145558354509586, 60576000474984112015781658795707443603, 157378782433123699827402744836263199181, 115808625117495689666174307128964343007, 55532885470248050887252206269085843644, 167226824329071601899518640284153209079]</span><br><span class="line">B=[125436276837023032466255967451858640606, 144448119937248956307846718982491347769, 162306129951573761575068204811168998078, 83181011846487027653033036479190112408, 40957533970438134530667298492545012058, 39781894692503876914564462045404705807, 164051006333092368306831348749408921012, 111012742481005666423330275146981180733, 7715720858029882578293974044643808669, 157677217515339873901600902409190036650, 47743593975916243882559558507891093023, 157986164305142738632123943371346719550, 127635891927296917312348404019956617317, 29559276398124624593609203169860820474, 65960871111768788316941346555260753893, 168042316135611110131429808009369471733, 1212659292467585393525194729053590464, 131142075720852427381782478157244639696, 102842995705164719704337121568124710266, 34358829636338044181518280022135929086, 46061675284276849395800943167734760351, 135977825342856793359560567810384022667, 79194609568617048147045548433187673199, 3676419995870098657902754244090307337, 129102404404523795672123957629514020212, 132931883751740337774987369503377603250, 157631873978881249131112881234813720862, 25064634967243118171242164160769943822, 90201135758213533081777343764941590513, 28708219563163506588485189820706388938, 56568253458138625936076514562071708932, 6347413009696777418004642228340087455, 142708918733729617152197380466325161544, 90675635242552386205397936839615479057, 92501808867676816791538575898905495372, 119574898086174634261072854178847743198, 109965735435324316785759245560872940757, 88027969746581556885954470651939385855, 134321591115155640446804238393795645472, 138737181251155600814378949277591209336, 99644145229459444132485749993357552167, 72102411291892187794699247448258325603, 83762370748394317206974170435605895442, 50088402451174667055894866569295371337, 151985189458457003469569692195947019009, 94074842589490698882361618773816024181, 73064286019059695311967281427732071049, 15926695040044471692620032927734856548, 92040182094543438421700664648795356800, 72067816134410856572981520568082148623, 51543145349488111975169803932104264498, 133476358234399233123899184886685568681, 138871089323661273034769987507240180967, 135182088478518211398715618356312799892, 142132493504501637417871042380487888261, 152821195684002682180600788766787854997, 108605984719600234041614912160255546443, 107009285527858918462712915168386920973, 142315287684855833566016316758770217595, 120564701831156855156008640956601967150, 76342952544707200039421682949094541165, 1616883292120605398623492917180224681, 114803483209077151333130433872010751344, 59602734024539592667147877839382863851]</span><br><span class="line">p = 171384865635734387982308861436753436427</span><br><span class="line">T=[25628433222756085994492259068849402115, 108192689210265022288173745176216677895, 85974352459523213168503152436203993854, 41828313114844948099739205193013146660, 15961445864161535368425735570577871568, 59860624089211511801244965491114405123, 72238114736535717286419734164194491146, 1731419769773538054984020741260144321, 110926179088722293171658261432626666958, 4729059639835826882559436203284470206, 168495809056757598731123948067040373565, 3338360642630078653320363127167526308, 19389936220034072874232261675901806153, 10438117635879553768611012406691341169, 153667038046207304584441437937384897775, 72166665774655568880543097047667804863, 95319528381704092095798376951073542165, 62898039808274250589921375492358418705, 38256076367009076141369526506747299307, 116682168147974451260364221046574659055, 26917522774848180141649752130328445540, 155767907175579627310170473659502971153, 77475859845928815191730640478115081925, 70014064310214050035280946814599808820, 85993451838284022745989979544017241858, 1559588202521630621698182776746048258, 52424771201426327411234245307354332594, 92380990205273211168316314938871853614, 55868954214861940284812204603983552046, 86766496415006406161245997036503548760, 65631024912623216715877274133399692328, 165552413066518454864366169079315182837, 27090806019996818214310558040178209015, 24884235560487406082425405304334927881, 167131388381252997695719535111304864318, 84309157064049564271714180786273613498, 53226032826639984552629376026393806036, 10043888404273006035387494091731007691, 12579929759225042382751229048796566699, 166363316914893642035801926729741157934, 37839073681950914796852925854557791313, 59823734019834883911363191453005985507, 72713054697995652053446065501322532087, 7355549923971285393506940087861413681, 21734747677920938504945342916533076569, 93933129166049277428941778125233010374, 58955842096425290408052247755008181893, 35959399375270454336325579486716264076, 134512300913738209016228764504703580317, 156877088942396466398635185398252103142, 104513294126348280186621088034948750337, 58139022317938952038809444482141783106, 98565612260156356115401166878515345986, 114416081175175578305854221578018095237, 22901750234260702478992290068664968479, 156611313609023033314989985233189973832, 125083132555321363078288077242345281728, 41404163164349704408020008746598776378, 148785934103979787297708145558354509586, 60576000474984112015781658795707443603, 157378782433123699827402744836263199181, 115808625117495689666174307128964343007, 55532885470248050887252206269085843644, 167226824329071601899518640284153209079]</span><br><span class="line"></span><br><span class="line">n = 64</span><br><span class="line">PRp.&lt;x&gt; = PolynomialRing(Zmod(p))</span><br><span class="line">f = x^n+2*x^3+0*x^2+2*x+4</span><br><span class="line">PR = PRp.quo(f)</span><br><span class="line">A = PR(A)</span><br><span class="line">B = PR(B)</span><br><span class="line">T = PR(T)</span><br><span class="line">M=matrix(ZZ,n*2+1,n*2+1)</span><br><span class="line">for i in range(n):</span><br><span class="line">    for j in range(n):</span><br><span class="line">        M[i,j] = T[j]</span><br><span class="line">    T = x * T</span><br><span class="line">for i in range(64,128):</span><br><span class="line">    M[i,i-64]=p</span><br><span class="line">    M[i,i]=1</span><br><span class="line">for i in range(64):</span><br><span class="line">    M[-1,i]=B[i]</span><br><span class="line">    </span><br><span class="line">M[-1,-1]=128</span><br><span class="line">w=M.LLL()[0]</span><br><span class="line">v=w*M^(-1)</span><br><span class="line"></span><br><span class="line">print(w)</span><br><span class="line">print(v)</span><br><span class="line">flag=&#x27;&#x27;.join(chr(abs(i)) for i in v[:63])</span><br><span class="line">print(flag)</span><br></pre></td></tr></table></figure>
<h2 id="NSSRound-18-Basic-New-Year-Ring3"><a href="#NSSRound-18-Basic-New-Year-Ring3" class="headerlink" title="[NSSRound#18 Basic]New Year Ring3"></a>[NSSRound#18 Basic]New Year Ring3</h2><p>题目描述</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">from Crypto.Util.number import *</span><br><span class="line">from random import *</span><br><span class="line">from secret import flag</span><br><span class="line"></span><br><span class="line">p = getPrime(128)</span><br><span class="line">n = 64</span><br><span class="line">assert len(flag) &lt; n</span><br><span class="line"></span><br><span class="line">PRp.&lt;x&gt; = PolynomialRing(Zmod(p))</span><br><span class="line">newyear = [2,0,2,4]</span><br><span class="line">f = x^n</span><br><span class="line">for i in range(n):</span><br><span class="line">    f += newyear[i%4]*x^(n-1-i)   #welcome to 2024!</span><br><span class="line">PR = PRp.quo(f)</span><br><span class="line">assert f.is_irreducible()</span><br><span class="line"></span><br><span class="line">A = [randint(0, p) for i in range(n)]</span><br><span class="line">E = [randint(-4, 4) for i in range(n)]</span><br><span class="line">S = [ord(flag[i]) for i in range(len(flag))]</span><br><span class="line"></span><br><span class="line">B = PR(A)*PR(S)+PR(E)</span><br><span class="line">print(A)</span><br><span class="line">print(B.list())</span><br><span class="line">print(p)</span><br><span class="line"></span><br><span class="line">#[143895536039223361852265879930678271849, 49941095619845369403633015749131244252, 192366807276439803341529420280624695341, 41863179329950350668896955448215016801, 161730900763954941459384930538350726304, 69486722690005239063204459423772119076, 150044605995739190031133614780160002164, 53617544566841857383903597080623109339, 74625820568619243297350181792710531670, 16380616502578067837931320551193635969, 161905270710745874415457791187229895491, 60615195134615631027916010677640865675, 160490605829184543601552626825699212302, 67566984475203250552779752218068594160, 213285653211278131505736720165333128065, 64852378214458505102852766762259296220, 127863063181868054387649888847647635563, 173388212610482051840613449798996257379, 107853129453974811439304180468226801619, 47026991726695830686352132714620786077, 54537407094343620242102574881749270054, 213117990243770129927508589374671252215, 188551573436848023902527678127834115095, 184904756222053551643771035280489901913, 130154717708566694574065576508622379407, 169935928816833755787895658897579592244, 25127997681478110567876718932464424139, 66241086523494222064942298262635441275, 128384348198631966247204855175670185827, 186534789734452323940160584274797242101, 44113757786219743282268996106377142498, 161464089943212437590741012855856579087, 152978274982120638112396394811148002893, 127858672640521604574047701048286112335, 24811959746896810879635351294335540800, 139884017165706571446169150175115903276, 162069295856137595644855638161429085830, 103852979898094376585707063387003994190, 209853862047034349714977775246731397993, 83875540721706520814802129116239183141, 229717680288888669127660062951596981300, 142905448436402318840598200380283379791, 97701946983539136207969604175005004177, 132882918810599573425074347748636321411, 30946979906897798248175975370883897061, 227445609344085479411697428271056340360, 226861499760726945354933277553812121082, 34610454530275079356327169999644151033, 86543487884993671802260662621113434518, 193748181739943346975874601639150010426, 34955296746796322689176100212054938608, 78982586205793555689802056285642735691, 3417188406740628320649576312400181913, 165141388407797054166867506278447838336, 12695265941766745754277957144871301850, 89458008041873757788350494973818918496, 17544328835809254417440184162473311528, 17809092337865928270441021151091911120, 190539046594231331045902135957952644092, 54013202950149354717829653296038417693, 182140149560821210676566057705914354798, 182590162902622112992977612842205026523, 226186981126958513892204825722664037031, 96763448317215723992226901770790799160]</span><br><span class="line">#[146131953632371057251386640770029761962, 155126848145561802955686124994407020596, 215548579819339372855889610814620506576, 215378077144333849353671692326217769974, 211651696346814349480371028078398365850, 56211588439881618182356345926007014351, 35792916285189253601060073066755768657, 193834084101163540069238791365615525212, 64185605303590514314207911465024315433, 74011476974910970618385371699236712496, 144080173424901828501825948809304329878, 50478515840382641218068722055014699097, 61424373096897526822902957616641049161, 228135094283701120116040034916450645966, 173676278129085855942014338366292660640, 4958486587405211188374567586180119556, 107653280004443417845206647750419894242, 227948848364624440330554299487592496262, 103344313582462128597769184556262118266, 179090340541635393147453223953633783366, 91157025540035569434535505051126504071, 218301646561306199078249711983197566905, 207984369886452772406666980534904709935, 84848453635637121750244379243550315275, 70455676155616420940430093468129934421, 112082679346753821742720835769195197209, 100096437088582331947465760446007491622, 23148318752965414660522976895342715316, 175024877143863308838121164427112023613, 65455761812920253083377790817920776573, 80719540338474829645398437070034720831, 30265965699771257065456865006701716765, 65059939935789446486144438246062876092, 73412866905686210879034022846184532326, 15496701729614207294798217895713334887, 187927627267834618400725936475600101114, 51596647781094949272750319452641626273, 34936140628305933632043160171328035222, 227636764157434931002269545814362460674, 40310006070105509297521946935690917605, 158199753843142436703851148792841271128, 62042757128547429572711130709028563495, 4994577444829057554913018889328955170, 212120189443587994433256482180523602261, 217895194863190305322702282626368171628, 14347476896110839167629995111874858945, 92969919157086783529099464146480743366, 98421412347381684974090776331896675353, 7670925013164447091797082877392123056, 92948133844692458289793766569490521009, 37843417064278243200690200946062028300, 73246898716604229152337274167003969610, 48576361100747286180365305580004800549, 226777738621945748117749363525255463543, 202653365491161565340111352416610858743, 81343653066789166205981715378171248137, 43128791749740623981661146675626160300, 51978531727836859802588862475571492852, 158673579466427370117557321982403789903, 154526278040551924441198621574328917110, 23520842615720508371775640194790884675, 76597771060168857457987619277375824543, 229138699410621489832761240581614631878, 62849396773221525801893336014307910648]</span><br><span class="line">#229934842599910967421870245339955481121</span><br></pre></td></tr></table></figure>
<p>与上一道的Ring2相同，只是换了多项式而已，那么用同样的脚本解即可</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">A=[143895536039223361852265879930678271849, 49941095619845369403633015749131244252, 192366807276439803341529420280624695341, 41863179329950350668896955448215016801, 161730900763954941459384930538350726304, 69486722690005239063204459423772119076, 150044605995739190031133614780160002164, 53617544566841857383903597080623109339, 74625820568619243297350181792710531670, 16380616502578067837931320551193635969, 161905270710745874415457791187229895491, 60615195134615631027916010677640865675, 160490605829184543601552626825699212302, 67566984475203250552779752218068594160, 213285653211278131505736720165333128065, 64852378214458505102852766762259296220, 127863063181868054387649888847647635563, 173388212610482051840613449798996257379, 107853129453974811439304180468226801619, 47026991726695830686352132714620786077, 54537407094343620242102574881749270054, 213117990243770129927508589374671252215, 188551573436848023902527678127834115095, 184904756222053551643771035280489901913, 130154717708566694574065576508622379407, 169935928816833755787895658897579592244, 25127997681478110567876718932464424139, 66241086523494222064942298262635441275, 128384348198631966247204855175670185827, 186534789734452323940160584274797242101, 44113757786219743282268996106377142498, 161464089943212437590741012855856579087, 152978274982120638112396394811148002893, 127858672640521604574047701048286112335, 24811959746896810879635351294335540800, 139884017165706571446169150175115903276, 162069295856137595644855638161429085830, 103852979898094376585707063387003994190, 209853862047034349714977775246731397993, 83875540721706520814802129116239183141, 229717680288888669127660062951596981300, 142905448436402318840598200380283379791, 97701946983539136207969604175005004177, 132882918810599573425074347748636321411, 30946979906897798248175975370883897061, 227445609344085479411697428271056340360, 226861499760726945354933277553812121082, 34610454530275079356327169999644151033, 86543487884993671802260662621113434518, 193748181739943346975874601639150010426, 34955296746796322689176100212054938608, 78982586205793555689802056285642735691, 3417188406740628320649576312400181913, 165141388407797054166867506278447838336, 12695265941766745754277957144871301850, 89458008041873757788350494973818918496, 17544328835809254417440184162473311528, 17809092337865928270441021151091911120, 190539046594231331045902135957952644092, 54013202950149354717829653296038417693, 182140149560821210676566057705914354798, 182590162902622112992977612842205026523, 226186981126958513892204825722664037031, 96763448317215723992226901770790799160]</span><br><span class="line">B=[146131953632371057251386640770029761962, 155126848145561802955686124994407020596, 215548579819339372855889610814620506576, 215378077144333849353671692326217769974, 211651696346814349480371028078398365850, 56211588439881618182356345926007014351, 35792916285189253601060073066755768657, 193834084101163540069238791365615525212, 64185605303590514314207911465024315433, 74011476974910970618385371699236712496, 144080173424901828501825948809304329878, 50478515840382641218068722055014699097, 61424373096897526822902957616641049161, 228135094283701120116040034916450645966, 173676278129085855942014338366292660640, 4958486587405211188374567586180119556, 107653280004443417845206647750419894242, 227948848364624440330554299487592496262, 103344313582462128597769184556262118266, 179090340541635393147453223953633783366, 91157025540035569434535505051126504071, 218301646561306199078249711983197566905, 207984369886452772406666980534904709935, 84848453635637121750244379243550315275, 70455676155616420940430093468129934421, 112082679346753821742720835769195197209, 100096437088582331947465760446007491622, 23148318752965414660522976895342715316, 175024877143863308838121164427112023613, 65455761812920253083377790817920776573, 80719540338474829645398437070034720831, 30265965699771257065456865006701716765, 65059939935789446486144438246062876092, 73412866905686210879034022846184532326, 15496701729614207294798217895713334887, 187927627267834618400725936475600101114, 51596647781094949272750319452641626273, 34936140628305933632043160171328035222, 227636764157434931002269545814362460674, 40310006070105509297521946935690917605, 158199753843142436703851148792841271128, 62042757128547429572711130709028563495, 4994577444829057554913018889328955170, 212120189443587994433256482180523602261, 217895194863190305322702282626368171628, 14347476896110839167629995111874858945, 92969919157086783529099464146480743366, 98421412347381684974090776331896675353, 7670925013164447091797082877392123056, 92948133844692458289793766569490521009, 37843417064278243200690200946062028300, 73246898716604229152337274167003969610, 48576361100747286180365305580004800549, 226777738621945748117749363525255463543, 202653365491161565340111352416610858743, 81343653066789166205981715378171248137, 43128791749740623981661146675626160300, 51978531727836859802588862475571492852, 158673579466427370117557321982403789903, 154526278040551924441198621574328917110, 23520842615720508371775640194790884675, 76597771060168857457987619277375824543, 229138699410621489832761240581614631878, 62849396773221525801893336014307910648]</span><br><span class="line">p=229934842599910967421870245339955481121</span><br><span class="line">n = 64</span><br><span class="line">T=A</span><br><span class="line">PRp.&lt;x&gt; = PolynomialRing(Zmod(p))</span><br><span class="line">newyear = [2,0,2,4]</span><br><span class="line">f = x^n</span><br><span class="line">for i in range(n):</span><br><span class="line">    f += newyear[i%4]*x^(n-1-i)   #welcome to 2024!</span><br><span class="line">PR = PRp.quo(f)</span><br><span class="line">A = PR(A)</span><br><span class="line">B = PR(B)</span><br><span class="line">T = PR(T)</span><br><span class="line">M=matrix(ZZ,n*2+1,n*2+1)</span><br><span class="line">for i in range(n):</span><br><span class="line">    for j in range(n):</span><br><span class="line">        M[i,j] = T[j]</span><br><span class="line">    T = x * T</span><br><span class="line">for i in range(64,128):</span><br><span class="line">    M[i,i-64]=p</span><br><span class="line">    M[i,i]=1</span><br><span class="line">for i in range(64):</span><br><span class="line">    M[-1,i]=B[i]</span><br><span class="line">    </span><br><span class="line">M[-1,-1]=128</span><br><span class="line">w=M.LLL()[0]</span><br><span class="line">v=w*M^(-1)</span><br><span class="line"></span><br><span class="line">print(w)</span><br><span class="line">print(v)</span><br><span class="line">flag=&#x27;&#x27;.join(chr(abs(i)) for i in v[:64])</span><br><span class="line">print(flag)</span><br></pre></td></tr></table></figure>
<h2 id="WMCTF-ezRSA"><a href="#WMCTF-ezRSA" class="headerlink" title="WMCTF ezRSA"></a>WMCTF ezRSA</h2><p>题目描述</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">from Crypto.Util.number import getStrongPrime, getRandomNBitInteger, GCD, inverse, long_to_bytes, bytes_to_long</span><br><span class="line">from flag import flag</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def gen_parameters(bits_leak, beta):</span><br><span class="line">    p = getStrongPrime(1024)</span><br><span class="line">    q = getStrongPrime(1024)</span><br><span class="line">    N = p*q</span><br><span class="line">    phi = (p-1)*(q-1)</span><br><span class="line"></span><br><span class="line">    while True:</span><br><span class="line">        d = getRandomNBitInteger(int(2048*beta))</span><br><span class="line">        if GCD(d, phi) == 1:</span><br><span class="line">            break</span><br><span class="line">    e = inverse(d, phi)</span><br><span class="line"></span><br><span class="line">    gift1 = d &amp; ((1&lt;&lt;bits_leak) - 1)</span><br><span class="line">    gift2 = phi &amp; ((1&lt;&lt;bits_leak) - 1)</span><br><span class="line">    print(f&#x27;e=&#123;hex(e)&#125;&#x27;)</span><br><span class="line">    print(f&#x27;N=&#123;hex(N)&#125;\n&#x27;)</span><br><span class="line">    print(f&#x27;gift1=&#123;hex(gift1)&#125;&#x27;)</span><br><span class="line">    print(f&#x27;gift2=&#123;hex(gift2)&#125;&#x27;)</span><br><span class="line">    return e, d, N, gift1, gift2, p, q</span><br><span class="line"></span><br><span class="line">def main():</span><br><span class="line">    e, d, N, _, _, _, _ = gen_parameters(bits_leak=450, beta=0.47)</span><br><span class="line">    </span><br><span class="line">    flag_head = b&#x27;NepCTF&#123;&#x27;</span><br><span class="line">    assert flag.startswith(flag_head)</span><br><span class="line">    pt = bytes_to_long(flag[len(flag_head):-1])</span><br><span class="line">    ct = pow(pt, e, N)</span><br><span class="line">    print(f&#x27;ct=&#123;hex(ct)&#125;&#x27;)</span><br><span class="line"></span><br><span class="line">main()</span><br><span class="line"></span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">e=0xa14e64d0948eaa7df3eb514802e74ff6070d3ea7f16f712646ff794f2b50aa787e4b829ce09dee1d3e1add7c55d870b931b415b1e282259af005c46ce1bc38388fa530d3931b8b8d7a163fb4ca4252e4b77625e80354b8fb3fce7455dac4bdcbe04dfe743d3f628ad1093ecf22f97fa17eb67445f5edc507eb368b364bc9d77da6fcfce7896ef3259fc7a4e66835f99c3c10ca6e6013dd8f01036b26b08dd5ddfddba35e3037c7a4187edd3323685d888ff3b99edf1caf8b93b4a851dc2af95a216b313192b368c1ed77f2a4ac6ddb2c46383806659d7037c25533c0bf5e4f1f665f2bd5529ebbadba40b07ea9b4dee91f42e0ac69bcbe28573e8c4f5744847</span><br><span class="line">N=0xbb4efd151c65add72c7ff259687c11ee9d2d82d4058485d2a8abf80839f9da4d2bb1191b97b05d4a581f28e62f91784a2da912f98c2ef95273b311fc8c5dd4c468d82dee499874a88dda554aedc1d417dcacfc9bd787854db7a70575abb48e7c20d2662a2484391518357af55c18eb424687c2990ca10e89efcf019ff945705851bcc58673c2534c592a461bffbfc5369aeb31bc28998dfcaa0e7b3ab044005376fba8364151933ce73a12a4c3b7df7902cb462a95fc2e6d9596f3bebd712da63329bb4d45f1274852e81f04764fa610f5a86424e6026b10fc41c079d2649699be28716aa2da8c6e36276ea4f80eb3b2b4d921bd829046b5b6bd62e401116b47</span><br><span class="line">gift1=0x265e264a10862ccc5ede757362bc872ab562d201ddda1a4bec70cbe6becd71a411b1fc0bbc627f32fa0ee2ea0ceb91712d5c5187d8a2b0cb7</span><br><span class="line">gift2=0x2a1d29d36d731c528cc0cdd27e8b60a0596de783b591f85fb3f8c78bbe28e7d7d9710b41778789ad0dca7088e244c1df4aaf4d27a2afec428</span><br><span class="line"></span><br><span class="line">ct=0x71ac11e0b2bf7fca3e0ba051f74c90c4615ffca644fb69e7ed6c4dc1432d76049ad70ff1a9c3117c7d7db0c4fdc35518ef72068b2edb82dfeb9f7858376d4354633c63414b30584e28a70d90d5c5894d61a4e677721684e51ea52ac5747e33aa467f6a4e3e856f6ef08834d3fc70fec2d7229d14ccb761675be67ec87614b3e24f9c0d07463d2c636186d6ff7514a681ade1e5901afead97c6fa3df938cee004bef836cf32b07a33edfdc4268847e69d0cbc4b1b316ffdcf0e11cc03e03090e43789ae414f07be7d23be02f28f2bc507c72054bba6341265c64e52c038633023ff4b13e8d863816a29114a0773b62568912b4d22a8162ab0d7bf2bb8af265e21</span><br><span class="line">&quot;&quot;&quot;</span><br></pre></td></tr></table></figure>
<h2 id="CTFZone-2024-Shes-the-Real-one"><a href="#CTFZone-2024-Shes-the-Real-one" class="headerlink" title="[CTFZone 2024]Shes the Real one"></a>[CTFZone 2024]Shes the Real one</h2><p>题目描述</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">from functools import namedtuple</span><br><span class="line"></span><br><span class="line">from secret import flag</span><br><span class="line"></span><br><span class="line">assert len(flag) == 33</span><br><span class="line"></span><br><span class="line">Point = namedtuple(&quot;Point&quot;, [&quot;x&quot;, &quot;y&quot;])</span><br><span class="line">R = RealField(prec=800)</span><br><span class="line">inf = Point(R(0), R(1))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def lift_x(x):</span><br><span class="line">    return Point(x, sqrt(x**3 - R(3) * x - R(2)))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def add(P, Q):</span><br><span class="line">    if P.x == Q.x and P.y != Q.y:</span><br><span class="line">        return inf</span><br><span class="line">    elif P.y == Q.y:</span><br><span class="line">        raise ValueError(&quot;Points have to differ!&quot;)</span><br><span class="line">    elif P == inf:</span><br><span class="line">        return Q</span><br><span class="line">    elif Q == inf:</span><br><span class="line">        return P</span><br><span class="line"></span><br><span class="line">    lambda_ = (P.y - Q.y) / (P.x - Q.x)</span><br><span class="line"></span><br><span class="line">    xr = lambda_**2 - P.x - Q.x</span><br><span class="line">    yr = lambda_ * (Q.x - xr) - Q.y</span><br><span class="line">    return Point(xr, yr)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def double(P):</span><br><span class="line">    if P == inf:</span><br><span class="line">        return P</span><br><span class="line"></span><br><span class="line">    lambda_ = (R(3) * P.x**2 - R(3)) / (R(2) * P.y)</span><br><span class="line"></span><br><span class="line">    xr = lambda_**2 - 2 * P.x</span><br><span class="line">    yr = lambda_ * (P.x - xr) - P.y</span><br><span class="line">    return Point(xr, yr)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def multiply_by_scalar(P, n: int):</span><br><span class="line">    if n == 0 or P == inf:</span><br><span class="line">        return inf</span><br><span class="line">    elif n &lt; 0:</span><br><span class="line">        return multiply_by_scalar(Point(-P.x, P.y), -n)</span><br><span class="line"></span><br><span class="line">    R0, R1 = P, double(P)</span><br><span class="line">    for b in bin(n)[3:]:</span><br><span class="line">        if b == &quot;0&quot;:</span><br><span class="line">            R0, R1 = double(R0), add(R0, R1)</span><br><span class="line">        else:</span><br><span class="line">            R0, R1 = add(R0, R1), double(R1)</span><br><span class="line">    return R0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">P = lift_x(R(5.0) + R.random_element())</span><br><span class="line">s = int.from_bytes(flag, &#x27;big&#x27;)</span><br><span class="line">Q = multiply_by_scalar(P, s)</span><br><span class="line">with open(&quot;output.dump&quot;, &#x27;wb&#x27;) as f:</span><br><span class="line">    f.write(dumps([P, Q]))</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>描述了实数域上的曲线$y^2=x^3-3x-2$，注意到$\Delta=-16(4a^3+27b^2)=0$</p>
<p>如果一个椭圆曲线后面的多项式存在重根则可以攻击。$y^2=x^3$ 的形式是最简单的，$y^2=x^2(x+a)$ 也是可以破解的。具体来说，对于前者，可以通过映射 $E(x,y)→\frac xy,∞→0$ 得到一个加法群，然后椭圆曲线离散对数问题就非常容易解决了（就是一个除法）。对于后者，可以通过映射 $E(x,y)→\frac {x+\sqrt ay}{x−\sqrt ay},∞→1 $得到一个乘法群，然后椭圆曲线离散对数问题就变成了一个普通的离散对数问题，相对来说要容易解决一些。</p>
<p>通过以下脚本将两个点映射到复数域上</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">sage: <span class="function"><span class="keyword">def</span> <span class="title">convert</span>(<span class="params">a2, a4, a6, Gx, Gy, Px, Py</span>):</span></span><br><span class="line">....:     x = R[<span class="string">&quot;x&quot;</span>].gen()</span><br><span class="line">....:     f = x ** <span class="number">3</span> + a2 * x ** <span class="number">2</span> + a4 * x + a6</span><br><span class="line">....:     roots = f.roots()</span><br><span class="line">....: </span><br><span class="line">....:     <span class="comment"># Singular point is a cusp.</span></span><br><span class="line">....:     <span class="keyword">if</span> <span class="built_in">len</span>(roots) == <span class="number">1</span>:</span><br><span class="line">....:         alpha = roots[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line">....:         u = (Gx - alpha) / Gy</span><br><span class="line">....:         v = (Px - alpha) / Py</span><br><span class="line">....:         <span class="keyword">return</span> <span class="built_in">int</span>(v / u)</span><br><span class="line">....: </span><br><span class="line">....:     <span class="comment"># Singular point is a node.</span></span><br><span class="line">....:     <span class="keyword">if</span> <span class="built_in">len</span>(roots) == <span class="number">2</span>:</span><br><span class="line">....:         <span class="keyword">if</span> roots[<span class="number">0</span>][<span class="number">1</span>] == <span class="number">2</span>:</span><br><span class="line">....:             alpha = roots[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line">....:             beta = roots[<span class="number">1</span>][<span class="number">0</span>]</span><br><span class="line">....:         <span class="keyword">elif</span> roots[<span class="number">1</span>][<span class="number">1</span>] == <span class="number">2</span>:</span><br><span class="line">....:             alpha = roots[<span class="number">1</span>][<span class="number">0</span>]</span><br><span class="line">....:             beta = roots[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line">....:         <span class="keyword">else</span>:</span><br><span class="line">....:             <span class="keyword">raise</span> ValueError(<span class="string">&quot;Expected root with multiplicity 2.&quot;</span>)</span><br><span class="line">....: </span><br><span class="line">....:         t = (alpha - beta).sqrt()</span><br><span class="line">....:         u = (Gy + t * (Gx - alpha)) / (Gy - t * (Gx - alpha))</span><br><span class="line">....:         v = (Py + t * (Px - alpha)) / (Py - t * (Px - alpha))</span><br><span class="line">....:         <span class="comment">#print(f&quot;&#123;u= &#125;&quot;)</span></span><br><span class="line">....:         <span class="comment">#print(f&quot;&#123;v = &#125;&quot;)</span></span><br><span class="line">....:         <span class="keyword">return</span> u, v</span><br><span class="line">....: </span><br><span class="line">sage: Point = namedtuple(<span class="string">&quot;Point&quot;</span>, [<span class="string">&quot;x&quot;</span>, <span class="string">&quot;y&quot;</span>])</span><br><span class="line">....: R = RealField(prec=<span class="number">800</span>)</span><br><span class="line">....: inf = Point(R(<span class="number">0</span>), R(<span class="number">1</span>))</span><br><span class="line">sage: P, Q = loads(<span class="built_in">open</span>(<span class="string">&quot;output.dump&quot;</span>, <span class="string">&quot;rb&quot;</span>).read())</span><br><span class="line">sage: u, v = convert(<span class="number">0</span>, -<span class="number">3</span>, -<span class="number">2</span>, P.x, P.y, Q.x, Q.y)</span><br><span class="line">sage: u, v</span><br><span class="line">(-<span class="number">0.0255408859554811738798041002165322931079942421023925984456108883926698635790160301023957268132468588844442587625949443627843717558842132804252110981655810107582508423839253193843193430437616212740859528940078530327120403783075376942554672383</span> + <span class="number">0.999673778362026011045642698149942821234299157834807848290934968114452835874641498749615568668413323504604479874008017320163141381303262476934628184678853707459466272729242179963292727643184096804965784876572551930340983845195909603003611083</span>*I,</span><br><span class="line"> <span class="number">0.616102493558778718889121697959960828359310758354780522858233409838803408207266567874733084017785852701944769007794275457796861891302495500551050030643665165153695292761613720866701849968732429743187383424132585465710709515167367011982608081</span> - <span class="number">0.787665993572564377470888374116309095706826262285644512113154045150748557206663706545942833730723205261253089081559068120018585286881818605664252444987049692223949452578002134090936176300260555751352465814226213709696901021366756511208028056</span>*I)</span><br></pre></td></tr></table></figure>
<p>可以发现$|u|=|v|=1$</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sage: u.abs()</span><br><span class="line">1.00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000</span><br><span class="line">sage: v.abs()</span><br><span class="line">1.00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000</span><br></pre></td></tr></table></figure>
<p>因此存在$\theta,\omega\in[-\pi,\pi]$</p>
<script type="math/tex; mode=display">
u = \cos(\theta) + i \sin(\theta), \qquad v = \cos(\omega) + i\sin(\omega)</script><p>进一步转化有</p>
<script type="math/tex; mode=display">
v = u^s = (\cos(\theta) + i \sin(\theta))^s = \cos(s\theta) + i \sin(s\theta)</script><p>由于cos和sin的周期均为2pi，$\exist k\in Z$，有</p>
<script type="math/tex; mode=display">
s\theta=\omega +2\pi k</script><p>令A为$s$的上限，有</p>
<script type="math/tex; mode=display">
\begin{pmatrix}s & -k & -1\end{pmatrix}\begin{pmatrix}A\theta & 1 & 0 \\ 2\pi A & 0 & 0 \\ A\omega & 0 & A\end{pmatrix} = \begin{pmatrix}0 & s & -A\end{pmatrix}</script><p>最终解题脚本</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">from sage.all import *</span><br><span class="line">from Crypto.Util.number import long_to_bytes</span><br><span class="line">from functools import namedtuple</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def genM(A=2**1000):</span><br><span class="line">    M = Matrix(QQ, [A*theta, 1, 0])</span><br><span class="line">    M = M.stack(vector([R(A*2*pi), 0, 0]))</span><br><span class="line">    M = M.stack(vector([A*w, 0, A]))</span><br><span class="line">    return Matrix(QQ, M)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def convert(a2, a4, a6, Gx, Gy, Px, Py):</span><br><span class="line">    x = R[&quot;x&quot;].gen()</span><br><span class="line">    f = x ** 3 + a2 * x ** 2 + a4 * x + a6</span><br><span class="line">    roots = f.roots()</span><br><span class="line"></span><br><span class="line">    # Singular point is a cusp.</span><br><span class="line">    if len(roots) == 1:</span><br><span class="line">        alpha = roots[0][0]</span><br><span class="line">        u = (Gx - alpha) / Gy</span><br><span class="line">        v = (Px - alpha) / Py</span><br><span class="line">        return int(v / u)</span><br><span class="line"></span><br><span class="line">    # Singular point is a node.</span><br><span class="line">    if len(roots) == 2:</span><br><span class="line">        if roots[0][1] == 2:</span><br><span class="line">            alpha = roots[0][0]</span><br><span class="line">            beta = roots[1][0]</span><br><span class="line">        elif roots[1][1] == 2:</span><br><span class="line">            alpha = roots[1][0]</span><br><span class="line">            beta = roots[0][0]</span><br><span class="line">        else:</span><br><span class="line">            raise ValueError(&quot;Expected root with multiplicity 2.&quot;)</span><br><span class="line"></span><br><span class="line">        t = (alpha - beta).sqrt()</span><br><span class="line">        u = (Gy + t * (Gx - alpha)) / (Gy - t * (Gx - alpha))</span><br><span class="line">        v = (Py + t * (Px - alpha)) / (Py - t * (Px - alpha))</span><br><span class="line">        #print(f&quot;&#123;u= &#125;&quot;)</span><br><span class="line">        #print(f&quot;&#123;v = &#125;&quot;)</span><br><span class="line">        return u, v</span><br><span class="line"></span><br><span class="line">    raise ValueError(f&quot;Unexpected number of roots &#123;len(roots)&#125;.&quot;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Point = namedtuple(&quot;Point&quot;, [&quot;x&quot;, &quot;y&quot;])</span><br><span class="line">R = RealField(prec=800)</span><br><span class="line">P, Q = loads(open(&quot;output.dump&quot;, &quot;rb&quot;).read())</span><br><span class="line">u, v = convert(0, -3, -2, P.x, P.y, Q.x, Q.y)</span><br><span class="line"></span><br><span class="line">theta = u.argument()</span><br><span class="line">w = v.argument()</span><br><span class="line"></span><br><span class="line">M = genM()</span><br><span class="line">L = M.LLL()</span><br><span class="line"></span><br><span class="line">print(long_to_bytes(abs(int(L[-1][1]))))</span><br></pre></td></tr></table></figure>
<h2 id="nepctf-2024-ezRSA"><a href="#nepctf-2024-ezRSA" class="headerlink" title="[nepctf 2024] ezRSA"></a>[nepctf 2024] ezRSA</h2><p>题目描述</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">from Crypto.Util.number import getStrongPrime, getRandomNBitInteger, GCD, inverse, long_to_bytes, bytes_to_long</span><br><span class="line">from flag import flag</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def gen_parameters(bits_leak, beta):</span><br><span class="line">    p = getStrongPrime(1024)</span><br><span class="line">    q = getStrongPrime(1024)</span><br><span class="line">    N = p*q</span><br><span class="line">    phi = (p-1)*(q-1)</span><br><span class="line"></span><br><span class="line">    while True:</span><br><span class="line">        d = getRandomNBitInteger(int(2048*beta))</span><br><span class="line">        if GCD(d, phi) == 1:</span><br><span class="line">            break</span><br><span class="line">    e = inverse(d, phi)</span><br><span class="line"></span><br><span class="line">    gift1 = d &amp; ((1&lt;&lt;bits_leak) - 1)</span><br><span class="line">    gift2 = phi &amp; ((1&lt;&lt;bits_leak) - 1)</span><br><span class="line">    print(f&#x27;e=&#123;hex(e)&#125;&#x27;)</span><br><span class="line">    print(f&#x27;N=&#123;hex(N)&#125;\n&#x27;)</span><br><span class="line">    print(f&#x27;gift1=&#123;hex(gift1)&#125;&#x27;)</span><br><span class="line">    print(f&#x27;gift2=&#123;hex(gift2)&#125;&#x27;)</span><br><span class="line">    return e, d, N, gift1, gift2, p, q</span><br><span class="line"></span><br><span class="line">def main():</span><br><span class="line">    e, d, N, _, _, _, _ = gen_parameters(bits_leak=450, beta=0.47)</span><br><span class="line">    </span><br><span class="line">    flag_head = b&#x27;NepCTF&#123;&#x27;</span><br><span class="line">    assert flag.startswith(flag_head)</span><br><span class="line">    pt = bytes_to_long(flag[len(flag_head):-1])</span><br><span class="line">    ct = pow(pt, e, N)</span><br><span class="line">    print(f&#x27;ct=&#123;hex(ct)&#125;&#x27;)</span><br><span class="line"></span><br><span class="line">main()</span><br><span class="line"></span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">e=0xa14e64d0948eaa7df3eb514802e74ff6070d3ea7f16f712646ff794f2b50aa787e4b829ce09dee1d3e1add7c55d870b931b415b1e282259af005c46ce1bc38388fa530d3931b8b8d7a163fb4ca4252e4b77625e80354b8fb3fce7455dac4bdcbe04dfe743d3f628ad1093ecf22f97fa17eb67445f5edc507eb368b364bc9d77da6fcfce7896ef3259fc7a4e66835f99c3c10ca6e6013dd8f01036b26b08dd5ddfddba35e3037c7a4187edd3323685d888ff3b99edf1caf8b93b4a851dc2af95a216b313192b368c1ed77f2a4ac6ddb2c46383806659d7037c25533c0bf5e4f1f665f2bd5529ebbadba40b07ea9b4dee91f42e0ac69bcbe28573e8c4f5744847</span><br><span class="line">N=0xbb4efd151c65add72c7ff259687c11ee9d2d82d4058485d2a8abf80839f9da4d2bb1191b97b05d4a581f28e62f91784a2da912f98c2ef95273b311fc8c5dd4c468d82dee499874a88dda554aedc1d417dcacfc9bd787854db7a70575abb48e7c20d2662a2484391518357af55c18eb424687c2990ca10e89efcf019ff945705851bcc58673c2534c592a461bffbfc5369aeb31bc28998dfcaa0e7b3ab044005376fba8364151933ce73a12a4c3b7df7902cb462a95fc2e6d9596f3bebd712da63329bb4d45f1274852e81f04764fa610f5a86424e6026b10fc41c079d2649699be28716aa2da8c6e36276ea4f80eb3b2b4d921bd829046b5b6bd62e401116b47</span><br><span class="line">gift1=0x265e264a10862ccc5ede757362bc872ab562d201ddda1a4bec70cbe6becd71a411b1fc0bbc627f32fa0ee2ea0ceb91712d5c5187d8a2b0cb7</span><br><span class="line">gift2=0x2a1d29d36d731c528cc0cdd27e8b60a0596de783b591f85fb3f8c78bbe28e7d7d9710b41778789ad0dca7088e244c1df4aaf4d27a2afec428</span><br><span class="line"></span><br><span class="line">ct=0x71ac11e0b2bf7fca3e0ba051f74c90c4615ffca644fb69e7ed6c4dc1432d76049ad70ff1a9c3117c7d7db0c4fdc35518ef72068b2edb82dfeb9f7858376d4354633c63414b30584e28a70d90d5c5894d61a4e677721684e51ea52ac5747e33aa467f6a4e3e856f6ef08834d3fc70fec2d7229d14ccb761675be67ec87614b3e24f9c0d07463d2c636186d6ff7514a681ade1e5901afead97c6fa3df938cee004bef836cf32b07a33edfdc4268847e69d0cbc4b1b316ffdcf0e11cc03e03090e43789ae414f07be7d23be02f28f2bc507c72054bba6341265c64e52c038633023ff4b13e8d863816a29114a0773b62568912b4d22a8162ab0d7bf2bb8af265e21</span><br><span class="line">&quot;&quot;&quot;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line">from sage.all import *</span><br><span class="line">import itertools</span><br><span class="line">import gmpy2</span><br><span class="line">from Crypto.Util.number import *</span><br><span class="line">def small_roots(f, bounds, m=1, d=None):</span><br><span class="line">	if not d:</span><br><span class="line">		d = f.degree()</span><br><span class="line"></span><br><span class="line">	R = f.base_ring()</span><br><span class="line">	N = R.cardinality()</span><br><span class="line">	</span><br><span class="line">	f /= f.coefficients().pop(0)</span><br><span class="line">	f = f.change_ring(ZZ)</span><br><span class="line"></span><br><span class="line">	G = Sequence([], f.parent())</span><br><span class="line">	for i in range(m+1):</span><br><span class="line">		base = N^(m-i) * f^i</span><br><span class="line">		for shifts in itertools.product(range(d), repeat=f.nvariables()):</span><br><span class="line">			g = base * prod(map(power, f.variables(), shifts))</span><br><span class="line">			G.append(g)</span><br><span class="line"></span><br><span class="line">	B, monomials = G.coefficients_monomials()</span><br><span class="line">	monomials = vector(monomials)</span><br><span class="line"></span><br><span class="line">	factors = [monomial(*bounds) for monomial in monomials]</span><br><span class="line">	for i, factor in enumerate(factors):</span><br><span class="line">		B.rescale_col(i, factor)</span><br><span class="line"></span><br><span class="line">	B = B.dense_matrix().LLL()</span><br><span class="line"></span><br><span class="line">	B = B.change_ring(QQ)</span><br><span class="line">	for i, factor in enumerate(factors):</span><br><span class="line">		B.rescale_col(i, 1/factor)</span><br><span class="line"></span><br><span class="line">	H = Sequence([], f.parent().change_ring(QQ))</span><br><span class="line">	for h in filter(None, B*monomials):</span><br><span class="line">		H.append(h)</span><br><span class="line">		I = H.ideal()</span><br><span class="line">		if I.dimension() == -1:</span><br><span class="line">			H.pop()</span><br><span class="line">		elif I.dimension() == 0:</span><br><span class="line">			roots = []</span><br><span class="line">			for root in I.variety(ring=ZZ):</span><br><span class="line">				root = tuple(R(root[var]) for var in f.variables())</span><br><span class="line">				roots.append(root)</span><br><span class="line">			return roots</span><br><span class="line"></span><br><span class="line">	return []</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">e=0xa14e64d0948eaa7df3eb514802e74ff6070d3ea7f16f712646ff794f2b50aa787e4b829ce09dee1d3e1add7c55d870b931b415b1e282259af005c46ce1bc38388fa530d3931b8b8d7a163fb4ca4252e4b77625e80354b8fb3fce7455dac4bdcbe04dfe743d3f628ad1093ecf22f97fa17eb67445f5edc507eb368b364bc9d77da6fcfce7896ef3259fc7a4e66835f99c3c10ca6e6013dd8f01036b26b08dd5ddfddba35e3037c7a4187edd3323685d888ff3b99edf1caf8b93b4a851dc2af95a216b313192b368c1ed77f2a4ac6ddb2c46383806659d7037c25533c0bf5e4f1f665f2bd5529ebbadba40b07ea9b4dee91f42e0ac69bcbe28573e8c4f5744847</span><br><span class="line">N=0xbb4efd151c65add72c7ff259687c11ee9d2d82d4058485d2a8abf80839f9da4d2bb1191b97b05d4a581f28e62f91784a2da912f98c2ef95273b311fc8c5dd4c468d82dee499874a88dda554aedc1d417dcacfc9bd787854db7a70575abb48e7c20d2662a2484391518357af55c18eb424687c2990ca10e89efcf019ff945705851bcc58673c2534c592a461bffbfc5369aeb31bc28998dfcaa0e7b3ab044005376fba8364151933ce73a12a4c3b7df7902cb462a95fc2e6d9596f3bebd712da63329bb4d45f1274852e81f04764fa610f5a86424e6026b10fc41c079d2649699be28716aa2da8c6e36276ea4f80eb3b2b4d921bd829046b5b6bd62e401116b47</span><br><span class="line">gift1=0x265e264a10862ccc5ede757362bc872ab562d201ddda1a4bec70cbe6becd71a411b1fc0bbc627f32fa0ee2ea0ceb91712d5c5187d8a2b0cb7</span><br><span class="line">gift2=0x2a1d29d36d731c528cc0cdd27e8b60a0596de783b591f85fb3f8c78bbe28e7d7d9710b41778789ad0dca7088e244c1df4aaf4d27a2afec428</span><br><span class="line"></span><br><span class="line">ct=0x71ac11e0b2bf7fca3e0ba051f74c90c4615ffca644fb69e7ed6c4dc1432d76049ad70ff1a9c3117c7d7db0c4fdc35518ef72068b2edb82dfeb9f7858376d4354633c63414b30584e28a70d90d5c5894d61a4e677721684e51ea52ac5747e33aa467f6a4e3e856f6ef08834d3fc70fec2d7229d14ccb761675be67ec87614b3e24f9c0d07463d2c636186d6ff7514a681ade1e5901afead97c6fa3df938cee004bef836cf32b07a33edfdc4268847e69d0cbc4b1b316ffdcf0e11cc03e03090e43789ae414f07be7d23be02f28f2bc507c72054bba6341265c64e52c038633023ff4b13e8d863816a29114a0773b62568912b4d22a8162ab0d7bf2bb8af265e21</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">d_l = gift1</span><br><span class="line">phi_l = gift2</span><br><span class="line">pq_l = (N - phi_l + 1) % (2 ** 450)</span><br><span class="line"></span><br><span class="line">kl = var(&#x27;kl&#x27;)</span><br><span class="line">f = e*d_l - kl * phi_l - 1 == 0</span><br><span class="line">k_ls = solve_mod(f, 2 ** 450)</span><br><span class="line"># print(k_ls)</span><br><span class="line"></span><br><span class="line">R.&lt;k_h, pq_h&gt; = PolynomialRing(Zmod(e))</span><br><span class="line">for k_l in k_ls:</span><br><span class="line">    bounds = [2 ** (int(2048 * 0.47) - 450), 2 ** (1024 - 450)]</span><br><span class="line">    f = 1 + (k_h * 2 **450 + int(k_l[0])) * (N - 2 ** 450 * pq_h - pq_l + 1)</span><br><span class="line"></span><br><span class="line">    res = small_roots(f, bounds, m=4, d=3)</span><br><span class="line">    if res!=[]:</span><br><span class="line">        print(res)</span><br><span class="line">        break</span><br><span class="line"></span><br><span class="line">pq = int(res[0][1]) * 2 **450 + pq_l</span><br><span class="line">print(res[0][1],int(res[0][1]))</span><br><span class="line">phi = N - pq + 1</span><br><span class="line"></span><br><span class="line">d= gmpy2.invert(int(e),int(phi))</span><br><span class="line">print(d.bit_length())</span><br><span class="line">print(long_to_bytes(pow(ct,d,N)))</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="nepctf-2024-ezRNG"><a href="#nepctf-2024-ezRNG" class="headerlink" title="[nepctf 2024] ezRNG"></a>[nepctf 2024] ezRNG</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">from random import randint</span><br><span class="line">from hashlib import sha256</span><br><span class="line">from secret import FLAG,secret</span><br><span class="line">from gmpy2 import next_prime</span><br><span class="line">from Crypto.Util.number import inverse,getPrime</span><br><span class="line">assert FLAG == b&#x27;NepCTF&#123;&#x27;+ secret + b&#x27;&#125;&#x27;</span><br><span class="line">class RNG():</span><br><span class="line">    def __init__(self, EllipticCurve):</span><br><span class="line">        self.E = EllipticCurve</span><br><span class="line">        self.G = E.gens()[0]</span><br><span class="line"></span><br><span class="line">        self.mask = randint(1,1 &lt;&lt; (bits//4))</span><br><span class="line">        self.k = getPrime(bits//2)</span><br><span class="line">        self.P = self.G * self.k</span><br><span class="line">        self.save = 0</span><br><span class="line">        self.check = 0</span><br><span class="line">        self.init()</span><br><span class="line">        self.r = 0</span><br><span class="line"></span><br><span class="line">    def init(self):</span><br><span class="line">        self.g = self.mask * self.P</span><br><span class="line">        self.state = self.g </span><br><span class="line"></span><br><span class="line">    def next(self):</span><br><span class="line">        if self.check :</span><br><span class="line">            self.r = -self.save</span><br><span class="line">        else:</span><br><span class="line">            self.r = -self.r+1</span><br><span class="line"></span><br><span class="line">        self.state = self.g + self.r*self.G</span><br><span class="line">        self.check = self.check^^1</span><br><span class="line">        self.save = self.r</span><br><span class="line"></span><br><span class="line">    def generate(self):</span><br><span class="line">        result = self.state</span><br><span class="line">        self.next()</span><br><span class="line">        return int(result.x()) % (2**192)</span><br><span class="line"></span><br><span class="line">def LuanGao(m,e):</span><br><span class="line">    q = 11091427946088586538326341642081147908870478369361079372527019919422720334995105276694411660643624940624081943057158631573866470376362760554084973766546671</span><br><span class="line">    p = 7164778143059850549407362450312125862993617607522974512258134374430678370277239436047396839637741848829691805270124657225690426144253093636119389335193487</span><br><span class="line">    e = next_prime(e)</span><br><span class="line">    d = inverse(e,(q-1)*(p-1))</span><br><span class="line">    n = p*q</span><br><span class="line">    c = pow(m,e,n)</span><br><span class="line">    assert pow(c,d,n) == m</span><br><span class="line">    return c</span><br><span class="line"></span><br><span class="line">p = 0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff</span><br><span class="line">a = 0xffffffff00000001000000000000000000000000fffffffffffffffffffffffc</span><br><span class="line">b = 0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b</span><br><span class="line">bits = 256</span><br><span class="line">E = EllipticCurve(GF(p), [a, b])</span><br><span class="line">ECRNG = RNG(E)</span><br><span class="line"></span><br><span class="line">mask = randint(1,1 &lt;&lt; (bits//4))</span><br><span class="line">r = randint(1,1 &lt;&lt; 50)</span><br><span class="line"></span><br><span class="line">hint = ECRNG.mask * ECRNG.k</span><br><span class="line">print(f&#x27;[+] hint1 = &#123;mask * ECRNG.k + r&#125;&#x27;)</span><br><span class="line">print(f&#x27;[+] hint2 = &#123;LuanGao( int(hint), int(ECRNG.g.x() ) )&#125;&#x27;)</span><br><span class="line">rngs = []</span><br><span class="line">for _ in range(11):</span><br><span class="line">    rng = ECRNG.generate()</span><br><span class="line">    rngs.append(rng)</span><br><span class="line">print(f&#x27;[+] RNG = &#123;rngs&#125;&#x27;)</span><br><span class="line"></span><br><span class="line">assert secret == sha256(str(ECRNG.k).encode()).hexdigest()[:32]</span><br><span class="line">&#x27;&#x27;&#x27;</span><br><span class="line">[+] hint1 = 949922372122218046965376048123327949376059750438908466789</span><br><span class="line">[+] hint2 = 42661446485198521271563058189095752632693753444357982122758630843460108543281128080768183549656737420326730293402550080264919238271649443935367948621363611575578331951338206643961231301011934223378959132807605885282642130943670906793105685979458606431074604742691074803447316574328163268414104662367677573967</span><br><span class="line">[+] RNG = [4198417781636735201616143091518824554303140448918234022822, 5934409889673636438564616521101931172645172047323840506005, 3545002769746467918593131186352102479907282194938281480964, 2052948548433827202413664681039848372904955567280762860403, 2409094928081781569924602821161748044701954566232724831425, 1384139093745169579221979501259712235516420223327557162332, 2939419134440891551148261965652575020956010158334816580524, 494864169851388494465000363130678068052130861967409621970, 3170747752017462050285295477866296066114421905697920861241, 3947558462622235401389908529480430195424430102289969854250, 5945090099574459201888181110413355524959030561838939467012]</span><br><span class="line">&#x27;&#x27;&#x27;</span><br></pre></td></tr></table></figure>
</div><div class="index-category-tag">  <div class="level-item"><i class="fas fa-tags has-text-grey"> </i><a class="article-more button is-small link-muted index-tags" href="/tags/CTF/">CTF</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/Crypto/">Crypto</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/DES/">DES</a></div><hr></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><i class="far fa-calendar-plus"> </i>2022-03-12  <a class="commentCountImg" href="/2022/03/12/Crypto-1/#comment-container"><span class="display-none-class">47cd8e1056e093bc2c86e2da019d39d0</span><i class="far fa-comment-dots"></i> <span class="commentCount" id="47cd8e1056e093bc2c86e2da019d39d0">99+</span>  </a><span class="level-item"><i class="far fa-clock"> </i>an hour  <i class="fas fa-pencil-alt"> </i>8.8 k</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/03/12/Crypto-1/">Crypto 1</a></h1><div class="content"><h3 id="GKCTF-2021-RRRRsa"><a href="#GKCTF-2021-RRRRsa" class="headerlink" title="[GKCTF 2021]RRRRsa"></a>[GKCTF 2021]RRRRsa</h3><p>下载附件，得到task.py</p></div><div class="index-category-tag">  <div class="level-item"><i class="fas fa-tags has-text-grey"> </i><a class="article-more button is-small link-muted index-tags" href="/tags/CTF/">CTF</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/Crypto/">Crypto</a></div><hr></div><div class="level is-mobile is-flex"><div class="level-start"><div class="level-item"><a class="article-more button is-small size-small" href="/2022/03/12/Crypto-1/#more">Read more&gt;&gt;</a></div></div><div class="level-start"><div class="level-item has-text-grey is-size-7"><time datetime="2024-09-14T12:49:18.398Z"><i class="far fa-calendar-check"> Last Modified: </i>2024-09-14</time></div></div></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><i class="far fa-calendar-plus"> </i>2022-03-03  <a class="commentCountImg" href="/2022/03/03/SUSCTF2022-large-case/#comment-container"><span class="display-none-class">484868356978d377b3a284c6b6918342</span><i class="far fa-comment-dots"></i> <span class="commentCount" id="484868356978d377b3a284c6b6918342">99+</span>  </a><span class="level-item"><i class="far fa-clock"> </i>6 m  <i class="fas fa-pencil-alt"> </i>0.9 k</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/03/03/SUSCTF2022-large-case/">SUSCTF2022 large case</a></h1><div class="content"><h3 id="SUSCTF-2022-Crypto-large-case"><a href="#SUSCTF-2022-Crypto-large-case" class="headerlink" title="[SUSCTF 2022 Crypto]large case"></a>[SUSCTF 2022 Crypto]large case</h3><p>记录一道因为忽视填充长度而无法做出的题目（real problem:菜）</p>
<p>题目：</p></div><div class="index-category-tag">  <div class="level-item"><i class="fas fa-tags has-text-grey"> </i><a class="article-more button is-small link-muted index-tags" href="/tags/CTF/">CTF</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/Crypto/">Crypto</a></div><hr></div><div class="level is-mobile is-flex"><div class="level-start"><div class="level-item"><a class="article-more button is-small size-small" href="/2022/03/03/SUSCTF2022-large-case/#more">Read more&gt;&gt;</a></div></div><div class="level-start"><div class="level-item has-text-grey is-size-7"><time datetime="2022-03-06T13:26:42.000Z"><i class="far fa-calendar-check"> Last Modified: </i>2022-03-06</time></div></div></div></article></div><!--!--><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><i class="far fa-calendar-plus"> </i>2022-01-28  <a class="commentCountImg" href="/2022/01/28/BUUOJ-Reverse-1/#comment-container"><span class="display-none-class">23f105c1a5aebc619a7ae9af53a700d7</span><i class="far fa-comment-dots"></i> <span class="commentCount" id="23f105c1a5aebc619a7ae9af53a700d7">99+</span>  </a><span class="level-item"><i class="far fa-clock"> </i>2 h  <i class="fas fa-pencil-alt"> </i>14.3 k</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/01/28/BUUOJ-Reverse-1/">Reverse 刷题记录</a></h1><div class="content"><p>题目主要来自BUUOJ，少数其他来源</p>
<p>[toc]</p>
<h2 id="CFI-CTF-2018-IntroToPE"><a href="#CFI-CTF-2018-IntroToPE" class="headerlink" title="[CFI-CTF 2018]IntroToPE"></a>[CFI-CTF 2018]IntroToPE</h2><p>直接扔IDA，发现无法F5，转而查看汇编代码</p>
<p>在此处发现奇怪的Base64字符串，解码后得到flag:CFI{.NetC#_1s_@w3s0m3}</p>
<img src="/2022/01/28/BUUOJ-Reverse-1/image-20220128104747053.png" class title="image-20220128104747053"></div><div class="index-category-tag">  <div class="level-item"><i class="fas fa-tags has-text-grey"> </i><a class="article-more button is-small link-muted index-tags" href="/tags/CTF/">CTF</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/RE/">RE</a></div><hr></div><div class="level is-mobile is-flex"><div class="level-start"><div class="level-item"><a class="article-more button is-small size-small" href="/2022/01/28/BUUOJ-Reverse-1/#more">Read more&gt;&gt;</a></div></div><div class="level-start"><div class="level-item has-text-grey is-size-7"><time datetime="2023-06-26T14:35:44.000Z"><i class="far fa-calendar-check"> Last Modified: </i>2023-06-26</time></div></div></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><i class="far fa-calendar-plus"> </i>2022-01-25  <a class="commentCountImg" href="/2022/01/25/Writeup-of-DASCTF2022-Jan-Crypto2/#comment-container"><span class="display-none-class">6903737ca821cf4cdbd0bd4cba0620a2</span><i class="far fa-comment-dots"></i> <span class="commentCount" id="6903737ca821cf4cdbd0bd4cba0620a2">99+</span>  </a><span class="level-item"><i class="far fa-clock"> </i>9 m  <i class="fas fa-pencil-alt"> </i>1.3 k</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/01/25/Writeup-of-DASCTF2022-Jan-Crypto2/">WriteUp of DASCTF Jan Crypto</a></h1><div class="content"><h1 id="Writeup-of-DasCTF-Jan-Crypto"><a href="#Writeup-of-DasCTF-Jan-Crypto" class="headerlink" title="Writeup of DasCTF Jan Crypto"></a>Writeup of DasCTF Jan Crypto</h1><h3 id="签到题-babyRSA"><a href="#签到题-babyRSA" class="headerlink" title="[签到题]babyRSA"></a>[签到题]babyRSA</h3><p>附件一：chall.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> FLAG,p,q,e</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> bytes_to_long,long_to_bytes</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">N = p*q</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt</span>(<span class="params">m,N,e</span>):</span></span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">pow</span>(m,e,N)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decrypt</span>(<span class="params">c,N,d</span>):</span></span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">pow</span>(c,d,N)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">padding</span>(<span class="params">msg</span>):</span></span><br><span class="line">    res = msg</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(res) &lt; <span class="number">128</span>:</span><br><span class="line">        res = res + os.urandom(<span class="number">128</span>-<span class="built_in">len</span>(res))</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">transfer</span>(<span class="params">msg</span>):</span></span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(msg) &lt; <span class="number">128</span></span><br><span class="line">    m = padding(msg)</span><br><span class="line">    <span class="keyword">return</span> bytes_to_long(m)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    m = transfer(FLAG)</span><br><span class="line">    <span class="built_in">print</span>(N,e)</span><br><span class="line">    <span class="built_in">print</span>(encrypt(m,N,e))</span><br></pre></td></tr></table></figure></div><div class="index-category-tag">  <div class="level-item"><i class="fas fa-tags has-text-grey"> </i><a class="article-more button is-small link-muted index-tags" href="/tags/CTF/">CTF</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/Crypto/">Crypto</a></div><hr></div><div class="level is-mobile is-flex"><div class="level-start"><div class="level-item"><a class="article-more button is-small size-small" href="/2022/01/25/Writeup-of-DASCTF2022-Jan-Crypto2/#more">Read more&gt;&gt;</a></div></div><div class="level-start"><div class="level-item has-text-grey is-size-7"><time datetime="2022-02-25T13:39:34.000Z"><i class="far fa-calendar-check"> Last Modified: </i>2022-02-25</time></div></div></div></article></div><nav class="pagination" role="navigation" aria-label="pagination"><div class="pagination-previous"><a href="/tags/CTF/">Previous</a></div><div class="pagination-next is-invisible is-hidden-mobile"><a href="/tags/CTF/page/3/">Next</a></div><ul class="pagination-list is-hidden-mobile"><li><a class="pagination-link" href="/tags/CTF/">1</a></li><li><a class="pagination-link is-current" href="/tags/CTF/page/2/">2</a></li></ul></nav></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1 is-sticky"><!--!--><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="https://github.com/Curator-Kim/Curator-Kim.github.io/blob/22a41709ffc26f62191d72a87ffbb342d46bfce3/img/icon.jpg?raw=true" alt="Curator-Kim"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Curator-Kim</p><p class="is-size-6 is-block">寻几处好景破星光</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>火星</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">57</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">0</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">15</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/ppoffice" target="_blank" rel="noopener">Follow</a></div><div class="level is-mobile"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/curator-kim"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Email" href="/804242129@qq.com"><i class="fa fa-envelope"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/atom.xml"><i class="fas fa-rss"></i></a></div><div><hr><p id="hitokoto">:D 一言句子获取中...</p><script type="text/javascript" defer>function getYiyan(){
                                $.getJSON("https://v1.hitokoto.cn/", function (data) {
                                if(data){
                                    $('#hitokoto').html("");
                                    $('#hitokoto').append("<strong style='color: #3273dc;'>"+data.hitokoto+"</strong>"+
                                    "<p>"+"From《"+data.from+"》</p><p>Provider-"+data.creator+"</p>");
                                }});}
                                $(function (){getYiyan();$('#hitokoto').click(function(){getYiyan();})});</script></div></div></div><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">Links</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://hexo.io" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Hexo</span></span><span class="level-right"><span class="level-item tag">hexo.io</span></span></a></li><li><a class="level is-mobile" href="https://bulma.io" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Bulma</span></span><span class="level-right"><span class="level-item tag">bulma.io</span></span></a></li></ul></div></div></div><div class="column-right-shadow is-hidden-widescreen"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3"><!--!--><div class="card widget"><div class="card-content"><h3 class="menu-label">Recents</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-09-18T07:01:03.174Z">2024-09-18</time></p><p class="title"><a href="/2024/09/18/awesome-chatgpt-prompts/"> </a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-09-18T06:59:04.582Z">2024-09-18</time></p><p class="title"><a href="/2024/09/18/SoK%20Security%20of%20Programmable%20Logic%20Controllers/"> </a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-09-18T06:58:24.805Z">2024-09-18</time></p><p class="title"><a href="/2024/09/18/A%20Survey%20of%20Protocol%20Fuzzing/"> </a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-02-21T11:54:21.947Z">2024-02-21</time></p><p class="title"><a href="/2024/02/21/010editor%20%E7%A0%B4%E8%A7%A3%E8%AE%B0%E5%BD%95/"> </a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-02-07T11:25:11.851Z">2024-02-07</time></p><p class="title"><a href="/2024/02/07/L3HCTF%202024/"> </a></p></div></article></div></div><!--!--><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Archives</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/archives/2024/09/"><span class="level-start"><span class="level-item">September 2024</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2024/02/"><span class="level-start"><span class="level-item">February 2024</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2024/01/"><span class="level-start"><span class="level-item">January 2024</span></span><span class="level-end"><span class="level-item tag">15</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2023/08/"><span class="level-start"><span class="level-item">August 2023</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2023/07/"><span class="level-start"><span class="level-item">July 2023</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><a class="level is-mobile is-marginless" href="/archives/"><span class="level-start"><span class="level-item">查看全部&gt;&gt;</span></span></a></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Tags</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/CTF/"><span class="tag">CTF</span><span class="tag is-grey-lightest">15</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80/"><span class="tag">汇编语言</span><span class="tag is-grey-lightest">12</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Crypto/"><span class="tag">Crypto</span><span class="tag is-grey-lightest">7</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ctf/"><span class="tag">ctf</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/pwn/"><span class="tag">pwn</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/CopperSmith/"><span class="tag">CopperSmith</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/DES/"><span class="tag">DES</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/HWS/"><span class="tag">HWS</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/NTRU/"><span class="tag">NTRU</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/RE/"><span class="tag">RE</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Reverse/"><span class="tag">Reverse</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/angr/"><span class="tag">angr</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%8A%A0%E5%AF%86%E4%B8%8E%E8%A7%A3%E5%AF%86/"><span class="tag">加密与解密</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB/"><span class="tag">论文阅读</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E9%A2%84%E5%A4%87%E7%9F%A5%E8%AF%86/"><span class="tag">预备知识</span><span class="tag is-grey-lightest">1</span></a></div></div></div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">Subscribe for updates</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="Subscribe"></div></div></form></div></div></div><!--!--></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="https://github.com/Curator-Kim/Curator-Kim.github.io/blob/master/img/logo.png?raw=true" alt="Curator-Kim的小站" height="28"></a><p class="size-small"><span>&copy; 2024 Curator-Kim</span>  Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank">Icarus</a> &amp; <a href="https://github.com/removeif/hexo-theme-amazing" target="_blank">Amazing</a> <br><span>© <a href="http://www.beian.miit.gov.cn/" target="_blank">粤ICP备88888888号-8（测试）</a><br></span><span>© 版权说明：[本网站所有内容均收集于互联网或自己创作,<br />&nbsp;&nbsp;&nbsp;&nbsp;方便于网友与自己学习交流，如有侵权，请<a href="/message" target="_blank">留言</a>，立即处理]<br /></span><span><span id="statistic-times">loading...</span><script>function createTime(time) {
            var n = new Date(time);
            now.setTime(now.getTime() + 250),
                days = (now - n) / 1e3 / 60 / 60 / 24,
                dnum = Math.floor(days),
                hours = (now - n) / 1e3 / 60 / 60 - 24 * dnum,
                hnum = Math.floor(hours),
            1 == String(hnum).length && (hnum = "0" + hnum),
                minutes = (now - n) / 1e3 / 60 - 1440 * dnum - 60 * hnum,
                mnum = Math.floor(minutes),
            1 == String(mnum).length && (mnum = "0" + mnum),
                seconds = (now - n) / 1e3 - 86400 * dnum - 3600 * hnum - 60 * mnum,
                snum = Math.round(seconds),
            1 == String(snum).length && (snum = "0" + snum),
                document.getElementById("statistic-times").innerHTML = "❤️Site from <strong>"+time.split(" ")[0].replace(/\//g,".")+"</strong> has existed <strong>" + dnum + "</strong> d <strong>" + hnum + "</strong> h <strong>" + mnum + "</strong> m <strong>" + snum + "</strong> s！❤️";
        }var now = new Date();setInterval("createTime('2022/1/21 00:00:00')", 250,"");</script><br></span><div class="size-small"><span>❤️Thx <strong><span id="busuanzi_value_site_uv">99+</span></strong> users <strong><span id="busuanzi_value_site_pv">99+</span></strong> visited！❤️</span></div></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/removeif/hexo-theme-amazing"><i class="fab fa-github"></i></a></p></div><div class="sideMusic"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css"><script src="/js/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script><meting-js style="width: auto;height: 2000px;" server="netease" type="playlist" id="137510737" theme="#2980b9" loop="all" autoplay="false" order="list" storageName="aplayer-setting" lrctype="0" list-max-height="400px" fixed="true"></meting-js></div></div></div></div></footer><script src="https://cdnjs.loli.net/ajax/libs/moment.js/2.22.2/moment-with-locales.min.js"></script><script src="https://cdnjs.loli.net/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" async></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdnjs.loli.net/ajax/libs/lightgallery/1.6.8/js/lightgallery.min.js" defer></script><script src="https://cdnjs.loli.net/ajax/libs/justifiedGallery/3.7.0/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><script type="text/x-mathjax-config">MathJax.Hub.Config({
            'HTML-CSS': {
                matchFontHeight: false
            },
            SVG: {
                matchFontHeight: false
            },
            CommonHTML: {
                matchFontHeight: false
            },
            tex2jax: {
                inlineMath: [
                    ['$','$'],
                    ['\\(','\\)']
                ]
            }
        });</script><script src="https://cdnjs.loli.net/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" defer></script><!--!--><script src="/js/main.js" defer></script><script>$.getScript('/js/comment-issue-data.js',function(){loadIssueData('46a9f3481b46ea0129d8','79c7c9cb847e141757d7864453bcbf89f0655b24','Curator-Kim','blog_comment',false);})</script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script><script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.js"></script><script type="text/javascript">var pjax = new Pjax({
            elements: "a",//代表点击链接就更新
            selectors: [  //代表要更新的节点
                ".section",
                "title"
            ],
            cache: true,
            cacheBust:false
        })

        function loadBusuanzi(){
        $.getScript("//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js", function () {});
        }

        function loadMathJax() { //加载mathjax
            $.getScript("//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML", function () {
                MathJax.Hub.Config({ tex2jax: { inlineMath: [['$', '$'], ['\(', '\)']] } });
                var math = document.getElementsByClassName("entry-content")[0];
                MathJax.Hub.Queue(["Typeset", MathJax.Hub, math]);
            });
        };

        // 开始 PJAX 执行的函数
        document.addEventListener('pjax:send', function () {
        });
        
        // PJAX 完成之后执行的函数，可以和上面的重载放在一起
        document.addEventListener('pjax:complete', function () {
            $(".section").css({opacity:1});
            if(false){
                $.getScript('/js/comment-issue-data.js',function(){loadIssueData('46a9f3481b46ea0129d8','79c7c9cb847e141757d7864453bcbf89f0655b24','Curator-Kim','blog_comment',false);});
            }
            if(false){
                loadMathJax();
            }
            loadMainJs(jQuery, window.moment, window.ClipboardJS, window.IcarusThemeSettings);
            loadBackTop();
            loadBusuanzi();
            if(typeof loadBanner == 'function'){
                loadBanner();
            }
        });</script></body></html>